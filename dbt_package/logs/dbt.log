[0m21:35:15.034086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8315b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c830d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c832e10>]}


============================== 21:35:15.036391 | 96db9d34-e48c-4536-a05a-517a9a4f34f9 ==============================
[0m21:35:15.036391 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:35:15.036622 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'invocation_command': 'dbt debug --target dev', 'static_parser': 'True', 'no_print': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'introspect': 'True', 'write_json': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'use_colors': 'True', 'version_check': 'True', 'debug': 'False', 'log_format': 'default', 'target_path': 'None', 'profiles_dir': '/Users/markrittman/.dbt'}
[0m21:35:15.046686 [info ] [MainThread]: dbt version: 1.10.15
[0m21:35:15.047445 [info ] [MainThread]: python version: 3.12.8
[0m21:35:15.047613 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m21:35:15.047741 [info ] [MainThread]: os info: macOS-26.1-arm64-arm-64bit
[0m21:35:18.244184 [info ] [MainThread]: Using profiles dir at /Users/markrittman/.dbt
[0m21:35:18.244411 [info ] [MainThread]: Using profiles.yml file at /Users/markrittman/.dbt/profiles.yml
[0m21:35:18.244517 [info ] [MainThread]: Using dbt_project.yml file at /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/dbt_project.yml
[0m21:35:18.244607 [info ] [MainThread]: adapter type: bigquery
[0m21:35:18.244708 [info ] [MainThread]: adapter version: 1.10.3
[0m21:35:18.284297 [info ] [MainThread]: Configuration:
[0m21:35:18.284511 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:35:18.284621 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:35:18.284709 [info ] [MainThread]: Required dependencies:
[0m21:35:18.284855 [debug] [MainThread]: Executing "git --help"
[0m21:35:18.296351 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:35:18.296799 [debug] [MainThread]: STDERR: "b''"
[0m21:35:18.296943 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:35:18.297073 [info ] [MainThread]: Connection:
[0m21:35:18.297221 [info ] [MainThread]:   method: service-account-json
[0m21:35:18.297316 [info ] [MainThread]:   database: ra-warehouse-dev
[0m21:35:18.297405 [info ] [MainThread]:   execution_project: ra-warehouse-dev
[0m21:35:18.297494 [info ] [MainThread]:   schema: analytics
[0m21:35:18.297579 [info ] [MainThread]:   location: europe-west2
[0m21:35:18.297671 [info ] [MainThread]:   priority: None
[0m21:35:18.297759 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:35:18.297843 [info ] [MainThread]:   impersonate_service_account: None
[0m21:35:18.297930 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:35:18.298013 [info ] [MainThread]:   job_retries: 1
[0m21:35:18.298095 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:35:18.298182 [info ] [MainThread]:   job_execution_timeout_seconds: 600
[0m21:35:18.298272 [info ] [MainThread]:   timeout_seconds: 600
[0m21:35:18.298363 [info ] [MainThread]:   client_id: None
[0m21:35:18.298450 [info ] [MainThread]:   token_uri: None
[0m21:35:18.298559 [info ] [MainThread]:   compute_region: None
[0m21:35:18.298649 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:35:18.298737 [info ] [MainThread]:   gcs_bucket: None
[0m21:35:18.298825 [info ] [MainThread]:   dataproc_batch: None
[0m21:35:18.299134 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:35:18.417173 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:35:18.417455 [debug] [MainThread]: On debug: select 1 as id
[0m21:35:18.417585 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:35:19.238643 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:cc50ae09-81c7-49f1-aa70-6208d8048e8e&page=queryresults
[0m21:35:19.675273 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:35:19.675632 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:35:19.703578 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 4.7050643, "process_in_blocks": "0", "process_kernel_time": 0.472717, "process_mem_max_rss": "376569856", "process_out_blocks": "0", "process_user_time": 1.62288}
[0m21:35:19.704031 [debug] [MainThread]: Command `dbt debug` succeeded at 21:35:19.703942 after 4.71 seconds
[0m21:35:19.704267 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:35:19.704499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c831700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1492ab800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14972acf0>]}
[0m21:35:19.704766 [debug] [MainThread]: Flushing usage events
[0m21:35:20.240017 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:35:40.772969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e96a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071aade0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071a9490>]}


============================== 21:35:40.775346 | f109f08b-6640-451e-a97b-52d0022048f7 ==============================
[0m21:35:40.775346 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:35:40.775601 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'empty': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt seed --target dev', 'version_check': 'True', 'quiet': 'False', 'profiles_dir': '/Users/markrittman/.dbt', 'cache_selected_only': 'False', 'introspect': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_format': 'default', 'write_json': 'True', 'debug': 'False', 'partial_parse': 'True', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'warn_error': 'None', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:35:42.344691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f109f08b-6640-451e-a97b-52d0022048f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107507620>]}
[0m21:35:42.365583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f109f08b-6640-451e-a97b-52d0022048f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b4c7560>]}
[0m21:35:42.365906 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:35:42.475675 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 2 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m21:35:42.478420 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 1.7360646, "process_in_blocks": "0", "process_kernel_time": 0.34571, "process_mem_max_rss": "375930880", "process_out_blocks": "0", "process_user_time": 1.48862}
[0m21:35:42.478807 [debug] [MainThread]: Command `dbt seed` failed at 21:35:42.478766 after 1.74 seconds
[0m21:35:42.478981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655ac30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b502690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067b3b00>]}
[0m21:35:42.479127 [debug] [MainThread]: Flushing usage events
[0m21:35:42.988839 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:35:53.870567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047e9d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f66a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f65280>]}


============================== 21:35:53.872835 | f5524ca8-38c3-4a9f-b298-b45a64592271 ==============================
[0m21:35:53.872835 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:35:53.873059 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'write_json': 'True', 'debug': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'version_check': 'True', 'printer_width': '80', 'profiles_dir': '/Users/markrittman/.dbt', 'no_print': 'None', 'warn_error': 'None', 'quiet': 'False', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'empty': 'None'}
[0m21:35:53.920354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5524ca8-38c3-4a9f-b298-b45a64592271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10520aae0>]}
[0m21:35:53.932067 [debug] [MainThread]: Set downloads directory='/var/folders/bn/ggp27z0j1szc_ldmg0mbxhyw0000gn/T/dbt-downloads-kumnfqb0'
[0m21:35:53.932302 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m21:35:54.165742 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m21:35:54.167031 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m21:35:54.370154 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m21:35:54.375849 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m21:35:54.520175 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m21:35:54.531293 [info ] [MainThread]: Updating lock file in file path: /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/package-lock.yml
[0m21:35:54.533391 [debug] [MainThread]: Set downloads directory='/var/folders/bn/ggp27z0j1szc_ldmg0mbxhyw0000gn/T/dbt-downloads-w5oxes_6'
[0m21:35:54.536075 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m21:35:54.969640 [info ] [MainThread]: Installed from version 1.3.3
[0m21:35:54.969871 [info ] [MainThread]: Up to date!
[0m21:35:54.970046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'f5524ca8-38c3-4a9f-b298-b45a64592271', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f3a510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10486b3e0>]}
[0m21:35:54.970223 [info ] [MainThread]: Installing dbt-labs/codegen
[0m21:35:55.313989 [info ] [MainThread]: Installed from version 0.14.0
[0m21:35:55.314251 [info ] [MainThread]: Up to date!
[0m21:35:55.314442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'f5524ca8-38c3-4a9f-b298-b45a64592271', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10488f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105656b40>]}
[0m21:35:55.317136 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.4788369, "process_in_blocks": "0", "process_kernel_time": 0.161632, "process_mem_max_rss": "118636544", "process_out_blocks": "0", "process_user_time": 0.692357}
[0m21:35:55.317408 [debug] [MainThread]: Command `dbt deps` succeeded at 21:35:55.317356 after 1.48 seconds
[0m21:35:55.317584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f3a510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048f0560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105753770>]}
[0m21:35:55.317751 [debug] [MainThread]: Flushing usage events
[0m21:35:55.849033 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:36:01.840878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108502660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10909f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10909de20>]}


============================== 21:36:01.843550 | 40f61e55-8ed2-4f9d-a2b1-d7ff07a18fca ==============================
[0m21:36:01.843550 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:36:01.844067 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'invocation_command': 'dbt seed --target dev', 'static_parser': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'introspect': 'True', 'partial_parse': 'True', 'profiles_dir': '/Users/markrittman/.dbt', 'target_path': 'None', 'log_format': 'default', 'write_json': 'True', 'use_experimental_parser': 'False', 'empty': 'None'}
[0m21:36:03.379058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40f61e55-8ed2-4f9d-a2b1-d7ff07a18fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c56120>]}
[0m21:36:03.401026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '40f61e55-8ed2-4f9d-a2b1-d7ff07a18fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108502270>]}
[0m21:36:03.401358 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:36:03.505551 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:36:03.505951 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m21:36:03.506091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '40f61e55-8ed2-4f9d-a2b1-d7ff07a18fca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d5f7c50>]}
[0m21:36:04.091795 [error] [MainThread]: Encountered an error:
Parsing Error
  Failed to render models/staging/focus/_focus__sources.yml from project barton_peveril_analytics: Parsing Error
    Env var required but not provided: 'DBT_BIGQUERY_PROJECT'
[0m21:36:04.093927 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 2.281798, "process_in_blocks": "0", "process_kernel_time": 0.357928, "process_mem_max_rss": "387039232", "process_out_blocks": "0", "process_user_time": 2.001937}
[0m21:36:04.094270 [debug] [MainThread]: Command `dbt seed` failed at 21:36:04.094221 after 2.28 seconds
[0m21:36:04.094451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091e07d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1389f8800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b73980>]}
[0m21:36:04.094597 [debug] [MainThread]: Flushing usage events
[0m21:36:04.623633 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:37:38.001436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028a9190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050517c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105053080>]}


============================== 21:37:38.003994 | 27038a1b-7c4c-436f-80a7-6628aab2731e ==============================
[0m21:37:38.003994 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:37:38.004382 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'warn_error': 'None', 'write_json': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'target_path': 'None', 'quiet': 'False', 'static_parser': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'profiles_dir': '/Users/markrittman/.dbt', 'use_colors': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt seed --target dev', 'partial_parse': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_cache_events': 'False'}
[0m21:37:39.655726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d9f5cd0>]}
[0m21:37:39.677429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d739400>]}
[0m21:37:39.677782 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:37:39.785878 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:37:39.786322 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m21:37:39.786487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105050500>]}
[0m21:37:40.462419 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `accepted_values`. Arguments to generic tests
should be nested under the `arguments` property.`
[0m21:37:40.462688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea3e510>]}
[0m21:37:40.582943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea3ecc0>]}
[0m21:37:40.630344 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:37:40.631426 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:37:40.647384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea598b0>]}
[0m21:37:40.647639 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:37:40.647771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f138e90>]}
[0m21:37:40.649353 [info ] [MainThread]: 
[0m21:37:40.649485 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:37:40.649573 [info ] [MainThread]: 
[0m21:37:40.649757 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:37:40.651479 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:37:40.651745 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:37:40.651890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:40.652083 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:37:40.652220 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:40.652352 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:37:40.670951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:40.690003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:41.655897 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:41.999380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:42.924755 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now create_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m21:37:42.925152 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now create_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m21:37:42.925540 [debug] [ThreadPool]: Creating schema "database: "ra-warehouse-dev"
schema: "analytics_seed_raw_prosolution"
"
[0m21:37:42.925790 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now create_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:37:42.926060 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now create_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:37:42.926348 [debug] [ThreadPool]: Creating schema "database: "ra-warehouse-dev"
schema: "analytics_seed_raw_six_dimensions"
"
[0m21:37:42.933274 [debug] [ThreadPool]: On create_ra-warehouse-dev_analytics_seed_raw_prosolution: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "connection_name": "create_ra-warehouse-dev_analytics_seed_raw_prosolution"} */
create schema if not exists `ra-warehouse-dev`.`analytics_seed_raw_prosolution`
  
[0m21:37:42.933626 [debug] [ThreadPool]: Creating schema "database: "ra-warehouse-dev"
schema: "analytics_seed_raw_focus"
"
[0m21:37:42.933885 [debug] [ThreadPool]: Creating schema "database: "ra-warehouse-dev"
schema: "analytics_seed_raw_alps"
"
[0m21:37:42.935196 [debug] [ThreadPool]: On create_ra-warehouse-dev_analytics_seed_raw_six_dimensions: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "connection_name": "create_ra-warehouse-dev_analytics_seed_raw_six_dimensions"} */
create schema if not exists `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`
  
[0m21:37:42.935442 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:42.936533 [debug] [ThreadPool]: On create_ra-warehouse-dev_analytics_seed_raw_focus: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "connection_name": "create_ra-warehouse-dev_analytics_seed_raw_focus"} */
create schema if not exists `ra-warehouse-dev`.`analytics_seed_raw_focus`
  
[0m21:37:42.937633 [debug] [ThreadPool]: On create_ra-warehouse-dev_analytics_seed_raw_alps: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "connection_name": "create_ra-warehouse-dev_analytics_seed_raw_alps"} */
create schema if not exists `ra-warehouse-dev`.`analytics_seed_raw_alps`
  
[0m21:37:42.937818 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:42.963589 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:42.963848 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:43.846753 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:9bdedd43-f55d-4eb5-ba90-75bd9464517a&page=queryresults
[0m21:37:43.894580 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:34190757-70af-48e4-88e7-156ae096e93f&page=queryresults
[0m21:37:43.902242 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:88316ebb-f38e-4aaa-a738-d8d5d2b4a196&page=queryresults
[0m21:37:44.095596 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:8ca3df80-ede3-48ec-9dc2-4c8d75ce05d4&page=queryresults
[0m21:37:45.419192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now create_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:37:45.419499 [debug] [ThreadPool]: Creating schema "database: "ra-warehouse-dev"
schema: "analytics_seed_raw_mis_applications"
"
[0m21:37:45.420717 [debug] [ThreadPool]: On create_ra-warehouse-dev_analytics_seed_raw_mis_applications: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "connection_name": "create_ra-warehouse-dev_analytics_seed_raw_mis_applications"} */
create schema if not exists `ra-warehouse-dev`.`analytics_seed_raw_mis_applications`
  
[0m21:37:45.420884 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:46.122353 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:13c71dfb-c43f-49aa-8245-498d52a5cdc3&page=queryresults
[0m21:37:47.227734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_integration)
[0m21:37:47.227991 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ra-warehouse-dev_analytics_seed_raw_focus, now list_ra-warehouse-dev_analytics_staging)
[0m21:37:47.228195 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_seed)
[0m21:37:47.228366 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.228594 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m21:37:47.228762 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.228896 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.248759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.822501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m21:37:47.822860 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.930527 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics)
[0m21:37:47.932471 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.933135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:37:47.936512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:47.973901 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:37:47.974288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:48.445669 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:37:48.446025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:49.127528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f01c380>]}
[0m21:37:49.128006 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:37:49.130980 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.average_gcse
[0m21:37:49.131313 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.completion_status
[0m21:37:49.131659 [info ] [Thread-1 (]: 1 of 17 START seed file analytics_seed_raw_focus.average_gcse .................. [RUN]
[0m21:37:49.131949 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.course_header
[0m21:37:49.132514 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.enrolment
[0m21:37:49.132285 [info ] [Thread-2 (]: 2 of 17 START seed file analytics_seed_raw_prosolution.completion_status ....... [RUN]
[0m21:37:49.132897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now seed.barton_peveril_analytics.average_gcse)
[0m21:37:49.133196 [info ] [Thread-3 (]: 3 of 17 START seed file analytics_seed_raw_prosolution.course_header ........... [RUN]
[0m21:37:49.133521 [info ] [Thread-4 (]: 4 of 17 START seed file analytics_seed_raw_prosolution.enrolment ............... [RUN]
[0m21:37:49.133808 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now seed.barton_peveril_analytics.completion_status)
[0m21:37:49.134014 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.average_gcse
[0m21:37:49.134346 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now seed.barton_peveril_analytics.course_header)
[0m21:37:49.134560 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now seed.barton_peveril_analytics.enrolment)
[0m21:37:49.134753 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.completion_status
[0m21:37:49.134946 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.average_gcse
[0m21:37:49.135122 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.course_header
[0m21:37:49.135293 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.enrolment
[0m21:37:49.135470 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.completion_status
[0m21:37:49.143855 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.course_header
[0m21:37:49.144482 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.enrolment
[0m21:37:49.155724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:37:49.163189 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:37:49.185886 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:37:49.187040 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:37:52.271793 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.average_gcse: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.average_gcse"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_focus`.`average_gcse` set OPTIONS()
  
[0m21:37:52.341718 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.course_header"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`course_header` set OPTIONS()
  
[0m21:37:52.586437 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:69820b1d-c496-4851-adfe-27b7f3e2321d&page=queryresults
[0m21:37:52.587766 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:29890d64-fcee-4c85-bd32-ef8903e08cbb&page=queryresults
[0m21:37:52.634932 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.completion_status: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.completion_status"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`completion_status` set OPTIONS()
  
[0m21:37:52.874729 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.enrolment"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`enrolment` set OPTIONS()
  
[0m21:37:52.906929 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.course_header"
[0m21:37:52.911861 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.average_gcse"
[0m21:37:52.929114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc85e80>]}
[0m21:37:52.929300 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104348b90>]}
[0m21:37:52.929540 [info ] [Thread-1 (]: 1 of 17 OK loaded seed file analytics_seed_raw_focus.average_gcse .............. [[32mINSERT 78[0m in 3.79s]
[0m21:37:52.930031 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.average_gcse
[0m21:37:52.929799 [info ] [Thread-3 (]: 3 of 17 OK loaded seed file analytics_seed_raw_prosolution.course_header ....... [[32mINSERT 15[0m in 3.79s]
[0m21:37:52.930247 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.jedi_report
[0m21:37:52.930464 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.course_header
[0m21:37:52.930660 [info ] [Thread-1 (]: 5 of 17 START seed file analytics_seed_raw_six_dimensions.jedi_report .......... [RUN]
[0m21:37:52.930823 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.offering
[0m21:37:52.930988 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.average_gcse, now seed.barton_peveril_analytics.jedi_report)
[0m21:37:52.931174 [info ] [Thread-3 (]: 6 of 17 START seed file analytics_seed_raw_prosolution.offering ................ [RUN]
[0m21:37:52.931333 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.jedi_report
[0m21:37:52.931470 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.course_header, now seed.barton_peveril_analytics.offering)
[0m21:37:52.931599 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.jedi_report
[0m21:37:52.931713 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.offering
[0m21:37:52.932868 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.offering
[0m21:37:52.934807 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:8a9875c4-c409-4f90-bb61-bc2859afb715&page=queryresults
[0m21:37:52.936104 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:37:52.937024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:37:53.271021 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6fd08e28-336d-4057-b10e-133ab98295fa&page=queryresults
[0m21:37:53.423157 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.completion_status"
[0m21:37:53.427172 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f01e2a0>]}
[0m21:37:53.427615 [info ] [Thread-2 (]: 2 of 17 OK loaded seed file analytics_seed_raw_prosolution.completion_status ... [[32mINSERT 4[0m in 4.29s]
[0m21:37:53.427941 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.completion_status
[0m21:37:53.428149 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.offering_type
[0m21:37:53.428437 [info ] [Thread-2 (]: 7 of 17 START seed file analytics_seed_raw_prosolution.offering_type ........... [RUN]
[0m21:37:53.428693 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.completion_status, now seed.barton_peveril_analytics.offering_type)
[0m21:37:53.428876 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.offering_type
[0m21:37:53.429040 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.offering_type
[0m21:37:53.431391 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:37:53.680771 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.enrolment"
[0m21:37:53.684421 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc85190>]}
[0m21:37:53.684797 [info ] [Thread-4 (]: 4 of 17 OK loaded seed file analytics_seed_raw_prosolution.enrolment ........... [[32mINSERT 161[0m in 4.55s]
[0m21:37:53.685120 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.enrolment
[0m21:37:53.685344 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.provider_report_a_level
[0m21:37:53.685666 [info ] [Thread-4 (]: 8 of 17 START seed file analytics_seed_raw_alps.provider_report_a_level ........ [RUN]
[0m21:37:53.685953 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.enrolment, now seed.barton_peveril_analytics.provider_report_a_level)
[0m21:37:53.686219 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.provider_report_a_level
[0m21:37:53.686507 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.provider_report_a_level
[0m21:37:53.690249 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:37:54.170803 [debug] [Thread-2 (]: Database Error in seed offering_type (seeds/raw_prosolution/offering_type.csv)
  Invalid value for type: VARCHAR(20) is not a valid value
[0m21:37:54.171142 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ef89730>]}
[0m21:37:54.171456 [error] [Thread-2 (]: 7 of 17 ERROR loading seed file analytics_seed_raw_prosolution.offering_type ... [[31mERROR[0m in 0.74s]
[0m21:37:54.171736 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.offering_type
[0m21:37:54.171929 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.provider_report_btec
[0m21:37:54.172192 [debug] [Thread-7 (]: Marking all children of 'seed.barton_peveril_analytics.offering_type' to be skipped because of status 'error'.  Reason: Database Error in seed offering_type (seeds/raw_prosolution/offering_type.csv)
  Invalid value for type: VARCHAR(20) is not a valid value.
[0m21:37:54.172465 [info ] [Thread-2 (]: 9 of 17 START seed file analytics_seed_raw_alps.provider_report_btec ........... [RUN]
[0m21:37:54.173094 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.offering_type, now seed.barton_peveril_analytics.provider_report_btec)
[0m21:37:54.173304 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.provider_report_btec
[0m21:37:54.173477 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.provider_report_btec
[0m21:37:54.177289 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:37:55.680565 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.jedi_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.jedi_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`jedi_report` set OPTIONS()
  
[0m21:37:55.897185 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:0f96b910-3e0d-4667-89b4-f8c9ef9579f0&page=queryresults
[0m21:37:56.375241 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.jedi_report"
[0m21:37:56.382238 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed934d0>]}
[0m21:37:56.382893 [info ] [Thread-1 (]: 5 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.jedi_report ...... [[32mINSERT 18[0m in 3.45s]
[0m21:37:56.383443 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.jedi_report
[0m21:37:56.383817 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.seed_grade_points
[0m21:37:56.384297 [info ] [Thread-1 (]: 10 of 17 START seed file analytics_seed.seed_grade_points ...................... [RUN]
[0m21:37:56.384676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.jedi_report, now seed.barton_peveril_analytics.seed_grade_points)
[0m21:37:56.384983 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.seed_grade_points
[0m21:37:56.385234 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.seed_grade_points
[0m21:37:56.389015 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:37:56.777282 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.offering"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering` set OPTIONS()
  
[0m21:37:56.857073 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.provider_report_a_level: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.provider_report_a_level"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_a_level` set OPTIONS()
  
[0m21:37:56.923247 [debug] [Thread-1 (]: Database Error in seed seed_grade_points (seeds/seed_grade_points.csv)
  Invalid value for type: VARCHAR(10) is not a valid value
[0m21:37:56.923730 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8baf60>]}
[0m21:37:56.924159 [error] [Thread-1 (]: 10 of 17 ERROR loading seed file analytics_seed.seed_grade_points .............. [[31mERROR[0m in 0.54s]
[0m21:37:56.924574 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.seed_grade_points
[0m21:37:56.924859 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:37:56.925260 [debug] [Thread-7 (]: Marking all children of 'seed.barton_peveril_analytics.seed_grade_points' to be skipped because of status 'error'.  Reason: Database Error in seed seed_grade_points (seeds/seed_grade_points.csv)
  Invalid value for type: VARCHAR(10) is not a valid value.
[0m21:37:56.925646 [info ] [Thread-1 (]: 11 of 17 START seed file analytics_seed.seed_subject_crosswalk ................. [RUN]
[0m21:37:56.926074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.seed_grade_points, now seed.barton_peveril_analytics.seed_subject_crosswalk)
[0m21:37:56.926375 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:37:56.926708 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:37:56.931407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:37:56.962878 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f36692f0-fa7e-41d4-9c06-4474a69f422f&page=queryresults
[0m21:37:57.065067 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:29abba72-e3d1-4c46-86ba-52e97e1c71ed&page=queryresults
[0m21:37:57.286378 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.offering"
[0m21:37:57.289342 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13efcc890>]}
[0m21:37:57.289627 [info ] [Thread-3 (]: 6 of 17 OK loaded seed file analytics_seed_raw_prosolution.offering ............ [[32mINSERT 30[0m in 4.36s]
[0m21:37:57.289934 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.offering
[0m21:37:57.290106 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.sixth_sense_report
[0m21:37:57.290326 [info ] [Thread-3 (]: 12 of 17 START seed file analytics_seed_raw_six_dimensions.sixth_sense_report .. [RUN]
[0m21:37:57.290495 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.offering, now seed.barton_peveril_analytics.sixth_sense_report)
[0m21:37:57.290667 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.sixth_sense_report
[0m21:37:57.290863 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.sixth_sense_report
[0m21:37:57.294104 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:37:57.320555 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.provider_report_a_level"
[0m21:37:57.323120 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc76c30>]}
[0m21:37:57.323388 [info ] [Thread-4 (]: 8 of 17 OK loaded seed file analytics_seed_raw_alps.provider_report_a_level .... [[32mINSERT 22[0m in 3.64s]
[0m21:37:57.323618 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.provider_report_a_level
[0m21:37:57.323776 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.student
[0m21:37:57.323983 [info ] [Thread-4 (]: 13 of 17 START seed file analytics_seed_raw_prosolution.student ................ [RUN]
[0m21:37:57.324147 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.provider_report_a_level, now seed.barton_peveril_analytics.student)
[0m21:37:57.324354 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.student
[0m21:37:57.324527 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.student
[0m21:37:57.328498 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:37:58.032306 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.provider_report_btec: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.provider_report_btec"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_btec` set OPTIONS()
  
[0m21:37:58.382542 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:45aaceef-1a81-4bd9-8f68-39b700e6b968&page=queryresults
[0m21:37:58.703278 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.provider_report_btec"
[0m21:37:58.709809 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10277e4e0>]}
[0m21:37:58.710556 [info ] [Thread-2 (]: 9 of 17 OK loaded seed file analytics_seed_raw_alps.provider_report_btec ....... [[32mINSERT 8[0m in 4.54s]
[0m21:37:58.711051 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.provider_report_btec
[0m21:37:58.711364 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.student_detail
[0m21:37:58.711764 [info ] [Thread-2 (]: 14 of 17 START seed file analytics_seed_raw_prosolution.student_detail ......... [RUN]
[0m21:37:58.712091 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.provider_report_btec, now seed.barton_peveril_analytics.student_detail)
[0m21:37:58.712360 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.student_detail
[0m21:37:58.712613 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.student_detail
[0m21:37:58.720479 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:37:59.490854 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.seed_subject_crosswalk: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.seed_subject_crosswalk"} */

    alter table `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk` set OPTIONS()
  
[0m21:37:59.839786 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:4e886df4-3212-488e-8662-68d899ffed7d&page=queryresults
[0m21:38:00.301738 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.seed_subject_crosswalk"
[0m21:38:00.306125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13efcd9d0>]}
[0m21:38:00.306580 [info ] [Thread-1 (]: 11 of 17 OK loaded seed file analytics_seed.seed_subject_crosswalk ............. [[32mINSERT 15[0m in 3.38s]
[0m21:38:00.307003 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:38:00.307299 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.student_extended_data
[0m21:38:00.307690 [info ] [Thread-1 (]: 15 of 17 START seed file analytics_seed_raw_mis_applications.student_extended_data  [RUN]
[0m21:38:00.307995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.seed_subject_crosswalk, now seed.barton_peveril_analytics.student_extended_data)
[0m21:38:00.308257 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.student_extended_data
[0m21:38:00.308506 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.student_extended_data
[0m21:38:00.314087 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:38:00.772034 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.sixth_sense_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.sixth_sense_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`sixth_sense_report` set OPTIONS()
  
[0m21:38:00.939323 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student` set OPTIONS()
  
[0m21:38:01.068202 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:0cd98e5f-30b8-43af-bbb0-60e200b03f29&page=queryresults
[0m21:38:01.245560 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2b49682a-276a-409d-9c58-ed8b899f396b&page=queryresults
[0m21:38:01.445125 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student_detail"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student_detail` set OPTIONS()
  
[0m21:38:01.449384 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.sixth_sense_report"
[0m21:38:01.453834 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed37c80>]}
[0m21:38:01.454298 [info ] [Thread-3 (]: 12 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.sixth_sense_report  [[32mINSERT 20[0m in 4.16s]
[0m21:38:01.454654 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.sixth_sense_report
[0m21:38:01.454893 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.va_report
[0m21:38:01.455242 [info ] [Thread-3 (]: 16 of 17 START seed file analytics_seed_raw_six_dimensions.va_report ........... [RUN]
[0m21:38:01.455582 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.sixth_sense_report, now seed.barton_peveril_analytics.va_report)
[0m21:38:01.455818 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.va_report
[0m21:38:01.456027 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.va_report
[0m21:38:01.459179 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:38:01.463182 [debug] [Thread-3 (]: Compilation Error in seed va_report (seeds/raw_six_dimensions/va_report.csv)
  Row 15 has 19 values, but Table only has 18 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed va_report (seeds/raw_six_dimensions/va_report.csv)
[0m21:38:01.463480 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed0c5c0>]}
[0m21:38:01.463770 [error] [Thread-3 (]: 16 of 17 ERROR loading seed file analytics_seed_raw_six_dimensions.va_report ... [[31mERROR[0m in 0.01s]
[0m21:38:01.464060 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.va_report
[0m21:38:01.464259 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.vocational_report
[0m21:38:01.464512 [debug] [Thread-7 (]: Marking all children of 'seed.barton_peveril_analytics.va_report' to be skipped because of status 'error'.  Reason: Compilation Error in seed va_report (seeds/raw_six_dimensions/va_report.csv)
  Row 15 has 19 values, but Table only has 18 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed va_report (seeds/raw_six_dimensions/va_report.csv).
[0m21:38:01.464775 [info ] [Thread-3 (]: 17 of 17 START seed file analytics_seed_raw_six_dimensions.vocational_report ... [RUN]
[0m21:38:01.465054 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.va_report, now seed.barton_peveril_analytics.vocational_report)
[0m21:38:01.465228 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.vocational_report
[0m21:38:01.465390 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.vocational_report
[0m21:38:01.467542 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:38:01.469055 [debug] [Thread-3 (]: Compilation Error in seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)
  Row 4 has 25 values, but Table only has 24 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)
[0m21:38:01.469278 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed24fe0>]}
[0m21:38:01.469523 [error] [Thread-3 (]: 17 of 17 ERROR loading seed file analytics_seed_raw_six_dimensions.vocational_report  [[31mERROR[0m in 0.00s]
[0m21:38:01.469767 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.vocational_report
[0m21:38:01.469980 [debug] [Thread-7 (]: Marking all children of 'seed.barton_peveril_analytics.vocational_report' to be skipped because of status 'error'.  Reason: Compilation Error in seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)
  Row 4 has 25 values, but Table only has 24 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv).
[0m21:38:01.560250 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student"
[0m21:38:01.563658 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed8e4e0>]}
[0m21:38:01.564060 [info ] [Thread-4 (]: 13 of 17 OK loaded seed file analytics_seed_raw_prosolution.student ............ [[32mINSERT 50[0m in 4.24s]
[0m21:38:01.564405 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.student
[0m21:38:01.713902 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:c169f274-e1dc-4597-bbaf-f17880ac4c53&page=queryresults
[0m21:38:02.038655 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student_detail"
[0m21:38:02.042626 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ef9e1e0>]}
[0m21:38:02.043135 [info ] [Thread-2 (]: 14 of 17 OK loaded seed file analytics_seed_raw_prosolution.student_detail ..... [[32mINSERT 78[0m in 3.33s]
[0m21:38:02.043638 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.student_detail
[0m21:38:05.352616 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.student_extended_data: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student_extended_data"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_mis_applications`.`student_extended_data` set OPTIONS()
  
[0m21:38:05.622533 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:a16c28a9-f839-4087-8022-7961655b6d2a&page=queryresults
[0m21:38:05.930049 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student_extended_data"
[0m21:38:05.935322 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27038a1b-7c4c-436f-80a7-6628aab2731e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ed4f0b0>]}
[0m21:38:05.935809 [info ] [Thread-1 (]: 15 of 17 OK loaded seed file analytics_seed_raw_mis_applications.student_extended_data  [[32mINSERT 78[0m in 5.63s]
[0m21:38:05.936247 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.student_extended_data
[0m21:38:05.937477 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:38:05.938716 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:38:05.938959 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.student_extended_data' was properly closed.
[0m21:38:05.939148 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.student_detail' was properly closed.
[0m21:38:05.939321 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.vocational_report' was properly closed.
[0m21:38:05.939489 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.student' was properly closed.
[0m21:38:05.939701 [info ] [MainThread]: 
[0m21:38:05.939912 [info ] [MainThread]: Finished running 17 seeds in 0 hours 0 minutes and 25.29 seconds (25.29s).
[0m21:38:05.941528 [debug] [MainThread]: Command end result
[0m21:38:05.975766 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:38:05.977446 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:38:05.980286 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m21:38:05.980441 [info ] [MainThread]: 
[0m21:38:05.980608 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m21:38:05.980732 [info ] [MainThread]: 
[0m21:38:05.980878 [error] [MainThread]: [31mFailure in seed offering_type (seeds/raw_prosolution/offering_type.csv)[0m
[0m21:38:05.981013 [error] [MainThread]:   Database Error in seed offering_type (seeds/raw_prosolution/offering_type.csv)
  Invalid value for type: VARCHAR(20) is not a valid value
[0m21:38:05.981123 [info ] [MainThread]: 
[0m21:38:05.981248 [error] [MainThread]: [31mFailure in seed seed_grade_points (seeds/seed_grade_points.csv)[0m
[0m21:38:05.981372 [error] [MainThread]:   Database Error in seed seed_grade_points (seeds/seed_grade_points.csv)
  Invalid value for type: VARCHAR(10) is not a valid value
[0m21:38:05.981469 [info ] [MainThread]: 
[0m21:38:05.981589 [error] [MainThread]: [31mFailure in seed va_report (seeds/raw_six_dimensions/va_report.csv)[0m
[0m21:38:05.981712 [error] [MainThread]:   Compilation Error in seed va_report (seeds/raw_six_dimensions/va_report.csv)
  Row 15 has 19 values, but Table only has 18 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed va_report (seeds/raw_six_dimensions/va_report.csv)
[0m21:38:05.981811 [info ] [MainThread]: 
[0m21:38:05.981931 [error] [MainThread]: [31mFailure in seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)[0m
[0m21:38:05.982055 [error] [MainThread]:   Compilation Error in seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)
  Row 4 has 25 values, but Table only has 24 columns.
  
  > in macro materialization_seed_default (macros/materializations/seeds/seed.sql)
  > called by seed vocational_report (seeds/raw_six_dimensions/vocational_report.csv)
[0m21:38:05.982161 [info ] [MainThread]: 
[0m21:38:05.982278 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=17
[0m21:38:05.982501 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 12 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:38:05.985228 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 28.02089, "process_in_blocks": "0", "process_kernel_time": 0.561879, "process_mem_max_rss": "405389312", "process_out_blocks": "0", "process_user_time": 6.028682}
[0m21:38:05.985475 [debug] [MainThread]: Command `dbt seed` failed at 21:38:05.985437 after 28.02 seconds
[0m21:38:05.985651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105087ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea3e3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ecd8e00>]}
[0m21:38:05.985810 [debug] [MainThread]: Flushing usage events
[0m21:38:07.028644 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:40:55.003139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fc4ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054bf1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054bede0>]}


============================== 21:40:55.005610 | f32d0179-217b-4f61-a051-6994f9052b8f ==============================
[0m21:40:55.005610 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:40:55.005847 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'write_json': 'True', 'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'cache_selected_only': 'False', 'version_check': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'no_print': 'None', 'fail_fast': 'False', 'warn_error': 'None', 'profiles_dir': '/Users/markrittman/.dbt', 'log_cache_events': 'False', 'empty': 'None', 'invocation_command': 'dbt seed --target dev', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'indirect_selection': 'eager', 'quiet': 'False', 'static_parser': 'True'}
[0m21:40:56.637919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f327b0>]}
[0m21:40:56.658457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118562ff0>]}
[0m21:40:56.658795 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:40:56.770813 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:40:56.819779 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:40:56.820062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b35c0>]}
[0m21:40:57.588846 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `accepted_values`. Arguments to generic tests
should be nested under the `arguments` property.`
[0m21:40:57.589083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119d76d50>]}
[0m21:40:57.775260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119dc32c0>]}
[0m21:40:57.944101 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:40:57.945235 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:40:57.962147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a27a300>]}
[0m21:40:57.962707 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:40:57.962866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a224620>]}
[0m21:40:57.964637 [info ] [MainThread]: 
[0m21:40:57.964787 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:40:57.964883 [info ] [MainThread]: 
[0m21:40:57.965066 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:40:57.966927 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:40:57.967124 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:57.967379 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:40:57.987253 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:40:57.987811 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:57.988054 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:40:57.988239 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:58.031535 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:58.793928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:58.815944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:59.732070 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:40:59.732301 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:59.732463 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_staging)
[0m21:40:59.733235 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m21:40:59.752408 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_integration)
[0m21:40:59.752759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:59.752936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:59.753120 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:00.270267 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_seed)
[0m21:41:00.271057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:01.254487 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics)
[0m21:41:01.258619 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:42:18.204253 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:42:18.207374 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:43:36.864466 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m21:43:36.866380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:44:06.261571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:44:06.262479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:44:44.275808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a286d20>]}
[0m21:44:44.277795 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:44:44.283123 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.average_gcse
[0m21:44:44.283420 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.completion_status
[0m21:44:44.283682 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.course_header
[0m21:44:44.284397 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.enrolment
[0m21:44:44.284174 [info ] [Thread-1 (]: 1 of 17 START seed file analytics_seed_raw_focus.average_gcse .................. [RUN]
[0m21:44:44.284721 [info ] [Thread-2 (]: 2 of 17 START seed file analytics_seed_raw_prosolution.completion_status ....... [RUN]
[0m21:44:44.285016 [info ] [Thread-3 (]: 3 of 17 START seed file analytics_seed_raw_prosolution.course_header ........... [RUN]
[0m21:44:44.285291 [info ] [Thread-4 (]: 4 of 17 START seed file analytics_seed_raw_prosolution.enrolment ............... [RUN]
[0m21:44:44.285578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now seed.barton_peveril_analytics.average_gcse)
[0m21:44:44.285808 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now seed.barton_peveril_analytics.completion_status)
[0m21:44:44.287009 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now seed.barton_peveril_analytics.enrolment)
[0m21:44:44.292411 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.average_gcse
[0m21:44:44.292841 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.completion_status
[0m21:44:44.298387 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now seed.barton_peveril_analytics.course_header)
[0m21:44:44.298606 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.enrolment
[0m21:44:44.298840 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.average_gcse
[0m21:44:44.298990 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.completion_status
[0m21:44:44.299125 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.course_header
[0m21:44:44.299268 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.enrolment
[0m21:44:44.309422 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.course_header
[0m21:44:44.342975 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:44:44.344935 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:44.351499 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:44:44.353241 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:44:47.398264 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.enrolment"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`enrolment` set OPTIONS()
  
[0m21:44:47.494563 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.average_gcse: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.average_gcse"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_focus`.`average_gcse` set OPTIONS()
  
[0m21:44:47.607675 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f6081672-2613-4912-b501-72855d3f778e&page=queryresults
[0m21:44:47.676943 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.completion_status: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.completion_status"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`completion_status` set OPTIONS()
  
[0m21:44:47.694544 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f456220a-9a85-4b0c-a661-e710239c535f&page=queryresults
[0m21:44:47.909009 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:160d2f88-2b91-454e-8296-cc3ac9bcce89&page=queryresults
[0m21:44:47.924824 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.enrolment"
[0m21:44:47.940009 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.average_gcse"
[0m21:44:47.942132 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f31af0>]}
[0m21:44:47.944205 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a813b90>]}
[0m21:44:47.944522 [info ] [Thread-4 (]: 4 of 17 OK loaded seed file analytics_seed_raw_prosolution.enrolment ........... [[32mINSERT 161[0m in 3.65s]
[0m21:44:47.945078 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.enrolment
[0m21:44:47.944827 [info ] [Thread-1 (]: 1 of 17 OK loaded seed file analytics_seed_raw_focus.average_gcse .............. [[32mINSERT 78[0m in 3.66s]
[0m21:44:47.945327 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.jedi_report
[0m21:44:47.945703 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.average_gcse
[0m21:44:47.945966 [info ] [Thread-4 (]: 5 of 17 START seed file analytics_seed_raw_six_dimensions.jedi_report .......... [RUN]
[0m21:44:47.946222 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.offering
[0m21:44:47.947295 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.enrolment, now seed.barton_peveril_analytics.jedi_report)
[0m21:44:47.947542 [info ] [Thread-1 (]: 6 of 17 START seed file analytics_seed_raw_prosolution.offering ................ [RUN]
[0m21:44:47.947743 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.jedi_report
[0m21:44:47.947932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.average_gcse, now seed.barton_peveril_analytics.offering)
[0m21:44:47.948163 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.jedi_report
[0m21:44:47.948328 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.offering
[0m21:44:47.950112 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.offering
[0m21:44:47.953301 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:44:47.978894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:48.096943 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.completion_status"
[0m21:44:48.099759 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3f1400>]}
[0m21:44:48.100015 [info ] [Thread-2 (]: 2 of 17 OK loaded seed file analytics_seed_raw_prosolution.completion_status ... [[32mINSERT 4[0m in 3.81s]
[0m21:44:48.100262 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.completion_status
[0m21:44:48.100419 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.offering_type
[0m21:44:48.100624 [info ] [Thread-2 (]: 7 of 17 START seed file analytics_seed_raw_prosolution.offering_type ........... [RUN]
[0m21:44:48.100791 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.completion_status, now seed.barton_peveril_analytics.offering_type)
[0m21:44:48.100925 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.offering_type
[0m21:44:48.101057 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.offering_type
[0m21:44:48.104087 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:44:51.101752 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.jedi_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.jedi_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`jedi_report` set OPTIONS()
  
[0m21:44:51.386203 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d6725e6a-2749-4f64-9a85-e55ecad78758&page=queryresults
[0m21:44:51.653124 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.offering_type"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering_type` set OPTIONS()
  
[0m21:44:51.750925 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.jedi_report"
[0m21:44:51.754918 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a87d610>]}
[0m21:44:51.755315 [info ] [Thread-4 (]: 5 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.jedi_report ...... [[32mINSERT 18[0m in 3.81s]
[0m21:44:51.755689 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.jedi_report
[0m21:44:51.755948 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.provider_report_a_level
[0m21:44:51.756531 [info ] [Thread-4 (]: 8 of 17 START seed file analytics_seed_raw_alps.provider_report_a_level ........ [RUN]
[0m21:44:51.756953 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.jedi_report, now seed.barton_peveril_analytics.provider_report_a_level)
[0m21:44:51.757234 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.provider_report_a_level
[0m21:44:51.757475 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.provider_report_a_level
[0m21:44:51.763192 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:44:51.823789 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:3dae5b00-c955-45f9-8da1-15fd136e312f&page=queryresults
[0m21:44:52.129813 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.offering_type"
[0m21:44:52.135205 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3f28a0>]}
[0m21:44:52.135565 [info ] [Thread-2 (]: 7 of 17 OK loaded seed file analytics_seed_raw_prosolution.offering_type ....... [[32mINSERT 7[0m in 4.03s]
[0m21:44:52.135853 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.offering_type
[0m21:44:52.136051 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.provider_report_btec
[0m21:44:52.136303 [info ] [Thread-2 (]: 9 of 17 START seed file analytics_seed_raw_alps.provider_report_btec ........... [RUN]
[0m21:44:52.136499 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.offering_type, now seed.barton_peveril_analytics.provider_report_btec)
[0m21:44:52.136667 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.provider_report_btec
[0m21:44:52.136827 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.provider_report_btec
[0m21:44:52.140147 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:44:52.205104 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.offering"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering` set OPTIONS()
  
[0m21:44:52.402179 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6423c808-de77-4d19-9c91-62a604c2a7d5&page=queryresults
[0m21:44:52.955649 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.offering"
[0m21:44:52.960980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a844680>]}
[0m21:44:52.961481 [info ] [Thread-1 (]: 6 of 17 OK loaded seed file analytics_seed_raw_prosolution.offering ............ [[32mINSERT 30[0m in 5.01s]
[0m21:44:52.961884 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.offering
[0m21:44:52.962161 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.seed_grade_points
[0m21:44:52.962555 [info ] [Thread-1 (]: 10 of 17 START seed file analytics_seed.seed_grade_points ...................... [RUN]
[0m21:44:52.962929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.offering, now seed.barton_peveril_analytics.seed_grade_points)
[0m21:44:52.963191 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.seed_grade_points
[0m21:44:52.963422 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.seed_grade_points
[0m21:44:52.966687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:53.312446 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.course_header"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`course_header` set OPTIONS()
  
[0m21:44:53.512286 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:784d01aa-d67b-4a0e-bebd-ba3f4085ec1e&page=queryresults
[0m21:44:53.823028 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.course_header"
[0m21:44:53.827843 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3f15e0>]}
[0m21:44:53.828536 [info ] [Thread-3 (]: 3 of 17 OK loaded seed file analytics_seed_raw_prosolution.course_header ....... [[32mINSERT 15[0m in 9.54s]
[0m21:44:53.829272 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.course_header
[0m21:44:53.829624 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:44:53.829995 [info ] [Thread-3 (]: 11 of 17 START seed file analytics_seed.seed_subject_crosswalk ................. [RUN]
[0m21:44:53.830296 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.course_header, now seed.barton_peveril_analytics.seed_subject_crosswalk)
[0m21:44:53.830532 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:44:53.830757 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:44:53.834663 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:44:54.284360 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.provider_report_a_level: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.provider_report_a_level"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_a_level` set OPTIONS()
  
[0m21:44:54.478990 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:3d95efa2-e6fa-4ed2-a5f1-b20db6d72719&page=queryresults
[0m21:44:54.754106 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.provider_report_a_level"
[0m21:44:54.757981 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3f1790>]}
[0m21:44:54.758293 [info ] [Thread-4 (]: 8 of 17 OK loaded seed file analytics_seed_raw_alps.provider_report_a_level .... [[32mINSERT 22[0m in 3.00s]
[0m21:44:54.758552 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.provider_report_a_level
[0m21:44:54.758740 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.sixth_sense_report
[0m21:44:54.759015 [info ] [Thread-4 (]: 12 of 17 START seed file analytics_seed_raw_six_dimensions.sixth_sense_report .. [RUN]
[0m21:44:54.759279 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.provider_report_a_level, now seed.barton_peveril_analytics.sixth_sense_report)
[0m21:44:54.759469 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.sixth_sense_report
[0m21:44:54.759634 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.sixth_sense_report
[0m21:44:54.762623 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:44:55.100983 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.provider_report_btec: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.provider_report_btec"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_btec` set OPTIONS()
  
[0m21:44:55.295222 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:ff2b8cab-0000-4a7d-aa10-0b80a1abea81&page=queryresults
[0m21:44:55.327700 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.seed_grade_points: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.seed_grade_points"} */

    alter table `ra-warehouse-dev`.`analytics_seed`.`seed_grade_points` set OPTIONS()
  
[0m21:44:55.530599 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:ce815f39-ba97-4650-9ec0-f29bef09ffae&page=queryresults
[0m21:44:55.593442 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.provider_report_btec"
[0m21:44:55.602183 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab07f50>]}
[0m21:44:55.602617 [info ] [Thread-2 (]: 9 of 17 OK loaded seed file analytics_seed_raw_alps.provider_report_btec ....... [[32mINSERT 8[0m in 3.47s]
[0m21:44:55.603004 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.provider_report_btec
[0m21:44:55.603279 [debug] [Thread-2 (]: Began running node seed.barton_peveril_analytics.student
[0m21:44:55.603663 [info ] [Thread-2 (]: 13 of 17 START seed file analytics_seed_raw_prosolution.student ................ [RUN]
[0m21:44:55.604019 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.provider_report_btec, now seed.barton_peveril_analytics.student)
[0m21:44:55.604272 [debug] [Thread-2 (]: Began compiling node seed.barton_peveril_analytics.student
[0m21:44:55.604500 [debug] [Thread-2 (]: Began executing node seed.barton_peveril_analytics.student
[0m21:44:55.610689 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:44:55.739290 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.seed_grade_points"
[0m21:44:55.742537 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab05ee0>]}
[0m21:44:55.742855 [info ] [Thread-1 (]: 10 of 17 OK loaded seed file analytics_seed.seed_grade_points .................. [[32mINSERT 19[0m in 2.78s]
[0m21:44:55.743141 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.seed_grade_points
[0m21:44:55.743344 [debug] [Thread-1 (]: Began running node seed.barton_peveril_analytics.student_detail
[0m21:44:55.743605 [info ] [Thread-1 (]: 14 of 17 START seed file analytics_seed_raw_prosolution.student_detail ......... [RUN]
[0m21:44:55.743813 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.seed_grade_points, now seed.barton_peveril_analytics.student_detail)
[0m21:44:55.743986 [debug] [Thread-1 (]: Began compiling node seed.barton_peveril_analytics.student_detail
[0m21:44:55.744147 [debug] [Thread-1 (]: Began executing node seed.barton_peveril_analytics.student_detail
[0m21:44:55.749539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:57.385726 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.seed_subject_crosswalk: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.seed_subject_crosswalk"} */

    alter table `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk` set OPTIONS()
  
[0m21:44:57.652623 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:89887af1-864e-4e78-9950-51fd4cc9f9ae&page=queryresults
[0m21:44:57.895825 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.sixth_sense_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.sixth_sense_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`sixth_sense_report` set OPTIONS()
  
[0m21:44:58.000616 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.seed_subject_crosswalk"
[0m21:44:58.005789 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab3dfa0>]}
[0m21:44:58.006289 [info ] [Thread-3 (]: 11 of 17 OK loaded seed file analytics_seed.seed_subject_crosswalk ............. [[32mINSERT 15[0m in 4.18s]
[0m21:44:58.006729 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.seed_subject_crosswalk
[0m21:44:58.007038 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.student_extended_data
[0m21:44:58.007433 [info ] [Thread-3 (]: 15 of 17 START seed file analytics_seed_raw_mis_applications.student_extended_data  [RUN]
[0m21:44:58.007740 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.seed_subject_crosswalk, now seed.barton_peveril_analytics.student_extended_data)
[0m21:44:58.007999 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.student_extended_data
[0m21:44:58.008219 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.student_extended_data
[0m21:44:58.016286 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:44:58.112600 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:18eca6cc-8651-4e67-a444-59a198a57f26&page=queryresults
[0m21:44:58.338527 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.sixth_sense_report"
[0m21:44:58.342429 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab74fb0>]}
[0m21:44:58.342786 [info ] [Thread-4 (]: 12 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.sixth_sense_report  [[32mINSERT 20[0m in 3.58s]
[0m21:44:58.343110 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.sixth_sense_report
[0m21:44:58.343343 [debug] [Thread-4 (]: Began running node seed.barton_peveril_analytics.va_report
[0m21:44:58.343642 [info ] [Thread-4 (]: 16 of 17 START seed file analytics_seed_raw_six_dimensions.va_report ........... [RUN]
[0m21:44:58.343876 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.sixth_sense_report, now seed.barton_peveril_analytics.va_report)
[0m21:44:58.344075 [debug] [Thread-4 (]: Began compiling node seed.barton_peveril_analytics.va_report
[0m21:44:58.344266 [debug] [Thread-4 (]: Began executing node seed.barton_peveril_analytics.va_report
[0m21:44:58.347494 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:45:00.910007 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.student_extended_data: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student_extended_data"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_mis_applications`.`student_extended_data` set OPTIONS()
  
[0m21:45:00.999844 [debug] [Thread-4 (]: On seed.barton_peveril_analytics.va_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.va_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`va_report` set OPTIONS()
  
[0m21:45:01.095597 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e55d1c67-4767-4954-9d4a-c3e1e8b40175&page=queryresults
[0m21:45:01.186668 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:5459f2a8-7839-4e34-94f8-9cb9544f3ed9&page=queryresults
[0m21:45:01.314429 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student_extended_data"
[0m21:45:01.318363 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a142c60>]}
[0m21:45:01.318752 [info ] [Thread-3 (]: 15 of 17 OK loaded seed file analytics_seed_raw_mis_applications.student_extended_data  [[32mINSERT 78[0m in 3.31s]
[0m21:45:01.319118 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.student_extended_data
[0m21:45:01.319379 [debug] [Thread-3 (]: Began running node seed.barton_peveril_analytics.vocational_report
[0m21:45:01.319711 [info ] [Thread-3 (]: 17 of 17 START seed file analytics_seed_raw_six_dimensions.vocational_report ... [RUN]
[0m21:45:01.319976 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.barton_peveril_analytics.student_extended_data, now seed.barton_peveril_analytics.vocational_report)
[0m21:45:01.320204 [debug] [Thread-3 (]: Began compiling node seed.barton_peveril_analytics.vocational_report
[0m21:45:01.320424 [debug] [Thread-3 (]: Began executing node seed.barton_peveril_analytics.vocational_report
[0m21:45:01.323883 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:45:01.519672 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.va_report"
[0m21:45:01.523297 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab950a0>]}
[0m21:45:01.523605 [info ] [Thread-4 (]: 16 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.va_report ....... [[32mINSERT 20[0m in 3.18s]
[0m21:45:01.523867 [debug] [Thread-4 (]: Finished running node seed.barton_peveril_analytics.va_report
[0m21:45:04.305084 [debug] [Thread-3 (]: On seed.barton_peveril_analytics.vocational_report: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.vocational_report"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`vocational_report` set OPTIONS()
  
[0m21:45:04.509565 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:492f8d89-bea9-4425-ad80-c8d75c288ade&page=queryresults
[0m21:45:04.779476 [debug] [Thread-3 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.vocational_report"
[0m21:45:04.785817 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11abac620>]}
[0m21:45:04.786669 [info ] [Thread-3 (]: 17 of 17 OK loaded seed file analytics_seed_raw_six_dimensions.vocational_report  [[32mINSERT 8[0m in 3.47s]
[0m21:45:04.787325 [debug] [Thread-3 (]: Finished running node seed.barton_peveril_analytics.vocational_report
[0m21:45:06.841023 [debug] [Thread-1 (]: On seed.barton_peveril_analytics.student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student_detail"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student_detail` set OPTIONS()
  
[0m21:45:07.029374 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:dfa21036-09a0-4a1f-932e-f3c33869afd3&page=queryresults
[0m21:45:07.244493 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student_detail"
[0m21:45:07.248413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab555e0>]}
[0m21:45:07.248734 [info ] [Thread-1 (]: 14 of 17 OK loaded seed file analytics_seed_raw_prosolution.student_detail ..... [[32mINSERT 78[0m in 11.50s]
[0m21:45:07.249029 [debug] [Thread-1 (]: Finished running node seed.barton_peveril_analytics.student_detail
[0m21:45:18.411726 [debug] [Thread-2 (]: On seed.barton_peveril_analytics.student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "seed.barton_peveril_analytics.student"} */

    alter table `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student` set OPTIONS()
  
[0m21:45:18.608968 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:a69c2437-6ec0-485c-9d85-02b09b1b070e&page=queryresults
[0m21:45:18.943645 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.barton_peveril_analytics.student"
[0m21:45:18.949011 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f32d0179-217b-4f61-a051-6994f9052b8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab69d00>]}
[0m21:45:18.949434 [info ] [Thread-2 (]: 13 of 17 OK loaded seed file analytics_seed_raw_prosolution.student ............ [[32mINSERT 50[0m in 23.34s]
[0m21:45:18.949800 [debug] [Thread-2 (]: Finished running node seed.barton_peveril_analytics.student
[0m21:45:18.950837 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:45:18.951984 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:45:18.952212 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.student_detail' was properly closed.
[0m21:45:18.952394 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.student' was properly closed.
[0m21:45:18.952557 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.vocational_report' was properly closed.
[0m21:45:18.952718 [debug] [MainThread]: Connection 'seed.barton_peveril_analytics.va_report' was properly closed.
[0m21:45:18.952949 [info ] [MainThread]: 
[0m21:45:18.953144 [info ] [MainThread]: Finished running 17 seeds in 0 hours 4 minutes and 20.99 seconds (260.99s).
[0m21:45:18.954795 [debug] [MainThread]: Command end result
[0m21:45:18.986697 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:45:18.989059 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:45:18.992126 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m21:45:18.992266 [info ] [MainThread]: 
[0m21:45:18.992432 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:45:18.992550 [info ] [MainThread]: 
[0m21:45:18.992683 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=17
[0m21:45:18.993031 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 12 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:45:18.996010 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 264.0131, "process_in_blocks": "0", "process_kernel_time": 0.629542, "process_mem_max_rss": "406323200", "process_out_blocks": "0", "process_user_time": 5.895585}
[0m21:45:18.996269 [debug] [MainThread]: Command `dbt seed` succeeded at 21:45:18.996224 after 264.01 seconds
[0m21:45:18.996458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a262720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a0bc770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047c7ad0>]}
[0m21:45:18.996604 [debug] [MainThread]: Flushing usage events
[0m21:45:19.629412 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:47:06.740002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107baad80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a1ad80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a1b410>]}


============================== 21:47:06.742654 | 68831226-e73e-44c8-9745-102acdb5609e ==============================
[0m21:47:06.742654 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:47:06.742885 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'target_path': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'no_print': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_colors': 'True', 'quiet': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'empty': 'False', 'debug': 'False', 'log_format': 'default', 'profiles_dir': '/Users/markrittman/.dbt', 'version_check': 'True', 'invocation_command': 'dbt run --select staging --target dev', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:47:08.401163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1463efe60>]}
[0m21:47:08.421750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1458cd1c0>]}
[0m21:47:08.422074 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:47:08.525610 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:47:08.618622 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:47:08.618819 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:47:08.640537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14742b7a0>]}
[0m21:47:08.686861 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:47:08.687978 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:47:08.708770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148326960>]}
[0m21:47:08.708999 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:47:08.709121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14836e8a0>]}
[0m21:47:08.710407 [info ] [MainThread]: 
[0m21:47:08.710527 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:47:08.710611 [info ] [MainThread]: 
[0m21:47:08.710783 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:47:08.712431 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:47:08.712645 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:09.405672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m21:47:09.406120 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:09.406500 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed'
[0m21:47:09.407893 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_integration'
[0m21:47:09.408075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:09.437161 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics'
[0m21:47:09.437543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:09.459776 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:09.975043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m21:47:09.976988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:10.005673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:47:10.007086 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:10.029335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:47:10.029540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:10.050775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics_staging)
[0m21:47:10.051281 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:10.418696 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:47:10.419489 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:10.819330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b02480>]}
[0m21:47:10.819688 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:47:10.822152 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:47:10.822389 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:47:10.822852 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:47:10.822686 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_staging.stg_alps__a_level_performance ... [RUN]
[0m21:47:10.823317 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:47:10.823093 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_staging.stg_alps__btec_performance ...... [RUN]
[0m21:47:10.823884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now model.barton_peveril_analytics.stg_alps__a_level_performance)
[0m21:47:10.823694 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_staging.stg_focus__average_gcse ......... [RUN]
[0m21:47:10.824157 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_staging.stg_mis_applications__student_extended_data  [RUN]
[0m21:47:10.824348 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now model.barton_peveril_analytics.stg_alps__btec_performance)
[0m21:47:10.824546 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:47:10.824854 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now model.barton_peveril_analytics.stg_focus__average_gcse)
[0m21:47:10.825061 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now model.barton_peveril_analytics.stg_mis_applications__student_extended_data)
[0m21:47:10.825263 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:47:10.831232 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_alps__a_level_performance"
[0m21:47:10.831439 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:47:10.831604 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:47:10.833505 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_alps__btec_performance"
[0m21:47:10.835934 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_focus__average_gcse"
[0m21:47:10.837407 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"
[0m21:47:10.838251 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:47:10.844849 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:47:10.851147 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:47:10.852424 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_alps__a_level_performance"
[0m21:47:10.852607 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"
[0m21:47:10.852739 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:47:10.853834 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_alps__btec_performance"
[0m21:47:10.854878 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_focus__average_gcse"
[0m21:47:10.855420 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_alps__a_level_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_alps__a_level_performance"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_a_level`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(subject_name)                              as alps_subject_name,

        -- Cohort
        cast(cohort_size as int64)                      as cohort_count,

        -- Grade distribution counts
        cast(grade_a_star as int64)                     as grade_a_star_count,
        cast(grade_a as int64)                          as grade_a_count,
        cast(grade_b as int64)                          as grade_b_count,
        cast(grade_c as int64)                          as grade_c_count,
        cast(grade_d as int64)                          as grade_d_count,
        cast(grade_e as int64)                          as grade_e_count,
        cast(grade_u as int64)                          as grade_u_count,

        -- Grade percentages (parse from string, removing % if present)
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_a_star,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
        as grade_a_star_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_a,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_a_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_b,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_b_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_c,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_c_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_d,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_d_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_e,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_e_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_u,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as grade_u_pct,

        -- ALPS metrics
        safe_cast(regexp_replace(alps_grade, '[^0-9]', '') as int64) as alps_band,
        safe_cast(alps_score as numeric)                as alps_score,
        safe_cast(t_score as numeric)                   as t_score,

        -- Averages
        safe_cast(avg_points as numeric)                as average_grade_points,

        -- Source metadata
        report_filename,
        report_date,
        parsed_at,

        -- Metadata
        'alps'                                          as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:10.855705 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_alps__btec_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_alps__btec_performance"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_btec`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(subject_name)                              as alps_subject_name,
        qualification_size,

        -- Cohort
        cast(cohort_size as int64)                      as cohort_count,

        -- Single Award grade counts
        cast(grade_d_star as int64)                     as btec_distinction_star_count,
        cast(grade_d as int64)                          as btec_distinction_count,
        cast(grade_m as int64)                          as btec_merit_count,
        cast(grade_p as int64)                          as btec_pass_count,

        -- Double Award grade counts
        cast(grade_d_star_d_star as int64)              as btec_d_star_d_star_count,
        cast(grade_d_star_d as int64)                   as btec_d_star_d_count,
        cast(grade_dd as int64)                         as btec_dd_count,
        cast(grade_dm as int64)                         as btec_dm_count,
        cast(grade_mm as int64)                         as btec_mm_count,
        cast(grade_mp as int64)                         as btec_mp_count,
        cast(grade_pp as int64)                         as btec_pp_count,

        -- Single Award percentages
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_d_star,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
        as btec_distinction_star_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_d,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as btec_distinction_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_m,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as btec_merit_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_p,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
             as btec_pass_pct,

        -- ALPS metrics
        safe_cast(regexp_replace(alps_grade, '[^0-9]', '') as int64) as alps_band,
        safe_cast(alps_score as numeric)                as alps_score,

        -- Source metadata
        report_filename,
        report_date,
        parsed_at,

        -- Metadata
        'alps'                                          as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:10.855942 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_mis_applications__student_extended_data: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_mis_applications`.`student_extended_data`

),

renamed as (

    select
        -- Foreign key
        student_detail_id,

        -- Disadvantage flag (ED = Economically Disadvantaged)
        case when ed = 1 then true else false end       as is_disadvantaged,

        -- SEN flag (includes Additional Adjustments)
        case when sen = 1 then true else false end      as is_sen,

        -- Pupil Premium / Free School Meals
        case when pp_or_fcm = 1 then true else false end as is_pp_or_fcm,
        coalesce(is_pupil_premium, false)               as is_pupil_premium,
        coalesce(is_free_school_meals, false)           as is_free_school_meals,

        -- Bursary
        coalesce(is_bursary, false)                     as is_bursary_recipient,
        bursary_type,

        -- Access arrangements
        coalesce(is_access_plus, false)                 as is_access_plus,
        coalesce(has_additional_adjustments, false)     as has_additional_adjustments,

        -- EHCP
        coalesce(has_ehcp, false)                       as has_ehcp,

        -- Looked After Children
        coalesce(is_lac, false)                         as is_lac,
        coalesce(is_care_leaver, false)                 as is_care_leaver,

        -- Young Carer
        coalesce(is_young_carer, false)                 as is_young_carer,

        -- SEND type
        sen_type,

        -- Metadata
        'mis_applications'                              as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:10.856133 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_focus__average_gcse: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_focus__average_gcse"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_focus`.`average_gcse`

),

renamed as (

    select
        -- Foreign key
        student_id,

        -- GCSE score
        cast(average_gcse as numeric)                   as average_gcse_score,

        -- Prior attainment band based on thresholds
        -- Low: < 4.77, Mid: 4.77-6.09, High: > 6.09
        case
            when average_gcse is null or average_gcse = 0 then 'N/A'
            when average_gcse < 4.77 then 'Low'
            when average_gcse <= 6.09 then 'Mid'
            else 'High'
        end                                             as prior_attainment_band,

        -- Numeric band code for sorting
        case
            when average_gcse is null or average_gcse = 0 then 0
            when average_gcse < 4.77 then 1
            when average_gcse <= 6.09 then 2
            else 3
        end                                             as prior_attainment_band_code,

        -- Individual subject grades (if available)
        gcse_english_grade,
        gcse_english_points,
        gcse_maths_grade,
        gcse_maths_points,

        -- Aggregates
        total_gcse_points,
        gcse_count,
        gcse_a_star_to_c_count,

        -- Source info
        gcse_year,
        data_source,

        -- Metadata
        'focus'                                         as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:10.856321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:10.856522 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:47:10.856708 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:47:10.857019 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:47:11.504718 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:8e6eee9b-0c2f-4162-8aa0-89e3fe85635d&page=queryresults
[0m21:47:11.549493 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:405403a6-7eb1-4bc7-a280-f4fbb7cef2d6&page=queryresults
[0m21:47:11.569392 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:40d746a5-6f13-4998-8775-71791b03c94f&page=queryresults
[0m21:47:11.602536 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6ef58de4-3ef2-426f-ac64-37dc5766dda3&page=queryresults
[0m21:47:11.610284 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:8e6eee9b-0c2f-4162-8aa0-89e3fe85635d&page=queryresults
[0m21:47:11.619621 [debug] [Thread-4 (]: Database Error in model stg_mis_applications__student_extended_data (models/staging/mis_applications/stg_mis_applications__student_extended_data.sql)
  Unrecognized name: student_detail_id at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/mis_applications/stg_mis_applications__student_extended_data.sql
[0m21:47:11.620981 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14841e5a0>]}
[0m21:47:11.621430 [error] [Thread-4 (]: 4 of 15 ERROR creating sql view model analytics_staging.stg_mis_applications__student_extended_data  [[31mERROR[0m in 0.79s]
[0m21:47:11.621800 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:47:11.622043 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:47:11.622392 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_mis_applications__student_extended_data' to be skipped because of status 'error'.  Reason: Database Error in model stg_mis_applications__student_extended_data (models/staging/mis_applications/stg_mis_applications__student_extended_data.sql)
  Unrecognized name: student_detail_id at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/mis_applications/stg_mis_applications__student_extended_data.sql.
[0m21:47:11.622754 [info ] [Thread-4 (]: 5 of 15 START sql view model analytics_staging.stg_prosolution__completion_status  [RUN]
[0m21:47:11.623695 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_mis_applications__student_extended_data, now model.barton_peveril_analytics.stg_prosolution__completion_status)
[0m21:47:11.623901 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:47:11.626042 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__completion_status"
[0m21:47:11.626552 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:47:11.629085 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__completion_status"
[0m21:47:11.629509 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_prosolution__completion_status: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__completion_status"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__completion_status`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`completion_status`

),

renamed as (

    select
        -- Primary key
        completion_status_id,

        -- Attributes
        name                                            as status_name,
        description                                     as status_description,

        -- Derived flags based on typical MIS status codes
        case
            when completion_status_id = 1 then true     -- Completed
            else false
        end                                             as is_completed,

        case
            when completion_status_id = 2 then true     -- Continuing
            else false
        end                                             as is_continuing,

        case
            when completion_status_id in (3, 4) then true  -- Withdrawn
            else false
        end                                             as is_withdrawn,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:11.629726 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:47:11.654682 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:405403a6-7eb1-4bc7-a280-f4fbb7cef2d6&page=queryresults
[0m21:47:11.657973 [debug] [Thread-1 (]: Database Error in model stg_alps__a_level_performance (models/staging/alps/stg_alps__a_level_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__a_level_performance.sql
[0m21:47:11.658230 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14841b1a0>]}
[0m21:47:11.658532 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_staging.stg_alps__a_level_performance  [[31mERROR[0m in 0.83s]
[0m21:47:11.658752 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:47:11.658897 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:47:11.659084 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_alps__a_level_performance' to be skipped because of status 'error'.  Reason: Database Error in model stg_alps__a_level_performance (models/staging/alps/stg_alps__a_level_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__a_level_performance.sql.
[0m21:47:11.659291 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_staging.stg_prosolution__course_header .. [RUN]
[0m21:47:11.659517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_alps__a_level_performance, now model.barton_peveril_analytics.stg_prosolution__course_header)
[0m21:47:11.659659 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:47:11.661207 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__course_header"
[0m21:47:11.661536 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:47:11.662707 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__course_header"
[0m21:47:11.662976 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_prosolution__course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__course_header"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`course_header`

),

renamed as (

    select
        -- Primary key
        course_header_id,

        -- Attributes
        code                                            as course_code,
        name                                            as course_name,
        description                                     as course_description,

        -- Classification
        subject_area,
        department,
        faculty,

        -- Flags
        coalesce(is_active, true)                       as is_active,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:11.663136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:11.683359 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:40d746a5-6f13-4998-8775-71791b03c94f&page=queryresults
[0m21:47:11.686164 [debug] [Thread-3 (]: Database Error in model stg_focus__average_gcse (models/staging/focus/stg_focus__average_gcse.sql)
  Unrecognized name: average_gcse; Did you mean average_gcse_id? at [21:14]
  compiled code at target/run/barton_peveril_analytics/models/staging/focus/stg_focus__average_gcse.sql
[0m21:47:11.686382 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14841fc50>]}
[0m21:47:11.686652 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_staging.stg_focus__average_gcse  [[31mERROR[0m in 0.86s]
[0m21:47:11.686849 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:47:11.686986 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:47:11.687150 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_focus__average_gcse' to be skipped because of status 'error'.  Reason: Database Error in model stg_focus__average_gcse (models/staging/focus/stg_focus__average_gcse.sql)
  Unrecognized name: average_gcse; Did you mean average_gcse_id? at [21:14]
  compiled code at target/run/barton_peveril_analytics/models/staging/focus/stg_focus__average_gcse.sql.
[0m21:47:11.687328 [info ] [Thread-3 (]: 7 of 15 START sql view model analytics_staging.stg_prosolution__enrolment ...... [RUN]
[0m21:47:11.687548 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_focus__average_gcse, now model.barton_peveril_analytics.stg_prosolution__enrolment)
[0m21:47:11.687676 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:47:11.689072 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__enrolment"
[0m21:47:11.689377 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:47:11.690465 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__enrolment"
[0m21:47:11.690754 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_prosolution__enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__enrolment"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__enrolment`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`enrolment`

),

renamed as (

    select
        -- Primary key
        enrolment_id,

        -- Foreign keys
        offering_id,
        student_detail_id,
        completion_status_id,

        -- Grade attributes
        nullif(trim(grade), '')                         as grade,
        grade_date,
        nullif(trim(predicted_grade), '')               as predicted_grade,

        -- Enrolment dates
        enrolment_date,
        withdrawal_date,
        withdrawal_reason,

        -- Component grades (for variance analysis)
        nullif(trim(component_1_grade), '')             as component_1_grade,
        nullif(trim(component_2_grade), '')             as component_2_grade,
        nullif(trim(component_3_grade), '')             as component_3_grade,
        nullif(trim(coursework_grade), '')              as coursework_grade,
        nullif(trim(exam_grade), '')                    as exam_grade,

        -- Re-sit tracking
        coalesce(is_resit, false)                       as is_resit,
        original_enrolment_id,

        -- Derived status flags
        case
            when completion_status_id in (1, 2) then true
            else false
        end                                             as is_valid_completion,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:11.690914 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:47:11.760464 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6ef58de4-3ef2-426f-ac64-37dc5766dda3&page=queryresults
[0m21:47:11.763098 [debug] [Thread-2 (]: Database Error in model stg_alps__btec_performance (models/staging/alps/stg_alps__btec_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__btec_performance.sql
[0m21:47:11.763319 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14844e750>]}
[0m21:47:11.763556 [error] [Thread-2 (]: 2 of 15 ERROR creating sql view model analytics_staging.stg_alps__btec_performance  [[31mERROR[0m in 0.94s]
[0m21:47:11.763735 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:47:11.763871 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:47:11.764193 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_alps__btec_performance' to be skipped because of status 'error'.  Reason: Database Error in model stg_alps__btec_performance (models/staging/alps/stg_alps__btec_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__btec_performance.sql.
[0m21:47:11.764023 [info ] [Thread-2 (]: 8 of 15 START sql view model analytics_staging.stg_prosolution__offering ....... [RUN]
[0m21:47:11.764465 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_alps__btec_performance, now model.barton_peveril_analytics.stg_prosolution__offering)
[0m21:47:11.764598 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:47:11.766139 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__offering"
[0m21:47:11.766457 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:47:11.767544 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__offering"
[0m21:47:11.767816 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_prosolution__offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__offering"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering`

),

renamed as (

    select
        -- Primary key
        offering_id,

        -- Foreign keys
        course_header_id,
        offering_type_id,
        academic_year_id,

        -- Attributes
        code                                            as offering_code,
        name                                            as offering_name,
        qual_id                                         as qualification_id,
        study_year,
        duration                                        as duration_years,

        -- Derived: is this the final year of the programme?
        case
            when study_year = duration then true
            else false
        end                                             as is_final_year,

        -- Dates
        start_date,
        end_date,

        -- Flags
        coalesce(is_active, true)                       as is_active,

        -- Derived: filter out non-qualification offerings
        case
            when qual_id is null then false
            when lower(qual_id) like 'enrich%' then false
            when lower(qual_id) like 'zwr%' then false
            when lower(qual_id) like '%tutor%' then false
            else true
        end                                             as is_valid_qualification,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:11.767984 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:47:12.157410 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:aa04055f-aeb3-4e8b-8d6e-922b049498fc&page=queryresults
[0m21:47:12.177520 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:372d2917-8a98-4a07-9b34-ce4aa10448aa&page=queryresults
[0m21:47:12.178003 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:5fd97d97-a18c-4d1d-8515-c4b72582ebae&page=queryresults
[0m21:47:12.263893 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:5fd97d97-a18c-4d1d-8515-c4b72582ebae&page=queryresults
[0m21:47:12.267435 [debug] [Thread-3 (]: Database Error in model stg_prosolution__enrolment (models/staging/prosolution/stg_prosolution__enrolment.sql)
  Unrecognized name: student_detail_id at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__enrolment.sql
[0m21:47:12.267948 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1485cba10>]}
[0m21:47:12.268487 [error] [Thread-3 (]: 7 of 15 ERROR creating sql view model analytics_staging.stg_prosolution__enrolment  [[31mERROR[0m in 0.58s]
[0m21:47:12.268961 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:47:12.269197 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:47:12.269451 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_prosolution__enrolment' to be skipped because of status 'error'.  Reason: Database Error in model stg_prosolution__enrolment (models/staging/prosolution/stg_prosolution__enrolment.sql)
  Unrecognized name: student_detail_id at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__enrolment.sql.
[0m21:47:12.269666 [info ] [Thread-3 (]: 9 of 15 START sql view model analytics_staging.stg_prosolution__offering_type .. [RUN]
[0m21:47:12.269938 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__enrolment, now model.barton_peveril_analytics.stg_prosolution__offering_type)
[0m21:47:12.270197 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:47:12.273149 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__offering_type"
[0m21:47:12.273714 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:47:12.275152 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__offering_type"
[0m21:47:12.275507 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_prosolution__offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__offering_type"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering_type`

),

renamed as (

    select
        -- Primary key
        offering_type_id,

        -- Attributes
        name                                            as offering_type_name,
        description                                     as offering_type_description,
        category                                        as offering_type_category,
        qualification_level,

        -- Derived grading scale
        case
            when offering_type_id in (1, 2) then 'A*-E'       -- A-Level
            when offering_type_id in (4, 8, 9) then 'D*-P'    -- BTEC
            else 'Other'
        end                                             as grading_scale,

        -- Classification flags
        case
            when offering_type_id in (1, 2) then true
            else false
        end                                             as is_academic,

        case
            when offering_type_id in (4, 8, 9) then true
            else false
        end                                             as is_vocational,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:12.275713 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:47:12.332948 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d11f702e-0882-4917-9662-1335b2dd40bc&page=queryresults
[0m21:47:12.421492 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1485a7f20>]}
[0m21:47:12.421977 [info ] [Thread-4 (]: 5 of 15 OK created sql view model analytics_staging.stg_prosolution__completion_status  [[32mCREATE VIEW (0 processed)[0m in 0.80s]
[0m21:47:12.422928 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:47:12.423704 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_prosolution__student
[0m21:47:12.424478 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1476b7620>]}
[0m21:47:12.424654 [info ] [Thread-4 (]: 10 of 15 START sql view model analytics_staging.stg_prosolution__student ....... [RUN]
[0m21:47:12.424882 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_staging.stg_prosolution__course_header  [[32mCREATE VIEW (0 processed)[0m in 0.76s]
[0m21:47:12.425034 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__completion_status, now model.barton_peveril_analytics.stg_prosolution__student)
[0m21:47:12.425210 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:47:12.425329 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__student
[0m21:47:12.425458 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:47:12.426884 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__student"
[0m21:47:12.427078 [info ] [Thread-1 (]: 11 of 15 START sql view model analytics_staging.stg_prosolution__student_detail  [RUN]
[0m21:47:12.427259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__course_header, now model.barton_peveril_analytics.stg_prosolution__student_detail)
[0m21:47:12.427379 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:47:12.428671 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__student_detail"
[0m21:47:12.428832 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__student
[0m21:47:12.429861 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__student"
[0m21:47:12.430027 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:47:12.431615 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__student_detail"
[0m21:47:12.432012 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_prosolution__student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__student"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student`

),

renamed as (

    select
        -- Primary key
        student_id,

        -- Identifiers
        uln,
        student_ref,

        -- Dates
        date_of_birth,
        first_enrolment_date,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:12.432186 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:47:12.451024 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_prosolution__student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__student_detail"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student_detail`

),

renamed as (

    select
        -- Primary key
        student_detail_id,

        -- Foreign keys
        student_id,
        academic_year_id,

        -- Gender (normalized)
        upper(trim(sex))                                as gender_code,
        case upper(trim(sex))
            when 'M' then 'Male'
            when 'F' then 'Female'
            else 'Other'
        end                                             as gender,

        -- Date of birth
        date_of_birth,

        -- Ethnicity
        ethnicity_code,
        ethnicity_description,
        -- Grouped ethnicity for analysis
        case
            when ethnicity_code in ('WBRI', 'WIRI', 'WOTH', 'WROM') then 'White'
            when ethnicity_code in ('MWBC', 'MWBA', 'MWAS', 'MOTH') then 'Mixed'
            when ethnicity_code in ('AIND', 'APKN', 'ABAN', 'AOTH') then 'Asian'
            when ethnicity_code in ('BCRB', 'BAFR', 'BOTH') then 'Black'
            when ethnicity_code in ('CHNE', 'OOTH') then 'Other'
            when ethnicity_code = 'REFU' then 'Prefer not to say'
            else 'Unknown'
        end                                             as ethnicity_group,

        -- Location
        postcode,
        -- Extract postcode area (first part)
        split(postcode, ' ')[safe_offset(0)]           as postcode_area,

        -- Flags
        coalesce(is_current, true)                      as is_current,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:47:12.451375 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:12.680892 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14848ca70>]}
[0m21:47:12.681241 [info ] [Thread-2 (]: 8 of 15 OK created sql view model analytics_staging.stg_prosolution__offering .. [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m21:47:12.681485 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:47:12.681645 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:47:12.681873 [info ] [Thread-2 (]: 12 of 15 START sql view model analytics_staging.stg_six_dimensions__jedi ....... [RUN]
[0m21:47:12.682104 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__offering, now model.barton_peveril_analytics.stg_six_dimensions__jedi)
[0m21:47:12.682267 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:47:12.684371 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__jedi"
[0m21:47:12.684799 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:47:12.686015 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__jedi"
[0m21:47:12.686385 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_six_dimensions__jedi: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__jedi"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`jedi_report`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(demographic_category)                      as demographic_category,
        trim(demographic_value)                         as demographic_value,

        -- Cohort metrics
        safe_cast(cohort_size as int64)                 as cohort_count,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_of_total,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
      as cohort_pct,

        -- Attainment metrics
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
         as pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    high_grade_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as high_grade_rate_pct,
        safe_cast(avg_points as numeric)                as average_points,

        -- Value-added
        safe_cast(va_score as numeric)                  as va_score,
        trim(va_band)                                   as va_band,

        -- Gap metrics
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    gap_vs_overall,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
    as gap_vs_overall_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    gap_vs_national,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as gap_vs_national_pct,

        -- National benchmarks
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_high_grade,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_high_grade_pct,

        -- Source metadata
        report_filename,
        report_type,
        report_date,
        parsed_at,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:12.686594 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:47:12.808243 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e92a6748-31fd-4b1e-b119-39ca60a97ce9&page=queryresults
[0m21:47:12.977563 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:06aa9170-2fb8-40e2-9242-d48d3e554474&page=queryresults
[0m21:47:13.037182 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:488982e0-56ec-445b-a284-ecfb349247a2&page=queryresults
[0m21:47:13.077175 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:06aa9170-2fb8-40e2-9242-d48d3e554474&page=queryresults
[0m21:47:13.082190 [debug] [Thread-1 (]: Database Error in model stg_prosolution__student_detail (models/staging/prosolution/stg_prosolution__student_detail.sql)
  Unrecognized name: sex at [25:20]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student_detail.sql
[0m21:47:13.082594 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1499829c0>]}
[0m21:47:13.083026 [error] [Thread-1 (]: 11 of 15 ERROR creating sql view model analytics_staging.stg_prosolution__student_detail  [[31mERROR[0m in 0.66s]
[0m21:47:13.083466 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:47:13.083820 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:47:13.084137 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_prosolution__student_detail' to be skipped because of status 'error'.  Reason: Database Error in model stg_prosolution__student_detail (models/staging/prosolution/stg_prosolution__student_detail.sql)
  Unrecognized name: sex at [25:20]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student_detail.sql.
[0m21:47:13.084476 [info ] [Thread-1 (]: 13 of 15 START sql view model analytics_staging.stg_six_dimensions__sixth_sense  [RUN]
[0m21:47:13.084854 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__student_detail, now model.barton_peveril_analytics.stg_six_dimensions__sixth_sense)
[0m21:47:13.085084 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:47:13.088181 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"
[0m21:47:13.088674 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:47:13.090433 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"
[0m21:47:13.090910 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_six_dimensions__sixth_sense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`sixth_sense_report`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(level)                                     as level,
        trim(subject_name)                              as subject_name,
        trim(qualification_type)                        as qualification_type,

        -- Cohort
        safe_cast(cohort_size as int64)                 as cohort_count,

        -- Attainment metrics
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
         as pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    high_grade_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as high_grade_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    a_star_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
       as a_star_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    a_star_a_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
     as a_star_a_rate_pct,
        safe_cast(avg_points as numeric)                as average_points,

        -- Sixth Sense specific metrics
        safe_cast(sixth_sense_score as numeric)         as sixth_sense_score,
        trim(sixth_sense_band)                          as sixth_sense_band,

        -- Value-added
        safe_cast(va_score as numeric)                  as va_score,
        trim(va_band)                                   as va_band,

        -- National comparison
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_high_grade,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_high_grade_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    percentile_rank,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as percentile_rank,

        -- Source metadata
        report_filename,
        report_type,
        report_date,
        parsed_at,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:13.091214 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:13.150253 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:488982e0-56ec-445b-a284-ecfb349247a2&page=queryresults
[0m21:47:13.154361 [debug] [Thread-4 (]: Database Error in model stg_prosolution__student (models/staging/prosolution/stg_prosolution__student.sql)
  Unrecognized name: student_ref; Did you mean student_id? at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student.sql
[0m21:47:13.154665 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14989c410>]}
[0m21:47:13.154958 [error] [Thread-4 (]: 10 of 15 ERROR creating sql view model analytics_staging.stg_prosolution__student  [[31mERROR[0m in 0.73s]
[0m21:47:13.155190 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__student
[0m21:47:13.155345 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:47:13.155545 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_prosolution__student' to be skipped because of status 'error'.  Reason: Database Error in model stg_prosolution__student (models/staging/prosolution/stg_prosolution__student.sql)
  Unrecognized name: student_ref; Did you mean student_id? at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student.sql.
[0m21:47:13.155757 [info ] [Thread-4 (]: 14 of 15 START sql view model analytics_staging.stg_six_dimensions__va ......... [RUN]
[0m21:47:13.155997 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__student, now model.barton_peveril_analytics.stg_six_dimensions__va)
[0m21:47:13.156146 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:47:13.158192 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__va"
[0m21:47:13.158578 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:47:13.159812 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__va"
[0m21:47:13.160131 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_six_dimensions__va: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__va"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`va_report`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(level)                                     as level,
        trim(subject_name)                              as subject_name,

        -- Cohort
        safe_cast(cohort_size as int64)                 as cohort_count,

        -- Attainment metrics
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
         as pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    high_grade_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as high_grade_rate_pct,
        safe_cast(avg_points as numeric)                as average_points,

        -- Value-added metrics
        safe_cast(va_score as numeric)                  as va_score,
        safe_cast(va_residual as numeric)               as va_residual,
        trim(va_band)                                   as va_band,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    va_percentile,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
     as va_percentile,
        safe_cast(va_confidence_lower as numeric)       as va_confidence_lower,
        safe_cast(va_confidence_upper as numeric)       as va_confidence_upper,

        -- National comparison
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_percentile,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_percentile,
        safe_cast(national_rank as int64)               as national_rank,

        -- Source metadata
        report_filename,
        report_type,
        report_date,
        parsed_at,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:13.160328 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:47:13.182360 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1485a8c50>]}
[0m21:47:13.182731 [info ] [Thread-3 (]: 9 of 15 OK created sql view model analytics_staging.stg_prosolution__offering_type  [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m21:47:13.182946 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:47:13.183091 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:47:13.183300 [info ] [Thread-3 (]: 15 of 15 START sql view model analytics_staging.stg_six_dimensions__vocational . [RUN]
[0m21:47:13.183479 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__offering_type, now model.barton_peveril_analytics.stg_six_dimensions__vocational)
[0m21:47:13.183621 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:47:13.185662 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__vocational"
[0m21:47:13.185982 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:47:13.187701 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__vocational"
[0m21:47:13.188026 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_six_dimensions__vocational: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__vocational"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`vocational_report`

),

cleaned as (

    select
        -- Keys
        report_year                                     as academic_year_id,
        trim(dataset_name)                              as dataset_name,
        trim(level)                                     as level,
        trim(subject_name)                              as subject_name,
        trim(qualification_type)                        as qualification_type,
        trim(qualification_size)                        as qualification_size,

        -- Cohort
        safe_cast(cohort_size as int64)                 as cohort_count,

        -- Grade distribution (BTEC-style)
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_distinction_star,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as distinction_star_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_distinction,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as distinction_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_merit,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
         as merit_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pct_pass,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
          as pass_pct,

        -- Attainment metrics
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
         as pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    high_grade_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as high_grade_rate_pct,
        safe_cast(avg_points as numeric)                as average_points,

        -- Value-added
        safe_cast(va_score as numeric)                  as va_score,
        trim(va_band)                                   as va_band,

        -- National comparison
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_pass_rate,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_pass_rate_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    national_high_grade,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
 as national_high_grade_pct,
        safe_cast(
        nullif(
            trim(
                regexp_replace(
                    percentile_rank,
                    r'[%\s]',
                    ''
                )
            ),
            ''
        ) as numeric
    )
   as percentile_rank,

        -- Source metadata
        report_filename,
        report_type,
        dataset_index,
        report_date,
        parsed_at,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:47:13.188225 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:47:13.265746 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:a26838a8-7553-4a60-9e1e-756b87dc4e0e&page=queryresults
[0m21:47:13.359172 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:a26838a8-7553-4a60-9e1e-756b87dc4e0e&page=queryresults
[0m21:47:13.363032 [debug] [Thread-2 (]: Database Error in model stg_six_dimensions__jedi (models/staging/six_dimensions/stg_six_dimensions__jedi.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__jedi.sql
[0m21:47:13.363232 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149997680>]}
[0m21:47:13.363473 [error] [Thread-2 (]: 12 of 15 ERROR creating sql view model analytics_staging.stg_six_dimensions__jedi  [[31mERROR[0m in 0.68s]
[0m21:47:13.363670 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:47:13.363836 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_six_dimensions__jedi' to be skipped because of status 'error'.  Reason: Database Error in model stg_six_dimensions__jedi (models/staging/six_dimensions/stg_six_dimensions__jedi.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__jedi.sql.
[0m21:47:13.635274 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:279f4ba0-8fd5-4b0d-a0c4-ff884fe2fd67&page=queryresults
[0m21:47:13.655851 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e96f00f8-db5b-4df9-bac9-42adeef519dc&page=queryresults
[0m21:47:13.715442 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:279f4ba0-8fd5-4b0d-a0c4-ff884fe2fd67&page=queryresults
[0m21:47:13.720598 [debug] [Thread-4 (]: Database Error in model stg_six_dimensions__va (models/staging/six_dimensions/stg_six_dimensions__va.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__va.sql
[0m21:47:13.721022 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1499ecf50>]}
[0m21:47:13.721505 [error] [Thread-4 (]: 14 of 15 ERROR creating sql view model analytics_staging.stg_six_dimensions__va  [[31mERROR[0m in 0.56s]
[0m21:47:13.721868 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:47:13.722170 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_six_dimensions__va' to be skipped because of status 'error'.  Reason: Database Error in model stg_six_dimensions__va (models/staging/six_dimensions/stg_six_dimensions__va.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__va.sql.
[0m21:47:13.743926 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e96f00f8-db5b-4df9-bac9-42adeef519dc&page=queryresults
[0m21:47:13.754707 [debug] [Thread-1 (]: Database Error in model stg_six_dimensions__sixth_sense (models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql
[0m21:47:13.755547 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148d1c5f0>]}
[0m21:47:13.756480 [error] [Thread-1 (]: 13 of 15 ERROR creating sql view model analytics_staging.stg_six_dimensions__sixth_sense  [[31mERROR[0m in 0.67s]
[0m21:47:13.758416 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:47:13.758909 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_six_dimensions__sixth_sense' to be skipped because of status 'error'.  Reason: Database Error in model stg_six_dimensions__sixth_sense (models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql.
[0m21:47:13.763804 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:1e42e9c6-a819-40fd-95a7-fce3a0882d5c&page=queryresults
[0m21:47:13.891214 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:1e42e9c6-a819-40fd-95a7-fce3a0882d5c&page=queryresults
[0m21:47:13.894897 [debug] [Thread-3 (]: Database Error in model stg_six_dimensions__vocational (models/staging/six_dimensions/stg_six_dimensions__vocational.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__vocational.sql
[0m21:47:13.895211 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68831226-e73e-44c8-9745-102acdb5609e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1499ee0c0>]}
[0m21:47:13.895561 [error] [Thread-3 (]: 15 of 15 ERROR creating sql view model analytics_staging.stg_six_dimensions__vocational  [[31mERROR[0m in 0.71s]
[0m21:47:13.895848 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:47:13.896071 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.stg_six_dimensions__vocational' to be skipped because of status 'error'.  Reason: Database Error in model stg_six_dimensions__vocational (models/staging/six_dimensions/stg_six_dimensions__vocational.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__vocational.sql.
[0m21:47:13.896820 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:13.897685 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:13.897851 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__sixth_sense' was properly closed.
[0m21:47:13.897987 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__jedi' was properly closed.
[0m21:47:13.898109 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__vocational' was properly closed.
[0m21:47:13.898225 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__va' was properly closed.
[0m21:47:13.898408 [info ] [MainThread]: 
[0m21:47:13.898563 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 5.19 seconds (5.19s).
[0m21:47:13.899660 [debug] [MainThread]: Command end result
[0m21:47:13.926948 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:47:13.928057 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:47:13.930950 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m21:47:13.931087 [info ] [MainThread]: 
[0m21:47:13.931227 [info ] [MainThread]: [31mCompleted with 11 errors, 0 partial successes, and 0 warnings:[0m
[0m21:47:13.931340 [info ] [MainThread]: 
[0m21:47:13.931479 [error] [MainThread]: [31mFailure in model stg_mis_applications__student_extended_data (models/staging/mis_applications/stg_mis_applications__student_extended_data.sql)[0m
[0m21:47:13.931613 [error] [MainThread]:   Database Error in model stg_mis_applications__student_extended_data (models/staging/mis_applications/stg_mis_applications__student_extended_data.sql)
  Unrecognized name: student_detail_id at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/mis_applications/stg_mis_applications__student_extended_data.sql
[0m21:47:13.931711 [info ] [MainThread]: 
[0m21:47:13.931828 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/mis_applications/stg_mis_applications__student_extended_data.sql
[0m21:47:13.931929 [info ] [MainThread]: 
[0m21:47:13.932049 [error] [MainThread]: [31mFailure in model stg_alps__a_level_performance (models/staging/alps/stg_alps__a_level_performance.sql)[0m
[0m21:47:13.932173 [error] [MainThread]:   Database Error in model stg_alps__a_level_performance (models/staging/alps/stg_alps__a_level_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__a_level_performance.sql
[0m21:47:13.932523 [info ] [MainThread]: 
[0m21:47:13.932635 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/alps/stg_alps__a_level_performance.sql
[0m21:47:13.932726 [info ] [MainThread]: 
[0m21:47:13.932838 [error] [MainThread]: [31mFailure in model stg_focus__average_gcse (models/staging/focus/stg_focus__average_gcse.sql)[0m
[0m21:47:13.932957 [error] [MainThread]:   Database Error in model stg_focus__average_gcse (models/staging/focus/stg_focus__average_gcse.sql)
  Unrecognized name: average_gcse; Did you mean average_gcse_id? at [21:14]
  compiled code at target/run/barton_peveril_analytics/models/staging/focus/stg_focus__average_gcse.sql
[0m21:47:13.933049 [info ] [MainThread]: 
[0m21:47:13.933157 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/focus/stg_focus__average_gcse.sql
[0m21:47:13.933246 [info ] [MainThread]: 
[0m21:47:13.933358 [error] [MainThread]: [31mFailure in model stg_alps__btec_performance (models/staging/alps/stg_alps__btec_performance.sql)[0m
[0m21:47:13.933473 [error] [MainThread]:   Database Error in model stg_alps__btec_performance (models/staging/alps/stg_alps__btec_performance.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/alps/stg_alps__btec_performance.sql
[0m21:47:13.933561 [info ] [MainThread]: 
[0m21:47:13.933667 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/alps/stg_alps__btec_performance.sql
[0m21:47:13.933757 [info ] [MainThread]: 
[0m21:47:13.933867 [error] [MainThread]: [31mFailure in model stg_prosolution__enrolment (models/staging/prosolution/stg_prosolution__enrolment.sql)[0m
[0m21:47:13.933978 [error] [MainThread]:   Database Error in model stg_prosolution__enrolment (models/staging/prosolution/stg_prosolution__enrolment.sql)
  Unrecognized name: student_detail_id at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__enrolment.sql
[0m21:47:13.934066 [info ] [MainThread]: 
[0m21:47:13.934172 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__enrolment.sql
[0m21:47:13.934260 [info ] [MainThread]: 
[0m21:47:13.934368 [error] [MainThread]: [31mFailure in model stg_prosolution__student_detail (models/staging/prosolution/stg_prosolution__student_detail.sql)[0m
[0m21:47:13.934480 [error] [MainThread]:   Database Error in model stg_prosolution__student_detail (models/staging/prosolution/stg_prosolution__student_detail.sql)
  Unrecognized name: sex at [25:20]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student_detail.sql
[0m21:47:13.934569 [info ] [MainThread]: 
[0m21:47:13.934675 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student_detail.sql
[0m21:47:13.934761 [info ] [MainThread]: 
[0m21:47:13.934869 [error] [MainThread]: [31mFailure in model stg_prosolution__student (models/staging/prosolution/stg_prosolution__student.sql)[0m
[0m21:47:13.934980 [error] [MainThread]:   Database Error in model stg_prosolution__student (models/staging/prosolution/stg_prosolution__student.sql)
  Unrecognized name: student_ref; Did you mean student_id? at [22:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student.sql
[0m21:47:13.935066 [info ] [MainThread]: 
[0m21:47:13.935169 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/prosolution/stg_prosolution__student.sql
[0m21:47:13.935255 [info ] [MainThread]: 
[0m21:47:13.935361 [error] [MainThread]: [31mFailure in model stg_six_dimensions__jedi (models/staging/six_dimensions/stg_six_dimensions__jedi.sql)[0m
[0m21:47:13.935470 [error] [MainThread]:   Database Error in model stg_six_dimensions__jedi (models/staging/six_dimensions/stg_six_dimensions__jedi.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__jedi.sql
[0m21:47:13.935559 [info ] [MainThread]: 
[0m21:47:13.935665 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__jedi.sql
[0m21:47:13.935750 [info ] [MainThread]: 
[0m21:47:13.935859 [error] [MainThread]: [31mFailure in model stg_six_dimensions__va (models/staging/six_dimensions/stg_six_dimensions__va.sql)[0m
[0m21:47:13.935970 [error] [MainThread]:   Database Error in model stg_six_dimensions__va (models/staging/six_dimensions/stg_six_dimensions__va.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__va.sql
[0m21:47:13.936055 [info ] [MainThread]: 
[0m21:47:13.936158 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__va.sql
[0m21:47:13.936245 [info ] [MainThread]: 
[0m21:47:13.936355 [error] [MainThread]: [31mFailure in model stg_six_dimensions__sixth_sense (models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql)[0m
[0m21:47:13.936467 [error] [MainThread]:   Database Error in model stg_six_dimensions__sixth_sense (models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql
[0m21:47:13.936553 [info ] [MainThread]: 
[0m21:47:13.936657 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql
[0m21:47:13.936745 [info ] [MainThread]: 
[0m21:47:13.936854 [error] [MainThread]: [31mFailure in model stg_six_dimensions__vocational (models/staging/six_dimensions/stg_six_dimensions__vocational.sql)[0m
[0m21:47:13.936969 [error] [MainThread]:   Database Error in model stg_six_dimensions__vocational (models/staging/six_dimensions/stg_six_dimensions__vocational.sql)
  Unrecognized name: report_year; Did you mean report_date? at [18:9]
  compiled code at target/run/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__vocational.sql
[0m21:47:13.937058 [info ] [MainThread]: 
[0m21:47:13.937165 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/staging/six_dimensions/stg_six_dimensions__vocational.sql
[0m21:47:13.937255 [info ] [MainThread]: 
[0m21:47:13.937364 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=11 SKIP=0 NO-OP=0 TOTAL=15
[0m21:47:13.939908 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.233518, "process_in_blocks": "0", "process_kernel_time": 0.464271, "process_mem_max_rss": "392888320", "process_out_blocks": "0", "process_user_time": 4.016152}
[0m21:47:13.940086 [debug] [MainThread]: Command `dbt run` failed at 21:47:13.940052 after 7.23 seconds
[0m21:47:13.940236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fa9df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1499ebcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1499ebd70>]}
[0m21:47:13.940362 [debug] [MainThread]: Flushing usage events
[0m21:47:14.594745 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:50:14.819995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f49880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943ef00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943ecf0>]}


============================== 21:50:14.822621 | 1e49ca1c-ee7e-4211-876a-62337a16a360 ==============================
[0m21:50:14.822621 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:50:14.822895 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'introspect': 'True', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'use_experimental_parser': 'False', 'empty': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'debug': 'False', 'printer_width': '80', 'static_parser': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run --select staging --target dev', 'target_path': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'profiles_dir': '/Users/markrittman/.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'warn_error': 'None', 'log_cache_events': 'False'}
[0m21:50:16.459501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0a7e0>]}
[0m21:50:16.480526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e31cc80>]}
[0m21:50:16.480833 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:50:16.587810 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:50:16.670727 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 11 files changed.
[0m21:50:16.671215 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/six_dimensions/stg_six_dimensions__vocational.sql
[0m21:50:16.671382 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/focus/stg_focus__average_gcse.sql
[0m21:50:16.671511 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/mis_applications/stg_mis_applications__student_extended_data.sql
[0m21:50:16.671627 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/prosolution/stg_prosolution__student.sql
[0m21:50:16.671738 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/alps/stg_alps__btec_performance.sql
[0m21:50:16.671849 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/prosolution/stg_prosolution__student_detail.sql
[0m21:50:16.671956 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/six_dimensions/stg_six_dimensions__jedi.sql
[0m21:50:16.672065 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/alps/stg_alps__a_level_performance.sql
[0m21:50:16.672170 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/six_dimensions/stg_six_dimensions__sixth_sense.sql
[0m21:50:16.672281 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/six_dimensions/stg_six_dimensions__va.sql
[0m21:50:16.672400 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/staging/prosolution/stg_prosolution__enrolment.sql
[0m21:50:16.783867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158a81040>]}
[0m21:50:16.830806 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:50:16.831887 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:50:16.847277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158bdf050>]}
[0m21:50:16.847549 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:50:16.847687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158bc0d70>]}
[0m21:50:16.849071 [info ] [MainThread]: 
[0m21:50:16.849216 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:50:16.849314 [info ] [MainThread]: 
[0m21:50:16.849507 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:50:16.851183 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:50:16.851336 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:18.826120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_staging)
[0m21:50:18.826658 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:18.827133 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_mis_applications'
[0m21:50:18.828691 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_six_dimensions'
[0m21:50:18.857249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:18.857687 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_prosolution'
[0m21:50:18.858005 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:18.880261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:19.849321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics)
[0m21:50:19.850345 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:19.882200 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_integration)
[0m21:50:19.883124 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:19.942497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics_seed)
[0m21:50:19.947437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:50:19.947618 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:19.947849 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:20.990899 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:50:20.992927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:21.955296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1292d0bc0>]}
[0m21:50:21.955612 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:50:21.957856 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:50:21.958081 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:50:21.958285 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:50:21.958663 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:50:21.958520 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_staging.stg_alps__a_level_performance ... [RUN]
[0m21:50:21.958900 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_staging.stg_alps__btec_performance ...... [RUN]
[0m21:50:21.959118 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_staging.stg_focus__average_gcse ......... [RUN]
[0m21:50:21.959351 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_staging.stg_mis_applications__student_extended_data  [RUN]
[0m21:50:21.959548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now model.barton_peveril_analytics.stg_alps__a_level_performance)
[0m21:50:21.959728 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now model.barton_peveril_analytics.stg_alps__btec_performance)
[0m21:50:21.959899 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now model.barton_peveril_analytics.stg_focus__average_gcse)
[0m21:50:21.960179 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now model.barton_peveril_analytics.stg_mis_applications__student_extended_data)
[0m21:50:21.960333 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:50:21.960482 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:50:21.960637 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:50:21.960783 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:50:21.964597 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_alps__a_level_performance"
[0m21:50:21.966054 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_alps__btec_performance"
[0m21:50:21.967739 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_focus__average_gcse"
[0m21:50:21.969611 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"
[0m21:50:21.970045 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:50:21.981890 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"
[0m21:50:21.982171 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:50:21.982318 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:50:21.983446 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_alps__btec_performance"
[0m21:50:21.983596 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:50:21.984595 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_alps__a_level_performance"
[0m21:50:21.984816 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_mis_applications__student_extended_data: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_mis_applications__student_extended_data"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_mis_applications`.`student_extended_data`

),

renamed as (

    select
        -- Primary key
        student_extended_id,

        -- Foreign key
        student_id,
        academic_year_id,

        -- Background information
        nationality,
        country_of_birth,
        first_language,
        religion,

        -- Care and support flags
        coalesce(is_young_carer, false)                 as is_young_carer,
        coalesce(is_parent_carer, false)                as is_parent_carer,
        care_leaver_status,
        asylum_seeker_status,
        armed_forces_status,
        household_situation,

        -- Deprivation indices
        cast(imd_decile as int64)                       as imd_decile,
        cast(polar4_quintile as int64)                  as polar4_quintile,
        tundra_classification,

        -- Metadata
        'mis_applications'                              as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:21.985850 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_focus__average_gcse"
[0m21:50:21.986068 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_alps__btec_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_alps__btec_performance"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_btec`

),

cleaned as (

    select
        -- Keys
        alps_btec_report_id,
        academic_year                                   as academic_year_id,
        trim(subject_name)                              as alps_subject_name,
        qualification_type,

        -- Cohort
        cast(student_count as int64)                    as cohort_count,
        safe_cast(average_gcse_on_entry as numeric)     as average_gcse_on_entry,

        -- ALPS metrics
        cast(alps_grade as int64)                       as alps_band,
        safe_cast(alps_score as numeric)                as alps_score,
        safe_cast(value_added_score as numeric)         as value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        safe_cast(pass_rate_pct as numeric)             as pass_rate_pct,
        safe_cast(high_grades_pct as numeric)           as high_grades_pct,

        -- Source metadata
        report_date,

        -- Metadata
        'alps'                                          as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:21.986280 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:50:21.986465 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:50:22.006244 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_alps__a_level_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_alps__a_level_performance"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_alps`.`provider_report_a_level`

),

cleaned as (

    select
        -- Keys
        alps_report_id,
        academic_year                                   as academic_year_id,
        trim(subject_name)                              as alps_subject_name,

        -- Cohort
        cast(student_count as int64)                    as cohort_count,
        safe_cast(average_gcse_on_entry as numeric)     as average_gcse_on_entry,

        -- ALPS metrics
        cast(alps_grade as int64)                       as alps_band,
        safe_cast(alps_score as numeric)                as alps_score,
        safe_cast(value_added_score as numeric)         as value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        safe_cast(pass_rate_pct as numeric)             as pass_rate_pct,
        safe_cast(high_grades_pct as numeric)           as high_grades_pct,

        -- Source metadata
        report_date,

        -- Metadata
        'alps'                                          as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:22.034039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:50:22.054195 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_focus__average_gcse: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_focus__average_gcse"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_focus`.`average_gcse`

),

renamed as (

    select
        -- Primary key
        average_gcse_id,

        -- Foreign key
        student_id,
        academic_year_id,

        -- GCSE score
        cast(average_gcse_score as numeric)             as average_gcse_score,

        -- Prior attainment band based on thresholds
        -- Low: < 4.77, Mid: 4.77-6.09, High: > 6.09
        case
            when average_gcse_score is null or average_gcse_score = 0 then 'N/A'
            when average_gcse_score < 4.77 then 'Low'
            when average_gcse_score <= 6.09 then 'Mid'
            else 'High'
        end                                             as prior_attainment_band,

        -- Numeric band code for sorting
        case
            when average_gcse_score is null or average_gcse_score = 0 then 0
            when average_gcse_score < 4.77 then 1
            when average_gcse_score <= 6.09 then 2
            else 3
        end                                             as prior_attainment_band_code,

        -- Individual subject grades
        cast(gcse_english_grade as int64)               as gcse_english_grade,
        cast(gcse_maths_grade as int64)                 as gcse_maths_grade,

        -- Count
        cast(gcse_count as int64)                       as gcse_count,

        -- Source info
        data_source,

        -- Metadata
        'focus'                                         as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:22.054869 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:50:22.961893 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6489f450-6ab0-4e0e-9465-e9c4d459a719&page=queryresults
[0m21:50:22.978529 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:44d11ef9-b877-423c-94e3-bcb41f4052f7&page=queryresults
[0m21:50:22.985999 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:99b6b888-27b2-4f2d-8e52-0fd9698e8c95&page=queryresults
[0m21:50:22.988075 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:1fc23b73-6b1d-490c-8064-1065c38c8ee0&page=queryresults
[0m21:50:23.764156 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1292d1ac0>]}
[0m21:50:23.764389 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1586fa690>]}
[0m21:50:23.764522 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158e5fb60>]}
[0m21:50:23.764834 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_staging.stg_alps__btec_performance . [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m21:50:23.765004 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158b6a4b0>]}
[0m21:50:23.765207 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_staging.stg_mis_applications__student_extended_data  [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m21:50:23.765420 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_staging.stg_focus__average_gcse .... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m21:50:23.765633 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_alps__btec_performance
[0m21:50:23.765816 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_staging.stg_alps__a_level_performance  [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m21:50:23.766008 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_mis_applications__student_extended_data
[0m21:50:23.766175 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_focus__average_gcse
[0m21:50:23.766333 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:50:23.766555 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_alps__a_level_performance
[0m21:50:23.766714 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:50:23.766866 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:50:23.767125 [info ] [Thread-2 (]: 5 of 15 START sql view model analytics_staging.stg_prosolution__completion_status  [RUN]
[0m21:50:23.767298 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:50:23.767482 [info ] [Thread-4 (]: 6 of 15 START sql view model analytics_staging.stg_prosolution__course_header .. [RUN]
[0m21:50:23.767691 [info ] [Thread-3 (]: 7 of 15 START sql view model analytics_staging.stg_prosolution__enrolment ...... [RUN]
[0m21:50:23.767901 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_alps__btec_performance, now model.barton_peveril_analytics.stg_prosolution__completion_status)
[0m21:50:23.768064 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_staging.stg_prosolution__offering ....... [RUN]
[0m21:50:23.768206 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_mis_applications__student_extended_data, now model.barton_peveril_analytics.stg_prosolution__course_header)
[0m21:50:23.768353 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_focus__average_gcse, now model.barton_peveril_analytics.stg_prosolution__enrolment)
[0m21:50:23.768496 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:50:23.768631 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_alps__a_level_performance, now model.barton_peveril_analytics.stg_prosolution__offering)
[0m21:50:23.768755 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:50:23.768869 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:50:23.770430 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__completion_status"
[0m21:50:23.770563 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:50:23.771787 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__course_header"
[0m21:50:23.772946 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__enrolment"
[0m21:50:23.774365 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__offering"
[0m21:50:23.774894 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:50:23.775024 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:50:23.775156 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:50:23.775292 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:50:23.776365 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__offering"
[0m21:50:23.777421 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__completion_status"
[0m21:50:23.779000 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__course_header"
[0m21:50:23.779993 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__enrolment"
[0m21:50:23.780596 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_prosolution__enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__enrolment"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__enrolment`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`enrolment`

),

renamed as (

    select
        -- Primary key
        enrolment_id,

        -- Foreign keys
        student_id,
        offering_id,
        completion_status_id,

        -- Dates
        enrolment_date,
        expected_end_date,
        actual_end_date,

        -- Grade attributes
        nullif(trim(target_grade), '')                  as target_grade,
        nullif(trim(predicted_grade), '')              as predicted_grade,
        nullif(trim(actual_grade), '')                 as actual_grade,

        -- Attendance
        safe_cast(attendance_pct as numeric)           as attendance_pct,

        -- Status flag
        coalesce(is_current, false)                    as is_current,

        -- Derived status flags
        case
            when completion_status_id in (1, 2) then true
            else false
        end                                             as is_valid_completion,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:23.781144 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_prosolution__offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__offering"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering`

),

renamed as (

    select
        -- Primary key
        offering_id,

        -- Foreign keys
        course_header_id,
        offering_type_id,
        academic_year_id,

        -- Attributes
        code                                            as offering_code,
        name                                            as offering_name,
        qual_id                                         as qualification_id,
        study_year,
        duration                                        as duration_years,

        -- Derived: is this the final year of the programme?
        case
            when study_year = duration then true
            else false
        end                                             as is_final_year,

        -- Dates
        start_date,
        end_date,

        -- Flags
        coalesce(is_active, true)                       as is_active,

        -- Derived: filter out non-qualification offerings
        case
            when qual_id is null then false
            when lower(qual_id) like 'enrich%' then false
            when lower(qual_id) like 'zwr%' then false
            when lower(qual_id) like '%tutor%' then false
            else true
        end                                             as is_valid_qualification,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:23.781390 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:50:23.781588 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:50:23.800615 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_prosolution__completion_status: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__completion_status"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__completion_status`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`completion_status`

),

renamed as (

    select
        -- Primary key
        completion_status_id,

        -- Attributes
        name                                            as status_name,
        description                                     as status_description,

        -- Derived flags based on typical MIS status codes
        case
            when completion_status_id = 1 then true     -- Completed
            else false
        end                                             as is_completed,

        case
            when completion_status_id = 2 then true     -- Continuing
            else false
        end                                             as is_continuing,

        case
            when completion_status_id in (3, 4) then true  -- Withdrawn
            else false
        end                                             as is_withdrawn,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:23.800967 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_prosolution__course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__course_header"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`course_header`

),

renamed as (

    select
        -- Primary key
        course_header_id,

        -- Attributes
        code                                            as course_code,
        name                                            as course_name,
        description                                     as course_description,

        -- Classification
        subject_area,
        department,
        faculty,

        -- Flags
        coalesce(is_active, true)                       as is_active,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:23.820517 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:50:23.820753 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:50:25.133067 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:ae51aa5e-8408-4d52-adb2-58604e504bdf&page=queryresults
[0m21:50:25.160439 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:33eb74ff-9a8d-41e9-af8f-0eab03bdc6af&page=queryresults
[0m21:50:25.161257 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d110f493-f15e-40cb-8156-d5969221a3fc&page=queryresults
[0m21:50:25.432077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x159528680>]}
[0m21:50:25.432607 [info ] [Thread-1 (]: 8 of 15 OK created sql view model analytics_staging.stg_prosolution__offering .. [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m21:50:25.432943 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__offering
[0m21:50:25.433176 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:50:25.433485 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_staging.stg_prosolution__offering_type .. [RUN]
[0m21:50:25.433884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__offering, now model.barton_peveril_analytics.stg_prosolution__offering_type)
[0m21:50:25.434202 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:50:25.437107 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__offering_type"
[0m21:50:25.437948 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:50:25.439491 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__offering_type"
[0m21:50:25.440027 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_prosolution__offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__offering_type"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`offering_type`

),

renamed as (

    select
        -- Primary key
        offering_type_id,

        -- Attributes
        name                                            as offering_type_name,
        description                                     as offering_type_description,
        category                                        as offering_type_category,
        qualification_level,

        -- Derived grading scale
        case
            when offering_type_id in (1, 2) then 'A*-E'       -- A-Level
            when offering_type_id in (4, 8, 9) then 'D*-P'    -- BTEC
            else 'Other'
        end                                             as grading_scale,

        -- Classification flags
        case
            when offering_type_id in (1, 2) then true
            else false
        end                                             as is_academic,

        case
            when offering_type_id in (4, 8, 9) then true
            else false
        end                                             as is_vocational,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:25.440389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:50:25.471884 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15952ad20>]}
[0m21:50:25.473183 [info ] [Thread-2 (]: 5 of 15 OK created sql view model analytics_staging.stg_prosolution__completion_status  [[32mCREATE VIEW (0 processed)[0m in 1.70s]
[0m21:50:25.474382 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__completion_status
[0m21:50:25.474991 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_prosolution__student
[0m21:50:25.476040 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1595e4200>]}
[0m21:50:25.476307 [info ] [Thread-2 (]: 10 of 15 START sql view model analytics_staging.stg_prosolution__student ....... [RUN]
[0m21:50:25.477081 [info ] [Thread-4 (]: 6 of 15 OK created sql view model analytics_staging.stg_prosolution__course_header  [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m21:50:25.477459 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__completion_status, now model.barton_peveril_analytics.stg_prosolution__student)
[0m21:50:25.477691 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__course_header
[0m21:50:25.477833 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__student
[0m21:50:25.477985 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:50:25.479674 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__student"
[0m21:50:25.479915 [info ] [Thread-4 (]: 11 of 15 START sql view model analytics_staging.stg_prosolution__student_detail  [RUN]
[0m21:50:25.480155 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__course_header, now model.barton_peveril_analytics.stg_prosolution__student_detail)
[0m21:50:25.480295 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:50:25.481825 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_prosolution__student_detail"
[0m21:50:25.482105 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__student
[0m21:50:25.483556 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__student"
[0m21:50:25.483711 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:50:25.485841 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_prosolution__student_detail"
[0m21:50:25.486136 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_prosolution__student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__student"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student`

),

renamed as (

    select
        -- Primary key
        student_id,

        -- Identifiers
        uln,

        -- Personal information
        first_name,
        last_name,
        concat(first_name, ' ', last_name)              as full_name,
        email,

        -- Demographics
        date_of_birth,
        gender,
        ethnicity,

        -- Status
        coalesce(is_active, true)                       as is_active,

        -- Dates
        created_at,
        updated_at,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:25.486309 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:50:25.487214 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_prosolution__student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_prosolution__student_detail"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_prosolution`.`student_detail`

),

renamed as (

    select
        -- Primary key
        student_detail_id,

        -- Foreign keys
        student_id,
        academic_year_id,

        -- Location
        postcode,
        -- Extract postcode area (first part)
        split(postcode, ' ')[safe_offset(0)]           as postcode_area,

        -- SEND information
        lldd_code,
        coalesce(is_send, false)                        as is_send,
        coalesce(is_high_needs, false)                  as is_high_needs,
        primary_send_type,
        secondary_send_type,

        -- Disadvantage flags
        coalesce(is_free_meals, false)                  as is_free_meals,
        coalesce(is_bursary, false)                     as is_bursary,
        coalesce(is_lac, false)                         as is_lac,

        -- Metadata
        'prosolution'                                   as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from renamed;


[0m21:50:25.507083 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:50:26.074207 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:ea36ea26-aa29-4506-91ae-cb5e425fb4ac&page=queryresults
[0m21:50:26.338384 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158b06c30>]}
[0m21:50:26.338994 [info ] [Thread-3 (]: 7 of 15 OK created sql view model analytics_staging.stg_prosolution__enrolment . [[32mCREATE VIEW (0 processed)[0m in 2.57s]
[0m21:50:26.339449 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__enrolment
[0m21:50:26.339755 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:50:26.340202 [info ] [Thread-3 (]: 12 of 15 START sql view model analytics_staging.stg_six_dimensions__jedi ....... [RUN]
[0m21:50:26.340667 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__enrolment, now model.barton_peveril_analytics.stg_six_dimensions__jedi)
[0m21:50:26.340987 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:50:26.343818 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__jedi"
[0m21:50:26.345265 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:50:26.347351 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__jedi"
[0m21:50:26.347793 [debug] [Thread-3 (]: On model.barton_peveril_analytics.stg_six_dimensions__jedi: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__jedi"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`jedi_report`

),

cleaned as (

    select
        -- Keys
        jedi_report_id,
        academic_year                                   as academic_year_id,
        trim(report_type)                               as report_type,
        trim(dimension_name)                            as dimension_name,

        -- Groups
        trim(student_group)                             as student_group,
        trim(comparison_group)                          as comparison_group,

        -- Cohort metrics
        safe_cast(student_count as int64)               as student_count,
        safe_cast(comparison_count as int64)            as comparison_count,

        -- Grade point metrics
        safe_cast(student_avg_grade_points as numeric)  as student_avg_grade_points,
        safe_cast(comparison_avg_grade_points as numeric) as comparison_avg_grade_points,
        safe_cast(gap_grade_points as numeric)          as gap_grade_points,

        -- Significance and performance
        gap_significance,
        performance_band,

        -- Source metadata
        report_date,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:26.348073 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:50:26.375830 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:cc52413c-242a-49f6-96a9-1e7f14c240a7&page=queryresults
[0m21:50:26.645881 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:0222b677-4250-4684-bcb2-0bb0810a7fef&page=queryresults
[0m21:50:26.839041 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:705cc442-c7b0-4be5-9a01-ce93d608859a&page=queryresults
[0m21:50:26.885509 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a36c440>]}
[0m21:50:26.886133 [info ] [Thread-4 (]: 11 of 15 OK created sql view model analytics_staging.stg_prosolution__student_detail  [[32mCREATE VIEW (0 processed)[0m in 1.41s]
[0m21:50:26.886601 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__student_detail
[0m21:50:26.886917 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:50:26.887479 [info ] [Thread-4 (]: 13 of 15 START sql view model analytics_staging.stg_six_dimensions__sixth_sense  [RUN]
[0m21:50:26.887804 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__student_detail, now model.barton_peveril_analytics.stg_six_dimensions__sixth_sense)
[0m21:50:26.888072 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:50:26.891292 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"
[0m21:50:26.893275 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:50:26.895376 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"
[0m21:50:26.896240 [debug] [Thread-4 (]: On model.barton_peveril_analytics.stg_six_dimensions__sixth_sense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__sixth_sense"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`sixth_sense_report`

),

cleaned as (

    select
        -- Keys
        sixth_sense_id,
        academic_year                                   as academic_year_id,
        trim(subject_name)                              as subject_name,
        trim(qualification_type)                        as qualification_type,

        -- Cohort
        safe_cast(student_count as int64)               as cohort_count,

        -- Performance metrics
        safe_cast(completion_rate_pct as numeric)       as completion_rate_pct,
        safe_cast(retention_rate_pct as numeric)        as retention_rate_pct,
        safe_cast(achievement_rate_pct as numeric)      as achievement_rate_pct,
        safe_cast(pass_rate_pct as numeric)             as pass_rate_pct,
        safe_cast(high_grades_pct as numeric)           as high_grades_pct,
        safe_cast(attendance_rate_pct as numeric)       as attendance_rate_pct,

        -- National benchmarks
        safe_cast(national_completion_pct as numeric)   as national_completion_pct,
        safe_cast(national_achievement_pct as numeric)  as national_achievement_pct,
        safe_cast(national_pass_pct as numeric)         as national_pass_pct,

        -- Performance quartile
        performance_quartile,

        -- Source metadata
        report_date,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:26.896533 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:50:27.019093 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a358800>]}
[0m21:50:27.019559 [info ] [Thread-2 (]: 10 of 15 OK created sql view model analytics_staging.stg_prosolution__student .. [[32mCREATE VIEW (0 processed)[0m in 1.54s]
[0m21:50:27.019906 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__student
[0m21:50:27.020143 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:50:27.020463 [info ] [Thread-2 (]: 14 of 15 START sql view model analytics_staging.stg_six_dimensions__va ......... [RUN]
[0m21:50:27.020734 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__student, now model.barton_peveril_analytics.stg_six_dimensions__va)
[0m21:50:27.020932 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:50:27.022997 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__va"
[0m21:50:27.023418 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:50:27.025036 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__va"
[0m21:50:27.025428 [debug] [Thread-2 (]: On model.barton_peveril_analytics.stg_six_dimensions__va: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__va"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`va_report`

),

cleaned as (

    select
        -- Keys
        va_report_id,
        academic_year                                   as academic_year_id,
        trim(subject_name)                              as subject_name,
        trim(qualification_type)                        as qualification_type,

        -- Cohort
        safe_cast(student_count as int64)               as cohort_count,
        safe_cast(average_gcse_on_entry as numeric)     as average_gcse_on_entry,

        -- Value-added metrics
        safe_cast(value_added_score as numeric)         as value_added_score,
        safe_cast(residual_score as numeric)            as residual_score,
        expected_grade,
        actual_avg_grade,
        performance_band,

        -- Confidence intervals
        safe_cast(confidence_interval_lower as numeric) as confidence_interval_lower,
        safe_cast(confidence_interval_upper as numeric) as confidence_interval_upper,

        -- Source metadata
        report_date,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:27.025663 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:50:27.294392 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:42d9f4d6-c584-474b-b61a-6f4d327f9b5a&page=queryresults
[0m21:50:27.387497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a359e20>]}
[0m21:50:27.387906 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_staging.stg_prosolution__offering_type  [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m21:50:27.388222 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_prosolution__offering_type
[0m21:50:27.388431 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:50:27.388723 [info ] [Thread-1 (]: 15 of 15 START sql view model analytics_staging.stg_six_dimensions__vocational . [RUN]
[0m21:50:27.389010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.stg_prosolution__offering_type, now model.barton_peveril_analytics.stg_six_dimensions__vocational)
[0m21:50:27.389220 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:50:27.392328 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.stg_six_dimensions__vocational"
[0m21:50:27.392788 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:50:27.394324 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.stg_six_dimensions__vocational"
[0m21:50:27.394879 [debug] [Thread-1 (]: On model.barton_peveril_analytics.stg_six_dimensions__vocational: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.stg_six_dimensions__vocational"} */


  create or replace view `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`
  OPTIONS()
  as 

with source as (

    select * from `ra-warehouse-dev`.`analytics_seed_raw_six_dimensions`.`vocational_report`

),

cleaned as (

    select
        -- Keys
        vocational_report_id,
        academic_year                                   as academic_year_id,
        trim(subject_name)                              as subject_name,
        trim(qualification_type)                        as qualification_type,
        trim(qualification_size)                        as qualification_size,

        -- Cohort
        safe_cast(student_count as int64)               as cohort_count,
        safe_cast(average_gcse_on_entry as numeric)     as average_gcse_on_entry,

        -- Performance metrics
        safe_cast(completion_rate_pct as numeric)       as completion_rate_pct,
        safe_cast(achievement_rate_pct as numeric)      as achievement_rate_pct,
        safe_cast(pass_rate_pct as numeric)             as pass_rate_pct,

        -- Grade distribution (BTEC-style)
        safe_cast(distinction_star_pct as numeric)      as distinction_star_pct,
        safe_cast(distinction_pct as numeric)           as distinction_pct,
        safe_cast(merit_pct as numeric)                 as merit_pct,
        safe_cast(pass_pct as numeric)                  as pass_pct,
        safe_cast(near_pass_pct as numeric)             as near_pass_pct,
        safe_cast(fail_pct as numeric)                  as fail_pct,

        -- National benchmarks
        safe_cast(national_achievement_pct as numeric)  as national_achievement_pct,
        safe_cast(national_distinction_plus_pct as numeric) as national_distinction_plus_pct,

        -- Performance band
        performance_band,

        -- Source metadata
        report_date,

        -- Metadata
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from source

)

select * from cleaned;


[0m21:50:27.395320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:50:27.571693 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1595f0680>]}
[0m21:50:27.572064 [info ] [Thread-3 (]: 12 of 15 OK created sql view model analytics_staging.stg_six_dimensions__jedi .. [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m21:50:27.572313 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__jedi
[0m21:50:27.932970 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:993451ba-2662-4cca-9537-5650c121318d&page=queryresults
[0m21:50:27.975451 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:ff68d3d2-d842-4f5a-a2d9-d64cf71664f3&page=queryresults
[0m21:50:28.201549 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:9433b004-0dfb-4a19-8961-2b94cc2d25cb&page=queryresults
[0m21:50:28.217511 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1595e43b0>]}
[0m21:50:28.218029 [info ] [Thread-4 (]: 13 of 15 OK created sql view model analytics_staging.stg_six_dimensions__sixth_sense  [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m21:50:28.218448 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__sixth_sense
[0m21:50:28.345390 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a600c20>]}
[0m21:50:28.345896 [info ] [Thread-2 (]: 14 of 15 OK created sql view model analytics_staging.stg_six_dimensions__va .... [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m21:50:28.346276 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__va
[0m21:50:28.439006 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e49ca1c-ee7e-4211-876a-62337a16a360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a3549b0>]}
[0m21:50:28.439425 [info ] [Thread-1 (]: 15 of 15 OK created sql view model analytics_staging.stg_six_dimensions__vocational  [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m21:50:28.439750 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.stg_six_dimensions__vocational
[0m21:50:28.440676 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:50:28.441745 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:50:28.441958 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__vocational' was properly closed.
[0m21:50:28.442129 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__va' was properly closed.
[0m21:50:28.442282 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__jedi' was properly closed.
[0m21:50:28.442429 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.stg_six_dimensions__sixth_sense' was properly closed.
[0m21:50:28.442658 [info ] [MainThread]: 
[0m21:50:28.442854 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 11.59 seconds (11.59s).
[0m21:50:28.444210 [debug] [MainThread]: Command end result
[0m21:50:28.550405 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:50:28.551554 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:50:28.554323 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m21:50:28.554451 [info ] [MainThread]: 
[0m21:50:28.554593 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:50:28.554697 [info ] [MainThread]: 
[0m21:50:28.554806 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=15
[0m21:50:28.556993 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.770543, "process_in_blocks": "0", "process_kernel_time": 0.514808, "process_mem_max_rss": "393641984", "process_out_blocks": "0", "process_user_time": 5.057421}
[0m21:50:28.557150 [debug] [MainThread]: Command `dbt run` succeeded at 21:50:28.557120 after 13.77 seconds
[0m21:50:28.557275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071269c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108747bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108746c60>]}
[0m21:50:28.557396 [debug] [MainThread]: Flushing usage events
[0m21:50:29.324471 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:57:45.645418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bce060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f83d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f82330>]}


============================== 21:57:45.648584 | d9913c1f-7fb3-4c6e-b85a-ed48da261af2 ==============================
[0m21:57:45.648584 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:57:45.648876 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'invocation_command': 'dbt run --select intermediate --target dev', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'quiet': 'False', 'partial_parse': 'True', 'write_json': 'True', 'profiles_dir': '/Users/markrittman/.dbt', 'empty': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'static_parser': 'True', 'version_check': 'True', 'printer_width': '80', 'log_format': 'default', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m21:57:47.532303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103336270>]}
[0m21:57:47.553352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137bd0bc0>]}
[0m21:57:47.553680 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:57:47.662064 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:57:47.746131 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:57:47.746332 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:57:47.768249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ceed130>]}
[0m21:57:47.815886 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:57:47.817317 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:57:47.833152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16df28620>]}
[0m21:57:47.833396 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:57:47.833540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137af6ba0>]}
[0m21:57:47.834740 [info ] [MainThread]: 
[0m21:57:47.834878 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:47.834976 [info ] [MainThread]: 
[0m21:57:47.835168 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:57:47.836660 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:57:47.836812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:49.466602 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_integration)
[0m21:57:49.467151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:49.467550 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_six_dimensions'
[0m21:57:49.468889 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_prosolution'
[0m21:57:49.496143 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:49.496510 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics'
[0m21:57:49.496956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:49.518754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:50.464928 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics_staging)
[0m21:57:50.465647 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:50.588675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed)
[0m21:57:50.589529 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:50.617039 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m21:57:50.617884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:57:50.618582 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:50.618811 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:51.056894 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:57:51.061562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:51.762493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10351d640>]}
[0m21:57:51.762966 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:57:51.766193 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:57:51.766507 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:57:51.766799 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:57:51.767346 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:57:51.767149 [info ] [Thread-1 (]: 1 of 5 START sql view model analytics_integration.int_alps_performance_unioned . [RUN]
[0m21:57:51.767707 [info ] [Thread-2 (]: 2 of 5 START sql view model analytics_integration.int_six_dimensions_college_unioned  [RUN]
[0m21:57:51.767998 [info ] [Thread-3 (]: 3 of 5 START sql view model analytics_integration.int_six_dimensions_subject_unioned  [RUN]
[0m21:57:51.768262 [info ] [Thread-4 (]: 4 of 5 START sql view model analytics_integration.int_student_demographics_joined  [RUN]
[0m21:57:51.768545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now model.barton_peveril_analytics.int_alps_performance_unioned)
[0m21:57:51.768766 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now model.barton_peveril_analytics.int_six_dimensions_college_unioned)
[0m21:57:51.768972 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now model.barton_peveril_analytics.int_six_dimensions_subject_unioned)
[0m21:57:51.769173 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now model.barton_peveril_analytics.int_student_demographics_joined)
[0m21:57:51.769374 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:57:51.769550 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:57:51.769714 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:57:51.769880 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:57:51.776727 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m21:57:51.778669 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m21:57:51.781737 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m21:57:51.783684 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m21:57:51.784292 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:57:51.784516 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:57:51.790802 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:57:51.791000 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:57:51.800409 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m21:57:51.800870 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m21:57:51.802005 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m21:57:51.803018 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m21:57:51.803659 [debug] [Thread-4 (]: On model.barton_peveril_analytics.int_student_demographics_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_student_demographics_joined"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`
  OPTIONS()
  as with student_detail as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`

),

extended_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`

),

prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

joined as (

    select
        -- Keys
        sd.student_detail_id,
        sd.student_id,
        sd.academic_year_id,

        -- Core demographics from student_detail
        sd.gender_code,
        sd.gender,
        sd.date_of_birth,
        sd.ethnicity_code,
        sd.ethnicity_description,
        sd.ethnicity_group,
        sd.postcode,
        sd.postcode_area,
        sd.is_current,

        -- Extended demographics from MIS Applications
        coalesce(ed.is_disadvantaged, false)            as is_disadvantaged,
        coalesce(ed.is_sen, false)                      as is_sen,
        coalesce(ed.is_pp_or_fcm, false)                as is_pp_or_fcm,
        coalesce(ed.is_pupil_premium, false)            as is_pupil_premium,
        coalesce(ed.is_free_school_meals, false)        as is_free_school_meals,
        coalesce(ed.is_bursary_recipient, false)        as is_bursary_recipient,
        coalesce(ed.is_access_plus, false)              as is_access_plus,
        coalesce(ed.has_additional_adjustments, false)  as has_additional_adjustments,
        coalesce(ed.has_ehcp, false)                    as has_ehcp,
        coalesce(ed.is_lac, false)                      as is_lac,
        coalesce(ed.is_care_leaver, false)              as is_care_leaver,
        coalesce(ed.is_young_carer, false)              as is_young_carer,
        ed.sen_type,
        ed.bursary_type,

        -- Prior attainment from Focus
        pa.average_gcse_score,
        pa.prior_attainment_band,
        pa.prior_attainment_band_code,
        pa.gcse_english_grade,
        pa.gcse_maths_grade,
        pa.total_gcse_points,
        pa.gcse_count,

        -- Metadata
        sd.record_source,
        sd.loaded_at

    from student_detail sd
    left join extended_data ed
        on sd.student_detail_id = ed.student_detail_id
    left join prior_attainment pa
        on sd.student_id = pa.student_id

)

select * from joined;


[0m21:57:51.804020 [debug] [Thread-1 (]: On model.barton_peveril_analytics.int_alps_performance_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_alps_performance_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`
  OPTIONS()
  as with a_level as (

    select
        academic_year_id,
        alps_subject_name,
        'A-Level'                                       as qualification_type,
        null                                            as qualification_size,
        cohort_count,

        -- A-Level specific grade counts
        grade_a_star_count,
        grade_a_count,
        grade_b_count,
        grade_c_count,
        grade_d_count,
        grade_e_count,
        grade_u_count,

        -- A-Level specific grade percentages
        grade_a_star_pct,
        grade_a_pct,
        grade_b_pct,
        grade_c_pct,
        grade_d_pct,
        grade_e_pct,
        grade_u_pct,

        -- BTEC columns as NULL for A-Level
        cast(null as int64)                             as btec_distinction_star_count,
        cast(null as int64)                             as btec_distinction_count,
        cast(null as int64)                             as btec_merit_count,
        cast(null as int64)                             as btec_pass_count,
        cast(null as numeric)                           as btec_distinction_star_pct,
        cast(null as numeric)                           as btec_distinction_pct,
        cast(null as numeric)                           as btec_merit_pct,
        cast(null as numeric)                           as btec_pass_pct,

        -- Cumulative percentages
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) as a_star_to_a_pct,
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) + coalesce(grade_b_pct, 0) as a_star_to_b_pct,
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) + coalesce(grade_b_pct, 0) + coalesce(grade_c_pct, 0) as a_star_to_c_pct,
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) + coalesce(grade_b_pct, 0) + coalesce(grade_c_pct, 0) + coalesce(grade_d_pct, 0) + coalesce(grade_e_pct, 0) as a_star_to_e_pct,

        -- High grade (A*-B)
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) + coalesce(grade_b_pct, 0) as high_grade_pct,

        -- Pass rate (A*-E)
        coalesce(grade_a_star_pct, 0) + coalesce(grade_a_pct, 0) + coalesce(grade_b_pct, 0) + coalesce(grade_c_pct, 0) + coalesce(grade_d_pct, 0) + coalesce(grade_e_pct, 0) as pass_rate_pct,

        -- ALPS metrics
        alps_band,
        alps_score,
        t_score,
        average_grade_points,

        -- Source metadata
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`

),

btec as (

    select
        academic_year_id,
        alps_subject_name,
        'BTEC'                                          as qualification_type,
        qualification_size,
        cohort_count,

        -- A-Level columns as NULL for BTEC
        cast(null as int64)                             as grade_a_star_count,
        cast(null as int64)                             as grade_a_count,
        cast(null as int64)                             as grade_b_count,
        cast(null as int64)                             as grade_c_count,
        cast(null as int64)                             as grade_d_count,
        cast(null as int64)                             as grade_e_count,
        cast(null as int64)                             as grade_u_count,
        cast(null as numeric)                           as grade_a_star_pct,
        cast(null as numeric)                           as grade_a_pct,
        cast(null as numeric)                           as grade_b_pct,
        cast(null as numeric)                           as grade_c_pct,
        cast(null as numeric)                           as grade_d_pct,
        cast(null as numeric)                           as grade_e_pct,
        cast(null as numeric)                           as grade_u_pct,

        -- BTEC specific grade counts
        btec_distinction_star_count,
        btec_distinction_count,
        btec_merit_count,
        btec_pass_count,

        -- BTEC specific grade percentages
        btec_distinction_star_pct,
        btec_distinction_pct,
        btec_merit_pct,
        btec_pass_pct,

        -- Cumulative percentages (not applicable for BTEC)
        cast(null as numeric)                           as a_star_to_a_pct,
        cast(null as numeric)                           as a_star_to_b_pct,
        cast(null as numeric)                           as a_star_to_c_pct,
        cast(null as numeric)                           as a_star_to_e_pct,

        -- High grade (D*-M)
        coalesce(btec_distinction_star_pct, 0) + coalesce(btec_distinction_pct, 0) + coalesce(btec_merit_pct, 0) as high_grade_pct,

        -- Pass rate (D*-P)
        coalesce(btec_distinction_star_pct, 0) + coalesce(btec_distinction_pct, 0) + coalesce(btec_merit_pct, 0) + coalesce(btec_pass_pct, 0) as pass_rate_pct,

        -- ALPS metrics
        alps_band,
        alps_score,
        cast(null as numeric)                           as t_score,
        cast(null as numeric)                           as average_grade_points,

        -- Source metadata
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`

),

unioned as (

    select * from a_level
    union all
    select * from btec

)

select * from unioned;


[0m21:57:51.804353 [debug] [Thread-3 (]: On model.barton_peveril_analytics.int_six_dimensions_subject_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`
  OPTIONS()
  as with va_subject as (

    select
        academic_year_id,
        'VA'                                            as report_type,
        subject_name                                    as six_dimensions_subject_name,
        cast(null as string)                            as qualification_type,
        cohort_count,
        pass_rate_pct,
        high_grade_rate_pct,
        average_points                                  as average_grade_points,
        va_score,
        va_residual,
        va_band,
        va_percentile,
        va_confidence_lower,
        va_confidence_upper,
        cast(null as numeric)                           as national_pass_rate_pct,
        cast(null as numeric)                           as national_high_grade_pct,
        cast(null as numeric)                           as national_va_average,
        national_percentile                             as percentile_rank,
        national_rank                                   as subject_rank_national,
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    where level = 'Subject'
      and subject_name is not null

),

sixth_sense_subject as (

    select
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        pass_rate_pct,
        high_grade_rate_pct,
        average_points                                  as average_grade_points,
        va_score,
        cast(null as numeric)                           as va_residual,
        va_band,
        cast(null as numeric)                           as va_percentile,
        cast(null as numeric)                           as va_confidence_lower,
        cast(null as numeric)                           as va_confidence_upper,
        national_pass_rate_pct,
        national_high_grade_pct,
        cast(null as numeric)                           as national_va_average,
        percentile_rank,
        cast(null as int64)                             as subject_rank_national,
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    where level = 'Subject'
      and subject_name is not null

),

vocational_subject as (

    select
        academic_year_id,
        'Vocational'                                    as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        pass_rate_pct,
        high_grade_rate_pct,
        average_points                                  as average_grade_points,
        va_score,
        cast(null as numeric)                           as va_residual,
        va_band,
        cast(null as numeric)                           as va_percentile,
        cast(null as numeric)                           as va_confidence_lower,
        cast(null as numeric)                           as va_confidence_upper,
        national_pass_rate_pct,
        national_high_grade_pct,
        cast(null as numeric)                           as national_va_average,
        percentile_rank,
        cast(null as int64)                             as subject_rank_national,
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`
    where level = 'Subject'
      and subject_name is not null

),

unioned as (

    select * from va_subject
    union all
    select * from sixth_sense_subject
    union all
    select * from vocational_subject

)

select * from unioned;


[0m21:57:51.804617 [debug] [Thread-2 (]: On model.barton_peveril_analytics.int_six_dimensions_college_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_college_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`
  OPTIONS()
  as with va_college as (

    select
        academic_year_id,
        'VA'                                            as report_type,
        subject_name                                    as report_name,
        cohort_count                                    as total_cohort_count,
        pass_rate_pct,
        high_grade_rate_pct,
        average_points                                  as average_grade_points,
        cast(null as numeric)                           as average_ucas_points,
        va_score,
        va_band,
        va_confidence_lower,
        va_confidence_upper,
        va_percentile,
        national_rank                                   as va_national_rank,
        cast(null as numeric)                           as sixth_sense_score,
        cast(null as string)                            as sixth_sense_band,
        national_percentile                             as national_percentile_rank,
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    where level = 'College'

),

sixth_sense_college as (

    select
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        subject_name                                    as report_name,
        cohort_count                                    as total_cohort_count,
        pass_rate_pct,
        high_grade_rate_pct,
        average_points                                  as average_grade_points,
        cast(null as numeric)                           as average_ucas_points,
        va_score,
        va_band,
        cast(null as numeric)                           as va_confidence_lower,
        cast(null as numeric)                           as va_confidence_upper,
        cast(null as numeric)                           as va_percentile,
        cast(null as int64)                             as va_national_rank,
        sixth_sense_score,
        sixth_sense_band,
        percentile_rank                                 as national_percentile_rank,
        report_filename,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    where level = 'College'

),

unioned as (

    select * from va_college
    union all
    select * from sixth_sense_college

)

select * from unioned;


[0m21:57:51.804838 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:57:51.804995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:51.805144 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:57:51.805303 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:57:53.181691 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:de5f0446-b24e-4c34-9d87-e5c7f630a031&page=queryresults
[0m21:57:53.199367 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:7fa47a60-33a8-4110-ace0-283d3481ef91&page=queryresults
[0m21:57:53.316874 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:67673046-d758-4663-9bb3-2cf40f547eb8&page=queryresults
[0m21:57:53.324081 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2a02715c-4642-4f69-8aba-c87cc346874b&page=queryresults
[0m21:57:53.334009 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:de5f0446-b24e-4c34-9d87-e5c7f630a031&page=queryresults
[0m21:57:53.347152 [debug] [Thread-1 (]: Database Error in model int_alps_performance_unioned (models/intermediate/int_alps_performance_unioned.sql)
  Unrecognized name: grade_a_star_count at [16:9]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_alps_performance_unioned.sql
[0m21:57:53.348212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11034fa40>]}
[0m21:57:53.348507 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model analytics_integration.int_alps_performance_unioned  [[31mERROR[0m in 1.58s]
[0m21:57:53.348724 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:57:53.348914 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.int_alps_performance_unioned' to be skipped because of status 'error'.  Reason: Database Error in model int_alps_performance_unioned (models/intermediate/int_alps_performance_unioned.sql)
  Unrecognized name: grade_a_star_count at [16:9]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_alps_performance_unioned.sql.
[0m21:57:53.362338 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:7fa47a60-33a8-4110-ace0-283d3481ef91&page=queryresults
[0m21:57:53.365096 [debug] [Thread-2 (]: Database Error in model int_six_dimensions_college_unioned (models/intermediate/int_six_dimensions_college_unioned.sql)
  Unrecognized name: level at [32:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_college_unioned.sql
[0m21:57:53.365332 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e9a76e0>]}
[0m21:57:53.365584 [error] [Thread-2 (]: 2 of 5 ERROR creating sql view model analytics_integration.int_six_dimensions_college_unioned  [[31mERROR[0m in 1.60s]
[0m21:57:53.365789 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:57:53.365963 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.int_six_dimensions_college_unioned' to be skipped because of status 'error'.  Reason: Database Error in model int_six_dimensions_college_unioned (models/intermediate/int_six_dimensions_college_unioned.sql)
  Unrecognized name: level at [32:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_college_unioned.sql.
[0m21:57:53.459507 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2a02715c-4642-4f69-8aba-c87cc346874b&page=queryresults
[0m21:57:53.462788 [debug] [Thread-4 (]: Database Error in model int_student_demographics_joined (models/intermediate/int_student_demographics_joined.sql)
  Name student_detail_id not found inside ed at [74:38]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_student_demographics_joined.sql
[0m21:57:53.463028 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e9595b0>]}
[0m21:57:53.463330 [error] [Thread-4 (]: 4 of 5 ERROR creating sql view model analytics_integration.int_student_demographics_joined  [[31mERROR[0m in 1.69s]
[0m21:57:53.463574 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:57:53.463783 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.int_student_demographics_joined' to be skipped because of status 'error'.  Reason: Database Error in model int_student_demographics_joined (models/intermediate/int_student_demographics_joined.sql)
  Name student_detail_id not found inside ed at [74:38]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_student_demographics_joined.sql.
[0m21:57:53.464063 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_enrolment_with_context
[0m21:57:53.464239 [info ] [Thread-1 (]: 5 of 5 SKIP relation analytics_integration.int_enrolment_with_context .......... [[33mSKIP[0m]
[0m21:57:53.464413 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_enrolment_with_context
[0m21:57:53.702162 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:67673046-d758-4663-9bb3-2cf40f547eb8&page=queryresults
[0m21:57:53.705968 [debug] [Thread-3 (]: Database Error in model int_six_dimensions_subject_unioned (models/intermediate/int_six_dimensions_subject_unioned.sql)
  Unrecognized name: level at [34:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_subject_unioned.sql
[0m21:57:53.706285 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9913c1f-7fb3-4c6e-b85a-ed48da261af2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e91fce0>]}
[0m21:57:53.706624 [error] [Thread-3 (]: 3 of 5 ERROR creating sql view model analytics_integration.int_six_dimensions_subject_unioned  [[31mERROR[0m in 1.94s]
[0m21:57:53.706890 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:57:53.707115 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.int_six_dimensions_subject_unioned' to be skipped because of status 'error'.  Reason: Database Error in model int_six_dimensions_subject_unioned (models/intermediate/int_six_dimensions_subject_unioned.sql)
  Unrecognized name: level at [34:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_subject_unioned.sql.
[0m21:57:53.709649 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:57:53.710536 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:53.710708 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_alps_performance_unioned' was properly closed.
[0m21:57:53.710847 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_six_dimensions_college_unioned' was properly closed.
[0m21:57:53.710972 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_six_dimensions_subject_unioned' was properly closed.
[0m21:57:53.711090 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_student_demographics_joined' was properly closed.
[0m21:57:53.711270 [info ] [MainThread]: 
[0m21:57:53.711423 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 5.88 seconds (5.88s).
[0m21:57:53.711927 [debug] [MainThread]: Command end result
[0m21:57:53.739262 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:57:53.740356 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:57:53.743283 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m21:57:53.743422 [info ] [MainThread]: 
[0m21:57:53.743563 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m21:57:53.743669 [info ] [MainThread]: 
[0m21:57:53.743800 [error] [MainThread]: [31mFailure in model int_alps_performance_unioned (models/intermediate/int_alps_performance_unioned.sql)[0m
[0m21:57:53.743943 [error] [MainThread]:   Database Error in model int_alps_performance_unioned (models/intermediate/int_alps_performance_unioned.sql)
  Unrecognized name: grade_a_star_count at [16:9]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_alps_performance_unioned.sql
[0m21:57:53.744036 [info ] [MainThread]: 
[0m21:57:53.744149 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/intermediate/int_alps_performance_unioned.sql
[0m21:57:53.744241 [info ] [MainThread]: 
[0m21:57:53.744352 [error] [MainThread]: [31mFailure in model int_six_dimensions_college_unioned (models/intermediate/int_six_dimensions_college_unioned.sql)[0m
[0m21:57:53.744467 [error] [MainThread]:   Database Error in model int_six_dimensions_college_unioned (models/intermediate/int_six_dimensions_college_unioned.sql)
  Unrecognized name: level at [32:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_college_unioned.sql
[0m21:57:53.744555 [info ] [MainThread]: 
[0m21:57:53.744661 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/intermediate/int_six_dimensions_college_unioned.sql
[0m21:57:53.744748 [info ] [MainThread]: 
[0m21:57:53.744860 [error] [MainThread]: [31mFailure in model int_student_demographics_joined (models/intermediate/int_student_demographics_joined.sql)[0m
[0m21:57:53.744974 [error] [MainThread]:   Database Error in model int_student_demographics_joined (models/intermediate/int_student_demographics_joined.sql)
  Name student_detail_id not found inside ed at [74:38]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_student_demographics_joined.sql
[0m21:57:53.745062 [info ] [MainThread]: 
[0m21:57:53.745172 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/intermediate/int_student_demographics_joined.sql
[0m21:57:53.745261 [info ] [MainThread]: 
[0m21:57:53.745374 [error] [MainThread]: [31mFailure in model int_six_dimensions_subject_unioned (models/intermediate/int_six_dimensions_subject_unioned.sql)[0m
[0m21:57:53.745490 [error] [MainThread]:   Database Error in model int_six_dimensions_subject_unioned (models/intermediate/int_six_dimensions_subject_unioned.sql)
  Unrecognized name: level at [34:11]
  compiled code at target/run/barton_peveril_analytics/models/intermediate/int_six_dimensions_subject_unioned.sql
[0m21:57:53.745579 [info ] [MainThread]: 
[0m21:57:53.745684 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/intermediate/int_six_dimensions_subject_unioned.sql
[0m21:57:53.745771 [info ] [MainThread]: 
[0m21:57:53.745880 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=5
[0m21:57:53.748499 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.143355, "process_in_blocks": "0", "process_kernel_time": 0.447994, "process_mem_max_rss": "376619008", "process_out_blocks": "0", "process_user_time": 3.363347}
[0m21:57:53.748681 [debug] [MainThread]: Command `dbt run` failed at 21:57:53.748649 after 8.14 seconds
[0m21:57:53.748825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004decf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106223aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e99af90>]}
[0m21:57:53.748956 [debug] [MainThread]: Flushing usage events
[0m21:57:55.786414 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:59:54.218664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d450d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f9b6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e4d520>]}


============================== 21:59:54.221153 | c97c738c-7b86-432e-a5c4-8f84711b5719 ==============================
[0m21:59:54.221153 [info ] [MainThread]: Running with dbt=1.10.15
[0m21:59:54.221398 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate --target dev', 'no_print': 'None', 'use_colors': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'empty': 'False', 'static_parser': 'True', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'debug': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/markrittman/.dbt', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default'}
[0m21:59:55.793124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110806060>]}
[0m21:59:55.813714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1445a01d0>]}
[0m21:59:55.814027 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m21:59:55.916193 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m21:59:55.998935 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m21:59:55.999372 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/intermediate/int_enrolment_with_context.sql
[0m21:59:55.999528 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/intermediate/int_six_dimensions_college_unioned.sql
[0m21:59:55.999661 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/intermediate/int_student_demographics_joined.sql
[0m21:59:55.999784 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/intermediate/int_six_dimensions_subject_unioned.sql
[0m21:59:55.999908 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/intermediate/int_alps_performance_unioned.sql
[0m21:59:56.115645 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `accepted_values`. Arguments to generic tests
should be nested under the `arguments` property.`
[0m21:59:56.115924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146887b60>]}
[0m21:59:56.163958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146d38080>]}
[0m21:59:56.216630 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m21:59:56.218315 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m21:59:56.233941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145513b60>]}
[0m21:59:56.234170 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m21:59:56.234297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e53590>]}
[0m21:59:56.235448 [info ] [MainThread]: 
[0m21:59:56.235572 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:59:56.235658 [info ] [MainThread]: 
[0m21:59:56.235830 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:59:56.237403 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m21:59:56.237612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:57.043755 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m21:59:57.044379 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:57.046151 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_prosolution'
[0m21:59:57.046406 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:57.079238 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_alps'
[0m21:59:57.099665 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed'
[0m21:59:57.099841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:57.100194 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:57.654113 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now list_ra-warehouse-dev_analytics_integration)
[0m21:59:57.654563 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:57.796305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m21:59:57.796778 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:57.824110 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_staging)
[0m21:59:57.824661 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:58.030634 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m21:59:58.031951 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:58.055264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now list_ra-warehouse-dev_analytics)
[0m21:59:58.055710 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:58.495882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601d7f0>]}
[0m21:59:58.496375 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:59:58.499912 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:59:58.500195 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:59:58.500556 [info ] [Thread-1 (]: 1 of 5 START sql view model analytics_integration.int_alps_performance_unioned . [RUN]
[0m21:59:58.500838 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:59:58.501140 [info ] [Thread-2 (]: 2 of 5 START sql view model analytics_integration.int_six_dimensions_college_unioned  [RUN]
[0m21:59:58.501451 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:59:58.501799 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now model.barton_peveril_analytics.int_alps_performance_unioned)
[0m21:59:58.502157 [info ] [Thread-3 (]: 3 of 5 START sql view model analytics_integration.int_six_dimensions_subject_unioned  [RUN]
[0m21:59:58.502452 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now model.barton_peveril_analytics.int_six_dimensions_college_unioned)
[0m21:59:58.502746 [info ] [Thread-4 (]: 4 of 5 START sql view model analytics_integration.int_student_demographics_joined  [RUN]
[0m21:59:58.503005 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:59:58.503225 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now model.barton_peveril_analytics.int_six_dimensions_subject_unioned)
[0m21:59:58.503429 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:59:58.503625 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now model.barton_peveril_analytics.int_student_demographics_joined)
[0m21:59:58.509463 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m21:59:58.509714 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:59:58.511848 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m21:59:58.512048 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:59:58.514431 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m21:59:58.516684 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m21:59:58.517075 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:59:58.517258 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:59:58.517427 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:59:58.517575 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m21:59:58.533222 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m21:59:58.533467 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m21:59:58.534616 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m21:59:58.535601 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m21:59:58.536241 [debug] [Thread-1 (]: On model.barton_peveril_analytics.int_alps_performance_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_alps_performance_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`
  OPTIONS()
  as with a_level as (

    select
        alps_report_id                                  as report_id,
        academic_year_id,
        alps_subject_name,
        'A-Level'                                       as qualification_type,
        cast(null as string)                            as qualification_size,
        cohort_count,
        average_gcse_on_entry,

        -- ALPS metrics
        alps_band,
        alps_score,
        value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        pass_rate_pct,
        high_grades_pct,

        -- Source metadata
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`

),

btec as (

    select
        alps_btec_report_id                             as report_id,
        academic_year_id,
        alps_subject_name,
        qualification_type,
        cast(null as string)                            as qualification_size,
        cohort_count,
        average_gcse_on_entry,

        -- ALPS metrics
        alps_band,
        alps_score,
        value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        pass_rate_pct,
        high_grades_pct,

        -- Source metadata
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`

),

unioned as (

    select * from a_level
    union all
    select * from btec

)

select * from unioned;


[0m21:59:58.536580 [debug] [Thread-3 (]: On model.barton_peveril_analytics.int_six_dimensions_subject_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`
  OPTIONS()
  as with va_subject as (

    select
        va_report_id                                    as report_id,
        academic_year_id,
        'VA'                                            as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        average_gcse_on_entry,
        value_added_score,
        residual_score,
        expected_grade,
        actual_avg_grade,
        performance_band,
        confidence_interval_lower,
        confidence_interval_upper,
        cast(null as numeric)                           as pass_rate_pct,
        cast(null as numeric)                           as high_grades_pct,
        cast(null as numeric)                           as completion_rate_pct,
        cast(null as numeric)                           as achievement_rate_pct,
        cast(null as string)                            as performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    where subject_name is not null

),

sixth_sense_subject as (

    select
        sixth_sense_id                                  as report_id,
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        cast(null as numeric)                           as average_gcse_on_entry,
        cast(null as numeric)                           as value_added_score,
        cast(null as numeric)                           as residual_score,
        cast(null as string)                            as expected_grade,
        cast(null as string)                            as actual_avg_grade,
        cast(null as string)                            as performance_band,
        cast(null as numeric)                           as confidence_interval_lower,
        cast(null as numeric)                           as confidence_interval_upper,
        pass_rate_pct,
        high_grades_pct,
        completion_rate_pct,
        achievement_rate_pct,
        performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    where subject_name is not null

),

vocational_subject as (

    select
        vocational_report_id                            as report_id,
        academic_year_id,
        'Vocational'                                    as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        average_gcse_on_entry,
        cast(null as numeric)                           as value_added_score,
        cast(null as numeric)                           as residual_score,
        cast(null as string)                            as expected_grade,
        cast(null as string)                            as actual_avg_grade,
        performance_band,
        cast(null as numeric)                           as confidence_interval_lower,
        cast(null as numeric)                           as confidence_interval_upper,
        pass_rate_pct,
        cast(null as numeric)                           as high_grades_pct,
        completion_rate_pct,
        achievement_rate_pct,
        cast(null as string)                            as performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`
    where subject_name is not null

),

unioned as (

    select * from va_subject
    union all
    select * from sixth_sense_subject
    union all
    select * from vocational_subject

)

select * from unioned;


[0m21:59:58.536835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:59:58.537045 [debug] [Thread-2 (]: On model.barton_peveril_analytics.int_six_dimensions_college_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_college_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`
  OPTIONS()
  as with va_aggregated as (

    select
        academic_year_id,
        'VA'                                            as report_type,
        'College Overall'                               as report_name,
        sum(cohort_count)                               as total_cohort_count,
        avg(value_added_score)                          as avg_value_added_score,
        avg(confidence_interval_lower)                  as avg_confidence_lower,
        avg(confidence_interval_upper)                  as avg_confidence_upper,
        min(report_date)                                as report_date,
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    group by academic_year_id

),

sixth_sense_aggregated as (

    select
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        'College Overall'                               as report_name,
        sum(cohort_count)                               as total_cohort_count,
        avg(pass_rate_pct)                              as avg_pass_rate_pct,
        avg(high_grades_pct)                            as avg_high_grades_pct,
        avg(completion_rate_pct)                        as avg_completion_rate_pct,
        avg(retention_rate_pct)                         as avg_retention_rate_pct,
        avg(achievement_rate_pct)                       as avg_achievement_rate_pct,
        avg(attendance_rate_pct)                        as avg_attendance_rate_pct,
        min(report_date)                                as report_date,
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    group by academic_year_id

),

unioned as (

    select
        academic_year_id,
        report_type,
        report_name,
        total_cohort_count,
        cast(null as numeric) as avg_pass_rate_pct,
        cast(null as numeric) as avg_high_grades_pct,
        avg_value_added_score,
        avg_confidence_lower,
        avg_confidence_upper,
        cast(null as numeric) as avg_completion_rate_pct,
        cast(null as numeric) as avg_retention_rate_pct,
        cast(null as numeric) as avg_achievement_rate_pct,
        cast(null as numeric) as avg_attendance_rate_pct,
        report_date,
        record_source,
        loaded_at
    from va_aggregated

    union all

    select
        academic_year_id,
        report_type,
        report_name,
        total_cohort_count,
        avg_pass_rate_pct,
        avg_high_grades_pct,
        cast(null as numeric) as avg_value_added_score,
        cast(null as numeric) as avg_confidence_lower,
        cast(null as numeric) as avg_confidence_upper,
        avg_completion_rate_pct,
        avg_retention_rate_pct,
        avg_achievement_rate_pct,
        avg_attendance_rate_pct,
        report_date,
        record_source,
        loaded_at
    from sixth_sense_aggregated

)

select * from unioned;


[0m21:59:58.537250 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:59:58.538161 [debug] [Thread-4 (]: On model.barton_peveril_analytics.int_student_demographics_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_student_demographics_joined"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`
  OPTIONS()
  as with student as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`

),

student_detail as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`

),

extended_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`

),

prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

joined as (

    select
        -- Keys
        sd.student_detail_id,
        sd.student_id,
        sd.academic_year_id,

        -- Core demographics from student master
        s.first_name,
        s.last_name,
        s.full_name,
        s.date_of_birth,
        s.gender,
        s.ethnicity,
        s.is_active,

        -- Location from student_detail
        sd.postcode,
        sd.postcode_area,

        -- SEND flags from student_detail
        sd.lldd_code,
        sd.is_send,
        sd.is_high_needs,
        sd.primary_send_type,
        sd.secondary_send_type,

        -- Disadvantage flags from student_detail
        sd.is_free_meals,
        sd.is_bursary,
        sd.is_lac,

        -- Extended demographics from MIS Applications
        ed.nationality,
        ed.country_of_birth,
        ed.first_language,
        ed.religion,
        coalesce(ed.is_young_carer, false)              as is_young_carer,
        coalesce(ed.is_parent_carer, false)             as is_parent_carer,
        ed.care_leaver_status,
        ed.household_situation,
        ed.imd_decile,
        ed.polar4_quintile,
        ed.tundra_classification,

        -- Prior attainment from Focus
        pa.average_gcse_score,
        pa.prior_attainment_band,
        pa.prior_attainment_band_code,
        pa.gcse_english_grade,
        pa.gcse_maths_grade,
        pa.gcse_count,

        -- Metadata
        sd.record_source,
        sd.loaded_at

    from student_detail sd
    inner join student s
        on sd.student_id = s.student_id
    left join extended_data ed
        on sd.student_id = ed.student_id
        and sd.academic_year_id = ed.academic_year_id
    left join prior_attainment pa
        on sd.student_id = pa.student_id
        and sd.academic_year_id = pa.academic_year_id

)

select * from joined;


[0m21:59:58.577257 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:59:58.577595 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:59:59.458883 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:94441af2-ab5a-4133-bca6-e98086b7e161&page=queryresults
[0m21:59:59.480051 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:159b3924-2905-4621-bc24-c24783575f20&page=queryresults
[0m21:59:59.553953 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:4364af15-bf74-4204-8cf7-6ce9e780e904&page=queryresults
[0m21:59:59.570334 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:786042ae-6845-4b52-8cb9-cde963f0f860&page=queryresults
[0m21:59:59.723640 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fc08c0>]}
[0m21:59:59.723856 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f69670>]}
[0m21:59:59.724177 [info ] [Thread-1 (]: 1 of 5 OK created sql view model analytics_integration.int_alps_performance_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m21:59:59.724503 [info ] [Thread-2 (]: 2 of 5 OK created sql view model analytics_integration.int_six_dimensions_college_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m21:59:59.724775 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m21:59:59.724996 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m21:59:59.792120 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f8aed0>]}
[0m21:59:59.792598 [info ] [Thread-4 (]: 4 of 5 OK created sql view model analytics_integration.int_student_demographics_joined  [[32mCREATE VIEW (0 processed)[0m in 1.29s]
[0m21:59:59.792941 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.int_student_demographics_joined
[0m21:59:59.793247 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_enrolment_with_context
[0m21:59:59.793549 [info ] [Thread-1 (]: 5 of 5 START sql view model analytics_integration.int_enrolment_with_context ... [RUN]
[0m21:59:59.793760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.int_alps_performance_unioned, now model.barton_peveril_analytics.int_enrolment_with_context)
[0m21:59:59.793931 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.int_enrolment_with_context
[0m21:59:59.797347 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_enrolment_with_context"
[0m21:59:59.797842 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.int_enrolment_with_context
[0m21:59:59.799241 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_enrolment_with_context"
[0m21:59:59.799746 [debug] [Thread-1 (]: On model.barton_peveril_analytics.int_enrolment_with_context: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_enrolment_with_context"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`
  OPTIONS()
  as with enrolment as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__enrolment`
    where is_valid_completion = true

),

offering as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where is_valid_qualification = true

),

offering_type as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`

),

course_header as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`

),

completion_status as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__completion_status`

),

student_demographics as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`

),

enriched as (

    select
        -- Enrolment keys
        e.enrolment_id,
        e.offering_id,
        e.student_id,

        -- Offering context
        o.course_header_id,
        o.offering_type_id,
        o.academic_year_id,
        o.offering_code,
        o.offering_name,
        o.qualification_id,
        o.study_year,
        o.duration_years,
        o.is_final_year,

        -- Offering type context
        ot.offering_type_name,
        ot.offering_type_category,
        ot.grading_scale,
        ot.is_academic,
        ot.is_vocational,

        -- Course header context
        ch.course_code,
        ch.course_name,
        ch.subject_area,
        ch.department,

        -- Completion status
        e.completion_status_id,
        cs.status_name                                  as completion_status,
        cs.is_completed,
        cs.is_continuing,
        cs.is_withdrawn,

        -- Grade
        e.actual_grade                                  as grade,
        e.target_grade,
        e.predicted_grade,

        -- Attendance
        e.attendance_pct,

        -- Dates
        e.enrolment_date,
        e.expected_end_date,
        e.actual_end_date,

        -- A-Level grade flags
        case when ot.is_academic and e.actual_grade = 'A*' then 1 else 0 end as is_grade_a_star,
        case when ot.is_academic and e.actual_grade = 'A' then 1 else 0 end as is_grade_a,
        case when ot.is_academic and e.actual_grade = 'B' then 1 else 0 end as is_grade_b,
        case when ot.is_academic and e.actual_grade = 'C' then 1 else 0 end as is_grade_c,
        case when ot.is_academic and e.actual_grade = 'D' then 1 else 0 end as is_grade_d,
        case when ot.is_academic and e.actual_grade = 'E' then 1 else 0 end as is_grade_e,
        case when ot.is_academic and e.actual_grade = 'U' then 1 else 0 end as is_grade_u,

        -- BTEC grade flags
        case when ot.is_vocational and e.actual_grade = 'D*' then 1 else 0 end as is_grade_distinction_star,
        case when ot.is_vocational and e.actual_grade = 'D' then 1 else 0 end as is_grade_distinction,
        case when ot.is_vocational and e.actual_grade = 'M' then 1 else 0 end as is_grade_merit,
        case when ot.is_vocational and e.actual_grade = 'P' then 1 else 0 end as is_grade_pass,

        -- High grade flag (depends on qualification type)
        case
            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B') then 1
            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M') then 1
            else 0
        end                                             as is_high_grade,

        -- Pass flag
        case
            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B', 'C', 'D', 'E') then 1
            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M', 'P') then 1
            else 0
        end                                             as is_pass,

        -- Student demographics
        sd.student_detail_id,
        sd.full_name                                    as student_name,
        sd.gender,
        sd.ethnicity,
        sd.is_send,
        sd.is_free_meals,
        sd.is_bursary,
        sd.is_lac,
        sd.is_young_carer,

        -- Prior attainment
        sd.average_gcse_score,
        sd.prior_attainment_band,
        sd.prior_attainment_band_code,

        -- Counting measure
        1                                               as enrolment_count,

        -- Metadata
        e.record_source,
        e.loaded_at

    from enrolment e
    inner join offering o
        on e.offering_id = o.offering_id
    inner join offering_type ot
        on o.offering_type_id = ot.offering_type_id
    inner join course_header ch
        on o.course_header_id = ch.course_header_id
    left join completion_status cs
        on e.completion_status_id = cs.completion_status_id
    left join student_demographics sd
        on e.student_id = sd.student_id
        and o.academic_year_id = sd.academic_year_id

    -- Filter to final year only (where results are awarded)
    where o.is_final_year = true

)

select * from enriched;


[0m21:59:59.800053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:59:59.825681 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fa6000>]}
[0m21:59:59.826021 [info ] [Thread-3 (]: 3 of 5 OK created sql view model analytics_integration.int_six_dimensions_subject_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m21:59:59.826239 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m22:00:00.677764 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:7dad556e-6baa-4520-91c4-565c955907c0&page=queryresults
[0m22:00:00.889769 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c97c738c-7b86-432e-a5c4-8f84711b5719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fafe90>]}
[0m22:00:00.890374 [info ] [Thread-1 (]: 5 of 5 OK created sql view model analytics_integration.int_enrolment_with_context  [[32mCREATE VIEW (0 processed)[0m in 1.10s]
[0m22:00:00.890839 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_enrolment_with_context
[0m22:00:00.891910 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:00:00.893101 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:00:00.893331 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_enrolment_with_context' was properly closed.
[0m22:00:00.893516 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_six_dimensions_college_unioned' was properly closed.
[0m22:00:00.893687 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_six_dimensions_subject_unioned' was properly closed.
[0m22:00:00.893855 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_student_demographics_joined' was properly closed.
[0m22:00:00.894102 [info ] [MainThread]: 
[0m22:00:00.894314 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 4.66 seconds (4.66s).
[0m22:00:00.895089 [debug] [MainThread]: Command end result
[0m22:00:01.004906 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:00:01.005911 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:00:01.007994 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m22:00:01.008112 [info ] [MainThread]: 
[0m22:00:01.008264 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:00:01.008370 [info ] [MainThread]: 
[0m22:00:01.008478 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m22:00:01.008657 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:00:01.011587 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.825845, "process_in_blocks": "0", "process_kernel_time": 0.431463, "process_mem_max_rss": "398491648", "process_out_blocks": "0", "process_user_time": 3.332127}
[0m22:00:01.011766 [debug] [MainThread]: Command `dbt run` succeeded at 22:00:01.011735 after 6.83 seconds
[0m22:00:01.011903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110510440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d626f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8a150>]}
[0m22:00:01.012023 [debug] [MainThread]: Flushing usage events
[0m22:00:02.031019 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:00:09.088394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106906090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10701a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10701aff0>]}


============================== 22:00:09.090630 | f83c274e-c199-4e94-9a8a-1646f1d17080 ==============================
[0m22:00:09.090630 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:00:09.090879 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_format': 'default', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'printer_width': '80', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'write_json': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select marts --target dev', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'profiles_dir': '/Users/markrittman/.dbt'}
[0m22:00:10.491748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043de630>]}
[0m22:00:10.512290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15de7f620>]}
[0m22:00:10.512656 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m22:00:10.620180 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m22:00:10.702619 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:00:10.702841 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:00:10.724751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fd1ffe0>]}
[0m22:00:10.771674 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:00:10.772875 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:00:10.789803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fd268d0>]}
[0m22:00:10.790042 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m22:00:10.790179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fd504a0>]}
[0m22:00:10.791518 [info ] [MainThread]: 
[0m22:00:10.791681 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:00:10.791785 [info ] [MainThread]: 
[0m22:00:10.791987 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:00:10.793783 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m22:00:10.793951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:11.465254 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_staging)
[0m22:00:11.465719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:11.466100 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_mis_applications'
[0m22:00:11.494959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:11.495233 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_focus'
[0m22:00:11.496357 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_alps'
[0m22:00:11.496526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:11.517842 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:12.078152 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_integration)
[0m22:00:12.079366 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now list_ra-warehouse-dev_analytics)
[0m22:00:12.081979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:12.083808 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m22:00:12.084707 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m22:00:12.084855 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:12.113629 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:12.114008 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:12.631051 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed)
[0m22:00:12.632129 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:13.229754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fd78c50>]}
[0m22:00:13.230123 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:00:13.232855 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_academic_year
[0m22:00:13.233146 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_course_header
[0m22:00:13.233487 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics.dim_academic_year ...................... [RUN]
[0m22:00:13.233883 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_grade
[0m22:00:13.234124 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_offering
[0m22:00:13.234388 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics.dim_course_header ...................... [RUN]
[0m22:00:13.234655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now model.barton_peveril_analytics.dim_academic_year)
[0m22:00:13.234907 [info ] [Thread-3 (]: 3 of 13 START sql table model analytics.dim_grade .............................. [RUN]
[0m22:00:13.235151 [info ] [Thread-4 (]: 4 of 13 START sql table model analytics.dim_offering ........................... [RUN]
[0m22:00:13.235379 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now model.barton_peveril_analytics.dim_course_header)
[0m22:00:13.235583 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_academic_year
[0m22:00:13.235773 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now model.barton_peveril_analytics.dim_grade)
[0m22:00:13.235970 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now model.barton_peveril_analytics.dim_offering)
[0m22:00:13.236158 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_course_header
[0m22:00:13.243101 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:00:13.243420 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_grade
[0m22:00:13.243653 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_offering
[0m22:00:13.245995 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_course_header"
[0m22:00:13.247654 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_grade"
[0m22:00:13.248973 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering"
[0m22:00:13.249769 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_academic_year
[0m22:00:13.249955 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_grade
[0m22:00:13.250132 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_course_header
[0m22:00:13.256579 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_offering
[0m22:00:13.271832 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_grade"
[0m22:00:13.273264 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:00:13.274345 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_course_header"
[0m22:00:13.275568 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering"
[0m22:00:13.276165 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_course_header"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_course_header`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(course_header_id as string), '_dbt_null_')
                
            
        )
    )
 as course_header_key,

        -- Natural key
        course_header_id,

        -- Attributes
        course_code,
        course_name,
        subject_area,
        department,
        is_active,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:00:13.276377 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_grade: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_grade"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_grade`
      
    
    

    
    OPTIONS()
    as (
      with grade_points as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_grade_points`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(grade as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as grade_key,

        -- Natural key
        grade,
        qualification_type as grading_scale,

        -- Point values
        ucas_points,
        grade_points,
        grade_sort_order,

        -- Grade classification flags
        is_high_grade,
        is_pass as is_pass_grade,

        -- Cumulative grade flags (A-Level specific)
        case when grade in ('A*', 'A') then true else false end as is_grade_a_star_to_a,
        case when grade in ('A*', 'A', 'B') then true else false end as is_grade_a_star_to_b,
        case when grade in ('A*', 'A', 'B', 'C') then true else false end as is_grade_a_star_to_c,
        case when grade in ('A*', 'A', 'B', 'C', 'D', 'E') then true else false end as is_grade_a_star_to_e,

        -- Metadata
        'seed' as record_source,
        current_timestamp() as loaded_at

    from grade_points

)

select * from final
    );
  
[0m22:00:13.276606 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where is_valid_qualification = true

),

subject_crosswalk as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(o.offering_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_key,

        -- Natural key
        o.offering_id,

        -- Attributes
        o.offering_code,
        o.offering_name,
        o.qualification_id,
        o.study_year,
        o.duration_years,
        o.is_final_year,

        -- Foreign keys (natural keys for joins)
        o.academic_year_id,
        o.offering_type_id,
        o.course_header_id,

        -- External system mappings for benchmarking (from crosswalk)
        sc.dfe_qualification_code,
        sc.alps_subject_name,
        sc.six_dimensions_subject_name,

        -- Metadata
        o.record_source,
        o.loaded_at

    from source o
    left join subject_crosswalk sc
        on o.course_header_id = sc.course_header_id

)

select * from final
    );
  
[0m22:00:13.276813 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:00:13.276975 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:00:13.277154 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_academic_year: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_academic_year"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_academic_year`
      
    
    

    
    OPTIONS()
    as (
      with academic_years as (

    -- Get distinct academic years from offerings
    select distinct
        academic_year_id
    from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where academic_year_id is not null

),

enriched as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(academic_year_id as string), '_dbt_null_')
                
            
        )
    )
 as academic_year_key,

        -- Natural key
        academic_year_id,

        -- Attributes
        concat('20', substr(academic_year_id, 1, 2), '/', '20', substr(academic_year_id, 4, 2)) as academic_year_name,

        -- Date parsing (assuming academic year starts Sept 1)
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 1, 2), '-09-01')) as academic_year_start_date,
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 4, 2), '-08-31')) as academic_year_end_date,

        -- Calendar years
        cast(concat('20', substr(academic_year_id, 1, 2)) as int64) as calendar_year_start,
        cast(concat('20', substr(academic_year_id, 4, 2)) as int64) as calendar_year_end,

        -- Current year flag
        case
            when academic_year_id = '24/25' then true
            else false
        end as is_current_year,

        -- Years from current (for trending)
        array_length(
            array(
                select ay from unnest(['19/20', '20/21', '21/22', '22/23', '23/24', '24/25']) as ay
                where ay >= academic_year_id and ay <= '24/25'
            )
        ) - 1 as years_from_current,

        -- Metadata
        'prosolution' as record_source,
        current_timestamp() as loaded_at

    from academic_years

)

select * from enriched
order by academic_year_id desc
    );
  
[0m22:00:13.277309 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:00:13.314392 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:14.479213 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6e97e1a8-3e7c-4134-b5bf-e4018d03170c&page=queryresults
[0m22:00:14.622178 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d12fa066-bce7-47fe-bec2-d9dd6a96e543&page=queryresults
[0m22:00:14.623581 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d5f8fb13-5408-480d-9065-ef4d397ce2aa&page=queryresults
[0m22:00:14.625724 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2ae7bada-4c1a-4959-aab0-8c3244a27129&page=queryresults
[0m22:00:16.161051 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fbd18e0>]}
[0m22:00:16.161605 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics.dim_course_header ................. [[32mCREATE TABLE (15.0 rows, 739.0 Bytes processed)[0m in 2.92s]
[0m22:00:16.161957 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_course_header
[0m22:00:16.162189 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_offering_type
[0m22:00:16.162527 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics.dim_offering_type ...................... [RUN]
[0m22:00:16.162848 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_course_header, now model.barton_peveril_analytics.dim_offering_type)
[0m22:00:16.163059 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_offering_type
[0m22:00:16.165386 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:00:16.165833 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_offering_type
[0m22:00:16.167410 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:00:16.167795 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering_type"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering_type`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(offering_type_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_type_key,

        -- Natural key
        offering_type_id,

        -- Attributes
        offering_type_name,
        offering_type_category,
        qualification_level,
        grading_scale,
        is_academic,
        is_vocational,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:00:16.168013 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:00:16.194489 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ff0fc20>]}
[0m22:00:16.194886 [info ] [Thread-4 (]: 4 of 13 OK created sql table model analytics.dim_offering ...................... [[32mCREATE TABLE (30.0 rows, 3.7 KiB processed)[0m in 2.96s]
[0m22:00:16.195143 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_offering
[0m22:00:16.195306 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:00:16.195532 [info ] [Thread-4 (]: 6 of 13 START sql table model analytics.dim_prior_attainment ................... [RUN]
[0m22:00:16.195754 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_offering, now model.barton_peveril_analytics.dim_prior_attainment)
[0m22:00:16.195915 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_prior_attainment
[0m22:00:16.197621 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:00:16.197972 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_prior_attainment
[0m22:00:16.199155 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:00:16.199459 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_prior_attainment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_prior_attainment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_id as string), '_dbt_null_')
                
            
        )
    )
 as prior_attainment_key,

        -- Natural key
        student_id,

        -- GCSE metrics
        average_gcse_score,
        prior_attainment_band,
        prior_attainment_band_code,

        -- Thresholds (from project variables)
        cast(4.77 as numeric) as low_threshold,
        cast(6.09 as numeric) as high_threshold,

        -- Individual subject grades
        gcse_english_grade,
        gcse_maths_grade,
        total_gcse_points,
        gcse_count,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:00:16.199617 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:00:16.231844 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fe23980>]}
[0m22:00:16.232126 [info ] [Thread-3 (]: 3 of 13 OK created sql table model analytics.dim_grade ......................... [[32mCREATE TABLE (19.0 rows, 778.0 Bytes processed)[0m in 3.00s]
[0m22:00:16.232390 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_grade
[0m22:00:16.232535 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_student
[0m22:00:16.232736 [info ] [Thread-3 (]: 7 of 13 START sql table model analytics.dim_student ............................ [RUN]
[0m22:00:16.232918 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_grade, now model.barton_peveril_analytics.dim_student)
[0m22:00:16.233050 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_student
[0m22:00:16.235230 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student"
[0m22:00:16.235528 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_student
[0m22:00:16.236607 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student"
[0m22:00:16.236878 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`

),

student_detail as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`

),

-- Get latest student detail for each student
latest_detail as (

    select
        student_id,
        gender_code,
        gender,
        max(academic_year_id) as latest_academic_year
    from student_detail
    group by student_id, gender_code, gender

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(s.student_id as string), '_dbt_null_')
                
            
        )
    )
 as student_key,

        -- Natural keys
        s.student_id,
        cast(null as int64) as student_detail_id,  -- Multiple details per student

        -- Attributes (from latest detail)
        ld.gender_code,
        ld.gender,

        -- SCD Type 2 tracking (simplified - single version per student)
        s.first_enrolment_date as valid_from_date,
        cast(null as date) as valid_to_date,
        true as is_current,

        -- Metadata
        s.record_source,
        s.loaded_at

    from source s
    left join latest_detail ld
        on s.student_id = ld.student_id

)

select * from final
    );
  
[0m22:00:16.237041 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:00:16.295584 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fd264e0>]}
[0m22:00:16.295879 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics.dim_academic_year ................. [[32mCREATE TABLE (2.0 rows, 210.0 Bytes processed)[0m in 3.06s]
[0m22:00:16.296110 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_academic_year
[0m22:00:16.296256 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_student_detail
[0m22:00:16.296455 [info ] [Thread-1 (]: 8 of 13 START sql table model analytics.dim_student_detail ..................... [RUN]
[0m22:00:16.296705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_academic_year, now model.barton_peveril_analytics.dim_student_detail)
[0m22:00:16.296874 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_student_detail
[0m22:00:16.298364 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:00:16.298695 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_student_detail
[0m22:00:16.299712 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:00:16.299961 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student_detail"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student_detail`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_detail_id as string), '_dbt_null_')
                
            
        )
    )
 as student_detail_key,

        -- Natural keys
        student_detail_id,
        student_id,
        academic_year_id,

        -- Demographic flags for equity analysis (JEDI)
        is_disadvantaged,
        is_pupil_premium,
        is_free_school_meals,
        is_sen,
        is_access_plus,
        has_additional_adjustments,
        is_bursary_recipient,

        -- Ethnicity
        ethnicity_code,
        ethnicity_description,
        ethnicity_group,

        -- SEND
        sen_type as send_category,
        cast(null as string) as send_type,

        -- Geographic
        postcode_area,
        cast(null as int64) as imd_decile,  -- Would need to be enriched from external data

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:00:16.300102 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:17.188178 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:83748993-8dbd-4986-92e9-bf310cb6560b&page=queryresults
[0m22:00:17.288461 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f3c9efba-2cb6-496d-8fc1-1708547fbd6c&page=queryresults
[0m22:00:17.419005 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:60e0c7fe-f672-40c7-8b66-228621a43b83&page=queryresults
[0m22:00:17.419752 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f3c9efba-2cb6-496d-8fc1-1708547fbd6c&page=queryresults
[0m22:00:17.432129 [debug] [Thread-3 (]: Database Error in model dim_student (models/marts/dimensions/dim_student.sql)
  Unrecognized name: gender_code at [31:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student.sql
[0m22:00:17.432554 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fe5e5a0>]}
[0m22:00:17.432983 [error] [Thread-3 (]: 7 of 13 ERROR creating sql table model analytics.dim_student ................... [[31mERROR[0m in 1.20s]
[0m22:00:17.433334 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_student
[0m22:00:17.433571 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:00:17.433850 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.dim_student' to be skipped because of status 'error'.  Reason: Database Error in model dim_student (models/marts/dimensions/dim_student.sql)
  Unrecognized name: gender_code at [31:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student.sql.
[0m22:00:17.434141 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics.fct_alps_subject_performance ........... [RUN]
[0m22:00:17.434841 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_student, now model.barton_peveril_analytics.fct_alps_subject_performance)
[0m22:00:17.435083 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:00:17.438018 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:00:17.438598 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:00:17.440131 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:00:17.440659 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_alps_subject_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_alps_subject_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_alps_subject_performance`
      
    
    cluster by academic_year_key, alps_subject_name

    
    OPTIONS()
    as (
      with alps_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match ALPS subjects to internal offerings
subject_mapping as (

    select
        ap.academic_year_id,
        ap.alps_subject_name,
        ap.qualification_type,
        o.offering_key,
        o.offering_id,
        -- Simple mapping status based on whether match found
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from alps_performance ap
    left join dim_offering o
        on ap.alps_subject_name = o.alps_subject_name
        and ap.academic_year_id = o.academic_year_id

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ap.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.alps_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as alps_subject_performance_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- ALPS identifiers
        ap.alps_subject_name,
        ap.qualification_type as alps_qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        ap.cohort_count,

        -- A-Level grade distribution (counts)
        ap.grade_a_star_count,
        ap.grade_a_count,
        ap.grade_b_count,
        ap.grade_c_count,
        ap.grade_d_count,
        ap.grade_e_count,
        ap.grade_u_count,
        cast(null as int64) as grade_x_count,

        -- A-Level grade distribution (percentages)
        ap.grade_a_star_pct,
        ap.grade_a_pct,
        ap.grade_b_pct,
        ap.grade_c_pct,
        ap.grade_d_pct,
        ap.grade_e_pct,
        ap.grade_u_pct,
        cast(null as numeric) as grade_x_pct,

        -- BTEC Single Award distribution (counts)
        ap.btec_distinction_star_count,
        ap.btec_distinction_count,
        ap.btec_merit_count,
        ap.btec_pass_count,

        -- BTEC Single Award distribution (percentages)
        ap.btec_distinction_star_pct,
        ap.btec_distinction_pct,
        ap.btec_merit_pct,
        ap.btec_pass_pct,

        -- BTEC Double Award (not in current model but placeholders)
        cast(null as int64) as btec_d_star_d_star_count,
        cast(null as int64) as btec_d_star_d_count,
        cast(null as int64) as btec_dd_count,
        cast(null as int64) as btec_dm_count,
        cast(null as int64) as btec_mm_count,
        cast(null as int64) as btec_mp_count,
        cast(null as int64) as btec_pp_count,

        cast(null as numeric) as btec_d_star_d_star_pct,
        cast(null as numeric) as btec_d_star_d_pct,
        cast(null as numeric) as btec_dd_pct,
        cast(null as numeric) as btec_dm_pct,
        cast(null as numeric) as btec_mm_pct,
        cast(null as numeric) as btec_mp_pct,
        cast(null as numeric) as btec_pp_pct,

        -- Cumulative metrics
        ap.a_star_to_a_pct,
        ap.a_star_to_b_pct,
        ap.a_star_to_c_pct,
        ap.a_star_to_e_pct,
        ap.high_grade_pct,
        ap.pass_rate_pct,

        -- ALPS benchmarking metrics
        ap.alps_band,
        ap.alps_score,
        cast(null as numeric) as alps_national_percentile,

        -- Averages
        ap.average_grade_points,
        cast(null as numeric) as average_ucas_points,

        -- Completion
        cast(null as numeric) as completion_rate_pct,

        -- Metadata
        ap.report_date as alps_report_date,
        ap.record_source,
        ap.loaded_at

    from alps_performance ap
    inner join dim_academic_year ay
        on ap.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on ap.academic_year_id = sm.academic_year_id
        and ap.alps_subject_name = sm.alps_subject_name
        and ap.qualification_type = sm.qualification_type

)

select * from final
    );
  
[0m22:00:17.440959 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:00:17.465695 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:c1b27555-757c-460d-9a55-b6f6bdfb5262&page=queryresults
[0m22:00:17.552468 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:60e0c7fe-f672-40c7-8b66-228621a43b83&page=queryresults
[0m22:00:17.555447 [debug] [Thread-1 (]: Database Error in model dim_student_detail (models/marts/dimensions/dim_student_detail.sql)
  Unrecognized name: is_disadvantaged at [40:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student_detail.sql
[0m22:00:17.555703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168868740>]}
[0m22:00:17.556012 [error] [Thread-1 (]: 8 of 13 ERROR creating sql table model analytics.dim_student_detail ............ [[31mERROR[0m in 1.26s]
[0m22:00:17.556261 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_student_detail
[0m22:00:17.556437 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.fct_college_performance
[0m22:00:17.556668 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.dim_student_detail' to be skipped because of status 'error'.  Reason: Database Error in model dim_student_detail (models/marts/dimensions/dim_student_detail.sql)
  Unrecognized name: is_disadvantaged at [40:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student_detail.sql.
[0m22:00:17.556913 [info ] [Thread-1 (]: 10 of 13 START sql table model analytics.fct_college_performance ............... [RUN]
[0m22:00:17.557300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_student_detail, now model.barton_peveril_analytics.fct_college_performance)
[0m22:00:17.557460 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.fct_college_performance
[0m22:00:17.559567 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:00:17.559963 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.fct_college_performance
[0m22:00:17.562254 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:00:17.562608 [debug] [Thread-1 (]: On model.barton_peveril_analytics.fct_college_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_college_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_college_performance`
      
    
    cluster by academic_year_key, report_type

    
    OPTIONS()
    as (
      with college_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(cp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(cp.report_type as string), '_dbt_null_')
                
            
        )
    )
 as college_performance_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifiers
        cp.report_type,
        cp.report_name,

        -- Cohort measures
        cp.total_cohort_count,
        cast(null as int64) as a_level_cohort_count,
        cast(null as int64) as btec_cohort_count,
        cast(null as int64) as vocational_cohort_count,

        -- Attainment metrics
        cp.pass_rate_pct,
        cp.high_grade_rate_pct,
        cp.average_grade_points,
        cp.average_ucas_points,

        -- Value-added metrics
        cp.va_score,
        cp.va_band,
        cp.va_confidence_lower,
        cp.va_confidence_upper,
        cp.va_percentile,
        cp.va_national_rank,

        -- Sixth Sense metrics
        cp.sixth_sense_score,
        cp.sixth_sense_band,

        -- National benchmarks
        cast(null as numeric) as national_pass_rate_pct,
        cast(null as numeric) as national_high_grade_pct,
        cp.national_percentile_rank,

        -- Variance from benchmark
        cast(null as numeric) as pass_rate_vs_national_pct,
        cast(null as numeric) as high_grade_vs_national_pct,

        -- Metadata
        cp.report_date,
        cp.record_source,
        cp.loaded_at

    from college_performance cp
    inner join dim_academic_year ay
        on cp.academic_year_id = ay.academic_year_id

)

select * from final
    );
  
[0m22:00:17.562817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:17.584842 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:c1b27555-757c-460d-9a55-b6f6bdfb5262&page=queryresults
[0m22:00:17.587456 [debug] [Thread-4 (]: Database Error in model dim_prior_attainment (models/marts/dimensions/dim_prior_attainment.sql)
  Unrecognized name: total_gcse_points at [49:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_prior_attainment.sql
[0m22:00:17.587684 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168aa5850>]}
[0m22:00:17.587929 [error] [Thread-4 (]: 6 of 13 ERROR creating sql table model analytics.dim_prior_attainment .......... [[31mERROR[0m in 1.39s]
[0m22:00:17.588123 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:00:17.588255 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.fct_equity_gap
[0m22:00:17.588443 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.dim_prior_attainment' to be skipped because of status 'error'.  Reason: Database Error in model dim_prior_attainment (models/marts/dimensions/dim_prior_attainment.sql)
  Unrecognized name: total_gcse_points at [49:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_prior_attainment.sql.
[0m22:00:17.588646 [info ] [Thread-4 (]: 11 of 13 START sql table model analytics.fct_equity_gap ........................ [RUN]
[0m22:00:17.588872 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_prior_attainment, now model.barton_peveril_analytics.fct_equity_gap)
[0m22:00:17.589004 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.fct_equity_gap
[0m22:00:17.590867 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:00:17.591235 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.fct_equity_gap
[0m22:00:17.592366 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:00:17.592764 [debug] [Thread-4 (]: On model.barton_peveril_analytics.fct_equity_gap: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_equity_gap"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_equity_gap`
      
    
    cluster by academic_year_key, demographic_category

    
    OPTIONS()
    as (
      with jedi_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

-- Calculate overall cohort metrics for gap analysis
overall_metrics as (

    select
        academic_year_id,
        sum(cohort_count) as total_cohort_count,
        -- Weighted average pass rate
        safe_divide(
            sum(pass_rate_pct * cohort_count),
            sum(cohort_count)
        ) as overall_pass_rate_pct,
        safe_divide(
            sum(high_grade_rate_pct * cohort_count),
            sum(cohort_count)
        ) as overall_high_grade_pct,
        safe_divide(
            sum(va_score * cohort_count),
            sum(cohort_count)
        ) as overall_va_score

    from jedi_data
    group by academic_year_id

),

-- Get prior year gaps for trend analysis
with_prior_year as (

    select
        jd.*,
        lag(jd.gap_vs_overall_pct) over (
            partition by jd.demographic_category, jd.demographic_value
            order by jd.academic_year_id
        ) as prior_year_gap_pct

    from jedi_data jd

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wp.demographic_category as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wp.demographic_value as string), '_dbt_null_')
                
            
        )
    )
 as equity_gap_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifier
        'JEDI' as report_type,

        -- Demographic segmentation
        wp.demographic_category,
        wp.demographic_value,

        -- Intersectional analysis (not available in current data)
        cast(null as string) as demographic_category_2,
        cast(null as string) as demographic_value_2,
        false as is_intersectional,

        -- Cohort metrics
        wp.cohort_count as subgroup_cohort_count,
        wp.cohort_pct as subgroup_cohort_pct,

        -- Subgroup attainment
        wp.pass_rate_pct as subgroup_pass_rate_pct,
        wp.high_grade_rate_pct as subgroup_high_grade_pct,
        wp.average_points as subgroup_avg_grade_points,
        cast(null as numeric) as subgroup_avg_ucas_points,

        -- Subgroup value-added
        wp.va_score as subgroup_va_score,
        wp.va_band as subgroup_va_band,
        cast(null as numeric) as subgroup_va_percentile,

        -- Overall cohort benchmarks
        om.overall_pass_rate_pct,
        om.overall_high_grade_pct,
        om.overall_va_score,

        -- Gap calculations (subgroup - overall)
        wp.gap_vs_overall_pct as pass_rate_gap_pct,
        wp.high_grade_rate_pct - om.overall_high_grade_pct as high_grade_gap_pct,
        wp.va_score - om.overall_va_score as va_gap,

        -- Gender-specific gaps (placeholders - need separate calculation)
        cast(null as numeric) as male_pass_rate_pct,
        cast(null as numeric) as female_pass_rate_pct,
        cast(null as numeric) as gender_gap_pass_rate_pct,
        cast(null as numeric) as male_high_grade_pct,
        cast(null as numeric) as female_high_grade_pct,
        cast(null as numeric) as gender_gap_high_grade_pct,

        -- National benchmarks
        wp.national_pass_rate_pct as national_subgroup_pass_rate_pct,
        wp.national_high_grade_pct as national_subgroup_high_grade_pct,
        cast(null as numeric) as national_subgroup_va,

        -- Performance vs national
        wp.gap_vs_national_pct as pass_rate_vs_national_pct,
        cast(null as numeric) as high_grade_vs_national_pct,
        cast(null as numeric) as va_vs_national,

        -- Gap trend analysis
        wp.prior_year_gap_pct,
        wp.gap_vs_overall_pct - wp.prior_year_gap_pct as gap_change_yoy_pct,
        case
            when wp.gap_vs_overall_pct - wp.prior_year_gap_pct < -1 then 'Narrowing'
            when wp.gap_vs_overall_pct - wp.prior_year_gap_pct > 1 then 'Widening'
            else 'Stable'
        end as gap_trend,

        -- Metadata
        wp.report_date,
        wp.record_source,
        wp.loaded_at

    from with_prior_year wp
    inner join dim_academic_year ay
        on wp.academic_year_id = ay.academic_year_id
    left join overall_metrics om
        on wp.academic_year_id = om.academic_year_id

)

select * from final
    );
  
[0m22:00:17.592984 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:00:18.474713 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f409de6d-c150-4aad-856d-793c22ed57be&page=queryresults
[0m22:00:18.556293 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:59e2368b-8aca-4e09-a972-fdd6356ab688&page=queryresults
[0m22:00:18.610196 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6e4f7583-c5e1-4bcb-89f2-12a953d1bf1a&page=queryresults
[0m22:00:18.609624 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f409de6d-c150-4aad-856d-793c22ed57be&page=queryresults
[0m22:00:18.617060 [debug] [Thread-3 (]: Database Error in model fct_alps_subject_performance (models/marts/facts/fct_alps_subject_performance.sql)
  Name grade_a_star_count not found inside ap at [94:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_alps_subject_performance.sql
[0m22:00:18.617641 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a7d280>]}
[0m22:00:18.618191 [error] [Thread-3 (]: 9 of 13 ERROR creating sql table model analytics.fct_alps_subject_performance .. [[31mERROR[0m in 1.18s]
[0m22:00:18.618631 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:00:18.618932 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:00:18.619284 [info ] [Thread-3 (]: 12 of 13 START sql table model analytics.fct_subject_benchmark ................. [RUN]
[0m22:00:18.619642 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.fct_alps_subject_performance, now model.barton_peveril_analytics.fct_subject_benchmark)
[0m22:00:18.619944 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:00:18.620342 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.fct_alps_subject_performance' to be skipped because of status 'error'.  Reason: Database Error in model fct_alps_subject_performance (models/marts/facts/fct_alps_subject_performance.sql)
  Name grade_a_star_count not found inside ap at [94:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_alps_subject_performance.sql.
[0m22:00:18.624267 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:00:18.624955 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:00:18.627323 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:00:18.628107 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_subject_benchmark: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_subject_benchmark"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_subject_benchmark`
      
    
    cluster by academic_year_key, six_dimensions_subject_name

    
    OPTIONS()
    as (
      with subject_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match Six Dimensions subjects to internal offerings
subject_mapping as (

    select
        sp.academic_year_id,
        sp.six_dimensions_subject_name,
        o.offering_key,
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from subject_performance sp
    left join dim_offering o
        on sp.six_dimensions_subject_name = o.six_dimensions_subject_name
        and sp.academic_year_id = o.academic_year_id

),

-- Calculate year-over-year change for trajectory
with_trajectory as (

    select
        sp.*,
        lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name
            order by sp.academic_year_id
        ) as prior_year_pass_rate,
        sp.pass_rate_pct - lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name
            order by sp.academic_year_id
        ) as yoy_change_pct

    from subject_performance sp

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wt.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.six_dimensions_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.report_type as string), '_dbt_null_')
                
            
        )
    )
 as subject_benchmark_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- Source identifiers
        wt.report_type,
        wt.six_dimensions_subject_name,
        wt.qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        wt.cohort_count,

        -- Attainment metrics
        wt.pass_rate_pct,
        wt.high_grade_rate_pct,
        wt.average_grade_points,
        cast(null as numeric) as average_ucas_points,

        -- Value-added metrics
        wt.va_score,
        wt.va_residual,
        wt.va_band,
        wt.va_percentile,
        wt.va_confidence_lower,
        wt.va_confidence_upper,

        -- National benchmarks
        wt.national_pass_rate_pct,
        wt.national_high_grade_pct,
        wt.national_va_average,

        -- Variance from benchmark
        wt.pass_rate_pct - wt.national_pass_rate_pct as pass_rate_vs_national_pct,
        wt.high_grade_rate_pct - wt.national_high_grade_pct as high_grade_vs_national_pct,
        wt.va_score - wt.national_va_average as va_vs_national,

        -- Subject ranking
        cast(null as int64) as subject_rank_internal,
        wt.subject_rank_national,

        -- Trend indicators
        case
            when wt.yoy_change_pct > 2 then 'Improving'
            when wt.yoy_change_pct < -2 then 'Declining'
            else 'Stable'
        end as performance_trajectory,
        wt.yoy_change_pct,

        -- Metadata
        wt.report_date,
        wt.record_source,
        wt.loaded_at

    from with_trajectory wt
    inner join dim_academic_year ay
        on wt.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on wt.academic_year_id = sm.academic_year_id
        and wt.six_dimensions_subject_name = sm.six_dimensions_subject_name

)

select * from final
    );
  
[0m22:00:18.628526 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:00:18.668326 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:59e2368b-8aca-4e09-a972-fdd6356ab688&page=queryresults
[0m22:00:18.671317 [debug] [Thread-1 (]: Database Error in model fct_college_performance (models/marts/facts/fct_college_performance.sql)
  Name pass_rate_pct not found inside cp at [57:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_college_performance.sql
[0m22:00:18.671613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ac7710>]}
[0m22:00:18.671948 [error] [Thread-1 (]: 10 of 13 ERROR creating sql table model analytics.fct_college_performance ...... [[31mERROR[0m in 1.11s]
[0m22:00:18.672196 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.fct_college_performance
[0m22:00:18.672398 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.fct_college_performance' to be skipped because of status 'error'.  Reason: Database Error in model fct_college_performance (models/marts/facts/fct_college_performance.sql)
  Name pass_rate_pct not found inside cp at [57:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_college_performance.sql.
[0m22:00:18.753398 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6e4f7583-c5e1-4bcb-89f2-12a953d1bf1a&page=queryresults
[0m22:00:18.758846 [debug] [Thread-4 (]: Database Error in model fct_equity_gap (models/marts/facts/fct_equity_gap.sql)
  Unrecognized name: cohort_count at [31:13]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_equity_gap.sql
[0m22:00:18.759139 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ff10e90>]}
[0m22:00:18.759470 [error] [Thread-4 (]: 11 of 13 ERROR creating sql table model analytics.fct_equity_gap ............... [[31mERROR[0m in 1.17s]
[0m22:00:18.759740 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.fct_equity_gap
[0m22:00:18.759959 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.fct_equity_gap' to be skipped because of status 'error'.  Reason: Database Error in model fct_equity_gap (models/marts/facts/fct_equity_gap.sql)
  Unrecognized name: cohort_count at [31:13]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_equity_gap.sql.
[0m22:00:19.039509 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fe6e4e0>]}
[0m22:00:19.039967 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics.dim_offering_type ................. [[32mCREATE TABLE (7.0 rows, 328.0 Bytes processed)[0m in 2.88s]
[0m22:00:19.040290 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_offering_type
[0m22:00:19.040633 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.fct_enrolment
[0m22:00:19.040905 [info ] [Thread-1 (]: 13 of 13 SKIP relation analytics.fct_enrolment ................................. [[33mSKIP[0m]
[0m22:00:19.041156 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.fct_enrolment
[0m22:00:19.775474 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:5a330b0f-c335-4202-9642-9bacd60737ab&page=queryresults
[0m22:00:19.947170 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:5a330b0f-c335-4202-9642-9bacd60737ab&page=queryresults
[0m22:00:19.955849 [debug] [Thread-3 (]: Database Error in model fct_subject_benchmark (models/marts/facts/fct_subject_benchmark.sql)
  Name high_grade_rate_pct not found inside wt at [111:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_subject_benchmark.sql
[0m22:00:19.956248 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f83c274e-c199-4e94-9a8a-1646f1d17080', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a7c5f0>]}
[0m22:00:19.956696 [error] [Thread-3 (]: 12 of 13 ERROR creating sql table model analytics.fct_subject_benchmark ........ [[31mERROR[0m in 1.34s]
[0m22:00:19.957064 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:00:19.957373 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.fct_subject_benchmark' to be skipped because of status 'error'.  Reason: Database Error in model fct_subject_benchmark (models/marts/facts/fct_subject_benchmark.sql)
  Name high_grade_rate_pct not found inside wt at [111:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_subject_benchmark.sql.
[0m22:00:19.958412 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:00:19.959540 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:00:19.959760 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_college_performance' was properly closed.
[0m22:00:19.959934 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.dim_offering_type' was properly closed.
[0m22:00:19.960093 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_subject_benchmark' was properly closed.
[0m22:00:19.960240 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_equity_gap' was properly closed.
[0m22:00:19.960478 [info ] [MainThread]: 
[0m22:00:19.960679 [info ] [MainThread]: Finished running 13 table models in 0 hours 0 minutes and 9.17 seconds (9.17s).
[0m22:00:19.961858 [debug] [MainThread]: Command end result
[0m22:00:19.993094 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:00:19.994315 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:00:19.997266 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m22:00:19.997433 [info ] [MainThread]: 
[0m22:00:19.997598 [info ] [MainThread]: [31mCompleted with 7 errors, 0 partial successes, and 0 warnings:[0m
[0m22:00:19.997716 [info ] [MainThread]: 
[0m22:00:19.997866 [error] [MainThread]: [31mFailure in model dim_student (models/marts/dimensions/dim_student.sql)[0m
[0m22:00:19.997999 [error] [MainThread]:   Database Error in model dim_student (models/marts/dimensions/dim_student.sql)
  Unrecognized name: gender_code at [31:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student.sql
[0m22:00:19.998096 [info ] [MainThread]: 
[0m22:00:19.998216 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/dimensions/dim_student.sql
[0m22:00:19.998319 [info ] [MainThread]: 
[0m22:00:19.998438 [error] [MainThread]: [31mFailure in model dim_student_detail (models/marts/dimensions/dim_student_detail.sql)[0m
[0m22:00:19.998561 [error] [MainThread]:   Database Error in model dim_student_detail (models/marts/dimensions/dim_student_detail.sql)
  Unrecognized name: is_disadvantaged at [40:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_student_detail.sql
[0m22:00:19.998656 [info ] [MainThread]: 
[0m22:00:19.998769 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/dimensions/dim_student_detail.sql
[0m22:00:19.998864 [info ] [MainThread]: 
[0m22:00:19.998982 [error] [MainThread]: [31mFailure in model dim_prior_attainment (models/marts/dimensions/dim_prior_attainment.sql)[0m
[0m22:00:19.999102 [error] [MainThread]:   Database Error in model dim_prior_attainment (models/marts/dimensions/dim_prior_attainment.sql)
  Unrecognized name: total_gcse_points at [49:9]
  compiled code at target/run/barton_peveril_analytics/models/marts/dimensions/dim_prior_attainment.sql
[0m22:00:19.999197 [info ] [MainThread]: 
[0m22:00:19.999308 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/dimensions/dim_prior_attainment.sql
[0m22:00:19.999401 [info ] [MainThread]: 
[0m22:00:19.999520 [error] [MainThread]: [31mFailure in model fct_alps_subject_performance (models/marts/facts/fct_alps_subject_performance.sql)[0m
[0m22:00:19.999641 [error] [MainThread]:   Database Error in model fct_alps_subject_performance (models/marts/facts/fct_alps_subject_performance.sql)
  Name grade_a_star_count not found inside ap at [94:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_alps_subject_performance.sql
[0m22:00:19.999734 [info ] [MainThread]: 
[0m22:00:19.999847 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/facts/fct_alps_subject_performance.sql
[0m22:00:19.999941 [info ] [MainThread]: 
[0m22:00:20.000059 [error] [MainThread]: [31mFailure in model fct_college_performance (models/marts/facts/fct_college_performance.sql)[0m
[0m22:00:20.000179 [error] [MainThread]:   Database Error in model fct_college_performance (models/marts/facts/fct_college_performance.sql)
  Name pass_rate_pct not found inside cp at [57:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_college_performance.sql
[0m22:00:20.000275 [info ] [MainThread]: 
[0m22:00:20.000395 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/facts/fct_college_performance.sql
[0m22:00:20.000519 [info ] [MainThread]: 
[0m22:00:20.000637 [error] [MainThread]: [31mFailure in model fct_equity_gap (models/marts/facts/fct_equity_gap.sql)[0m
[0m22:00:20.000755 [error] [MainThread]:   Database Error in model fct_equity_gap (models/marts/facts/fct_equity_gap.sql)
  Unrecognized name: cohort_count at [31:13]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_equity_gap.sql
[0m22:00:20.000848 [info ] [MainThread]: 
[0m22:00:20.000957 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/facts/fct_equity_gap.sql
[0m22:00:20.001048 [info ] [MainThread]: 
[0m22:00:20.001165 [error] [MainThread]: [31mFailure in model fct_subject_benchmark (models/marts/facts/fct_subject_benchmark.sql)[0m
[0m22:00:20.001285 [error] [MainThread]:   Database Error in model fct_subject_benchmark (models/marts/facts/fct_subject_benchmark.sql)
  Name high_grade_rate_pct not found inside wt at [111:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_subject_benchmark.sql
[0m22:00:20.001374 [info ] [MainThread]: 
[0m22:00:20.001481 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/facts/fct_subject_benchmark.sql
[0m22:00:20.001575 [info ] [MainThread]: 
[0m22:00:20.001694 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=7 SKIP=1 NO-OP=0 TOTAL=13
[0m22:00:20.004796 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 10.946864, "process_in_blocks": "0", "process_kernel_time": 0.443801, "process_mem_max_rss": "406126592", "process_out_blocks": "0", "process_user_time": 4.223929}
[0m22:00:20.005025 [debug] [MainThread]: Command `dbt run` failed at 22:00:20.004989 after 10.95 seconds
[0m22:00:20.005187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a89370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106022a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f4cc260>]}
[0m22:00:20.005322 [debug] [MainThread]: Flushing usage events
[0m22:00:20.901794 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:09.303090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf7020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d0cda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d0e9f0>]}


============================== 22:02:09.307015 | fdea0065-be22-491f-a9c8-bd9af75eb5e7 ==============================
[0m22:02:09.307015 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:09.307362 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'printer_width': '80', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'debug': 'False', 'no_print': 'None', 'warn_error': 'None', 'log_format': 'default', 'introspect': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run --select marts --target dev', 'fail_fast': 'False', 'profiles_dir': '/Users/markrittman/.dbt', 'version_check': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'empty': 'False', 'target_path': 'None', 'use_colors': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'quiet': 'False', 'use_experimental_parser': 'False'}
[0m22:02:10.902086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ccfa660>]}
[0m22:02:10.922511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067e9430>]}
[0m22:02:10.922819 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m22:02:11.032298 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m22:02:11.116785 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 7 files changed.
[0m22:02:11.117261 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/dimensions/dim_prior_attainment.sql
[0m22:02:11.117428 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_college_performance.sql
[0m22:02:11.117568 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/dimensions/dim_student_detail.sql
[0m22:02:11.117734 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_enrolment.sql
[0m22:02:11.117849 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/dimensions/dim_student.sql
[0m22:02:11.118111 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_alps_subject_performance.sql
[0m22:02:11.118294 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_equity_gap.sql
[0m22:02:11.118441 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_subject_benchmark.sql
[0m22:02:11.254086 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `accepted_values`. Arguments to generic tests
should be nested under the `arguments` property.`
[0m22:02:11.254356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d52df40>]}
[0m22:02:11.325812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d6403e0>]}
[0m22:02:11.373309 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:02:11.374658 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:02:11.390178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d72a900>]}
[0m22:02:11.390423 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m22:02:11.390563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d7794c0>]}
[0m22:02:11.392015 [info ] [MainThread]: 
[0m22:02:11.392188 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:02:11.392296 [info ] [MainThread]: 
[0m22:02:11.392495 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:02:11.394281 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m22:02:11.394437 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:02:12.203029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m22:02:12.204467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:12.204046 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_prosolution'
[0m22:02:12.258348 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics'
[0m22:02:12.259189 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed'
[0m22:02:12.259498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:02:12.260183 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:02:12.261131 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:02:13.017867 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics_staging)
[0m22:02:13.019747 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_seed_raw_alps)
[0m22:02:13.023853 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:13.025528 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_integration)
[0m22:02:13.026712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:13.056264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m22:02:13.056558 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:13.080181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:13.769825 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m22:02:13.770326 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:02:14.286753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067e9790>]}
[0m22:02:14.287104 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:02:14.289132 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_academic_year
[0m22:02:14.289776 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_course_header
[0m22:02:14.290213 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_grade
[0m22:02:14.289466 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics.dim_academic_year ...................... [RUN]
[0m22:02:14.290498 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_offering
[0m22:02:14.290747 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics.dim_course_header ...................... [RUN]
[0m22:02:14.291137 [info ] [Thread-3 (]: 3 of 13 START sql table model analytics.dim_grade .............................. [RUN]
[0m22:02:14.291363 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now model.barton_peveril_analytics.dim_academic_year)
[0m22:02:14.291650 [info ] [Thread-4 (]: 4 of 13 START sql table model analytics.dim_offering ........................... [RUN]
[0m22:02:14.291985 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now model.barton_peveril_analytics.dim_course_header)
[0m22:02:14.292320 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now model.barton_peveril_analytics.dim_grade)
[0m22:02:14.292693 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_academic_year
[0m22:02:14.292876 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now model.barton_peveril_analytics.dim_offering)
[0m22:02:14.293433 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_course_header
[0m22:02:14.293655 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_grade
[0m22:02:14.298509 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:02:14.299057 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_offering
[0m22:02:14.301503 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_course_header"
[0m22:02:14.303916 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_grade"
[0m22:02:14.305632 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering"
[0m22:02:14.306251 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_offering
[0m22:02:14.313010 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:02:14.345087 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_course_header
[0m22:02:14.349189 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:02:14.373667 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_grade
[0m22:02:14.373912 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_academic_year
[0m22:02:14.376746 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:02:14.377842 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:02:14.993124 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:02:14.999867 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_academic_year: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_academic_year"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_academic_year`
      
    
    

    
    OPTIONS()
    as (
      with academic_years as (

    -- Get distinct academic years from offerings
    select distinct
        academic_year_id
    from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where academic_year_id is not null

),

enriched as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(academic_year_id as string), '_dbt_null_')
                
            
        )
    )
 as academic_year_key,

        -- Natural key
        academic_year_id,

        -- Attributes
        concat('20', substr(academic_year_id, 1, 2), '/', '20', substr(academic_year_id, 4, 2)) as academic_year_name,

        -- Date parsing (assuming academic year starts Sept 1)
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 1, 2), '-09-01')) as academic_year_start_date,
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 4, 2), '-08-31')) as academic_year_end_date,

        -- Calendar years
        cast(concat('20', substr(academic_year_id, 1, 2)) as int64) as calendar_year_start,
        cast(concat('20', substr(academic_year_id, 4, 2)) as int64) as calendar_year_end,

        -- Current year flag
        case
            when academic_year_id = '24/25' then true
            else false
        end as is_current_year,

        -- Years from current (for trending)
        array_length(
            array(
                select ay from unnest(['19/20', '20/21', '21/22', '22/23', '23/24', '24/25']) as ay
                where ay >= academic_year_id and ay <= '24/25'
            )
        ) - 1 as years_from_current,

        -- Metadata
        'prosolution' as record_source,
        current_timestamp() as loaded_at

    from academic_years

)

select * from enriched
order by academic_year_id desc
    );
  
[0m22:02:15.031072 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_course_header"
[0m22:02:15.031676 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_course_header"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_course_header`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(course_header_id as string), '_dbt_null_')
                
            
        )
    )
 as course_header_key,

        -- Natural key
        course_header_id,

        -- Attributes
        course_code,
        course_name,
        subject_area,
        department,
        is_active,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:02:15.032585 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering"
[0m22:02:15.033382 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_grade"
[0m22:02:15.033736 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where is_valid_qualification = true

),

subject_crosswalk as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(o.offering_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_key,

        -- Natural key
        o.offering_id,

        -- Attributes
        o.offering_code,
        o.offering_name,
        o.qualification_id,
        o.study_year,
        o.duration_years,
        o.is_final_year,

        -- Foreign keys (natural keys for joins)
        o.academic_year_id,
        o.offering_type_id,
        o.course_header_id,

        -- External system mappings for benchmarking (from crosswalk)
        sc.dfe_qualification_code,
        sc.alps_subject_name,
        sc.six_dimensions_subject_name,

        -- Metadata
        o.record_source,
        o.loaded_at

    from source o
    left join subject_crosswalk sc
        on o.course_header_id = sc.course_header_id

)

select * from final
    );
  
[0m22:02:15.034245 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_grade: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_grade"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_grade`
      
    
    

    
    OPTIONS()
    as (
      with grade_points as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_grade_points`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(grade as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as grade_key,

        -- Natural key
        grade,
        qualification_type as grading_scale,

        -- Point values
        ucas_points,
        grade_points,
        grade_sort_order,

        -- Grade classification flags
        is_high_grade,
        is_pass as is_pass_grade,

        -- Cumulative grade flags (A-Level specific)
        case when grade in ('A*', 'A') then true else false end as is_grade_a_star_to_a,
        case when grade in ('A*', 'A', 'B') then true else false end as is_grade_a_star_to_b,
        case when grade in ('A*', 'A', 'B', 'C') then true else false end as is_grade_a_star_to_c,
        case when grade in ('A*', 'A', 'B', 'C', 'D', 'E') then true else false end as is_grade_a_star_to_e,

        -- Metadata
        'seed' as record_source,
        current_timestamp() as loaded_at

    from grade_points

)

select * from final
    );
  
[0m22:02:15.452363 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:f87a7842-cddc-4517-92b5-e504f794f6dc&page=queryresults
[0m22:02:15.704342 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:b10527f7-6280-48d6-b162-4df1348126d0&page=queryresults
[0m22:02:15.730014 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:aea0f154-aa60-4093-97fa-373bda74a65f&page=queryresults
[0m22:02:15.731054 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2f2c342b-1c57-43f5-9fe8-f0a59c113350&page=queryresults
[0m22:02:17.368316 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d89cc50>]}
[0m22:02:17.368546 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119ed1850>]}
[0m22:02:17.368721 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d49d970>]}
[0m22:02:17.369063 [info ] [Thread-4 (]: 4 of 13 OK created sql table model analytics.dim_offering ...................... [[32mCREATE TABLE (30.0 rows, 3.7 KiB processed)[0m in 3.07s]
[0m22:02:17.369373 [info ] [Thread-3 (]: 3 of 13 OK created sql table model analytics.dim_grade ......................... [[32mCREATE TABLE (19.0 rows, 778.0 Bytes processed)[0m in 3.07s]
[0m22:02:17.369882 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_offering
[0m22:02:17.369659 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics.dim_academic_year ................. [[32mCREATE TABLE (2.0 rows, 210.0 Bytes processed)[0m in 3.08s]
[0m22:02:17.370172 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_grade
[0m22:02:17.370446 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_offering_type
[0m22:02:17.370956 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_academic_year
[0m22:02:17.371475 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:02:17.371851 [info ] [Thread-4 (]: 5 of 13 START sql table model analytics.dim_offering_type ...................... [RUN]
[0m22:02:17.372206 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_student
[0m22:02:17.372459 [info ] [Thread-3 (]: 6 of 13 START sql table model analytics.dim_prior_attainment ................... [RUN]
[0m22:02:17.372780 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_offering, now model.barton_peveril_analytics.dim_offering_type)
[0m22:02:17.373018 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics.dim_student ............................ [RUN]
[0m22:02:17.373214 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_grade, now model.barton_peveril_analytics.dim_prior_attainment)
[0m22:02:17.373363 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_offering_type
[0m22:02:17.373519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_academic_year, now model.barton_peveril_analytics.dim_student)
[0m22:02:17.373661 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_prior_attainment
[0m22:02:17.377028 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:02:17.379676 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_student
[0m22:02:17.381516 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:02:17.383153 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student"
[0m22:02:17.383782 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_offering_type
[0m22:02:17.383933 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_student
[0m22:02:17.384937 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:02:17.385066 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_prior_attainment
[0m22:02:17.386133 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student"
[0m22:02:17.408550 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:02:17.409625 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_prior_attainment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_prior_attainment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(average_gcse_id as string), '_dbt_null_')
                
            
        )
    )
 as prior_attainment_key,

        -- Natural keys
        average_gcse_id,
        student_id,
        academic_year_id,

        -- GCSE metrics
        average_gcse_score,
        prior_attainment_band,
        prior_attainment_band_code,

        -- Thresholds (from project variables)
        cast(4.77 as numeric) as low_threshold,
        cast(6.09 as numeric) as high_threshold,

        -- Individual subject grades
        gcse_english_grade,
        gcse_maths_grade,
        gcse_count,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:02:17.409850 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_id as string), '_dbt_null_')
                
            
        )
    )
 as student_key,

        -- Natural key
        student_id,

        -- Identifiers
        uln,

        -- Demographics
        first_name,
        last_name,
        full_name,
        date_of_birth,
        gender,
        ethnicity,

        -- Status
        is_active,

        -- Dates
        created_at as first_enrolment_date,

        -- SCD Type 2 tracking (simplified - single version per student)
        date(created_at) as valid_from_date,
        cast(null as date) as valid_to_date,
        true as is_current,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:02:17.410028 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:02:17.429074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:02:17.454452 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d82c110>]}
[0m22:02:17.455050 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics.dim_course_header ................. [[32mCREATE TABLE (15.0 rows, 739.0 Bytes processed)[0m in 3.16s]
[0m22:02:17.455348 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_course_header
[0m22:02:17.455505 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_student_detail
[0m22:02:17.455690 [info ] [Thread-2 (]: 8 of 13 START sql table model analytics.dim_student_detail ..................... [RUN]
[0m22:02:17.455853 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_course_header, now model.barton_peveril_analytics.dim_student_detail)
[0m22:02:17.455976 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_student_detail
[0m22:02:17.457473 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:02:17.457939 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_student_detail
[0m22:02:17.459984 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:02:17.460391 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student_detail"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student_detail`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_detail_id as string), '_dbt_null_')
                
            
        )
    )
 as student_detail_key,

        -- Natural keys
        student_detail_id,
        student_id,
        academic_year_id,

        -- Core demographics
        full_name,
        gender,
        ethnicity,

        -- Demographic flags for equity analysis
        is_free_meals,
        is_bursary,
        is_lac,
        is_send,
        is_high_needs,
        is_young_carer,

        -- SEND details
        primary_send_type,
        secondary_send_type,

        -- Geographic
        postcode_area,
        imd_decile,
        polar4_quintile,
        tundra_classification,

        -- Background
        nationality,
        country_of_birth,
        first_language,
        religion,

        -- Prior attainment
        average_gcse_score,
        prior_attainment_band,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:02:17.461139 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:02:17.931867 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:02:17.932623 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering_type"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering_type`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(offering_type_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_type_key,

        -- Natural key
        offering_type_id,

        -- Attributes
        offering_type_name,
        offering_type_category,
        qualification_level,
        grading_scale,
        is_academic,
        is_vocational,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:02:18.400423 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:9025efde-b86c-43b1-835b-48c0154e6175&page=queryresults
[0m22:02:18.494345 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e1d3c0ec-f0e5-4d18-bc01-5a9c1e0d5d17&page=queryresults
[0m22:02:18.624391 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d57d244f-4362-4237-8bae-efac5c4b6033&page=queryresults
[0m22:02:18.673504 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:77fa92a9-6ab3-4319-8b15-c3f8be9ef495&page=queryresults
[0m22:02:20.098001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138879b20>]}
[0m22:02:20.098736 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics.dim_student ....................... [[32mCREATE TABLE (50.0 rows, 3.6 KiB processed)[0m in 2.72s]
[0m22:02:20.099293 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_student
[0m22:02:20.099687 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:02:20.100113 [info ] [Thread-1 (]: 9 of 13 START sql table model analytics.fct_alps_subject_performance ........... [RUN]
[0m22:02:20.100449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_student, now model.barton_peveril_analytics.fct_alps_subject_performance)
[0m22:02:20.100680 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:02:20.103670 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:02:20.104288 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:02:20.105990 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:02:20.106413 [debug] [Thread-1 (]: On model.barton_peveril_analytics.fct_alps_subject_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_alps_subject_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_alps_subject_performance`
      
    
    cluster by academic_year_key, alps_subject_name

    
    OPTIONS()
    as (
      with alps_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match ALPS subjects to internal offerings
subject_mapping as (

    select
        ap.academic_year_id,
        ap.alps_subject_name,
        ap.qualification_type,
        o.offering_key,
        o.offering_id,
        -- Simple mapping status based on whether match found
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from alps_performance ap
    left join dim_offering o
        on ap.alps_subject_name = o.alps_subject_name
        and ap.academic_year_id = o.academic_year_id

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ap.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.alps_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as alps_subject_performance_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- ALPS identifiers
        ap.alps_subject_name,
        ap.qualification_type as alps_qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        ap.cohort_count,
        ap.average_gcse_on_entry,

        -- ALPS benchmarking metrics
        ap.alps_band,
        ap.alps_score,
        ap.value_added_score,
        ap.national_benchmark_grade,

        -- Performance percentages
        ap.pass_rate_pct,
        ap.high_grades_pct,

        -- Metadata
        ap.report_date as alps_report_date,
        ap.record_source,
        ap.loaded_at

    from alps_performance ap
    inner join dim_academic_year ay
        on ap.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on ap.academic_year_id = sm.academic_year_id
        and ap.alps_subject_name = sm.alps_subject_name
        and ap.qualification_type = sm.qualification_type

)

select * from final
    );
  
[0m22:02:20.106684 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:02:20.249311 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d6ab2f0>]}
[0m22:02:20.249709 [info ] [Thread-3 (]: 6 of 13 OK created sql table model analytics.dim_prior_attainment .............. [[32mCREATE TABLE (78.0 rows, 4.8 KiB processed)[0m in 2.88s]
[0m22:02:20.250154 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:02:20.250356 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_college_performance
[0m22:02:20.251076 [info ] [Thread-3 (]: 10 of 13 START sql table model analytics.fct_college_performance ............... [RUN]
[0m22:02:20.252025 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_prior_attainment, now model.barton_peveril_analytics.fct_college_performance)
[0m22:02:20.252856 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388a7290>]}
[0m22:02:20.253053 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_college_performance
[0m22:02:20.253330 [info ] [Thread-4 (]: 5 of 13 OK created sql table model analytics.dim_offering_type ................. [[32mCREATE TABLE (7.0 rows, 328.0 Bytes processed)[0m in 2.88s]
[0m22:02:20.255547 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:02:20.255798 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_offering_type
[0m22:02:20.256010 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.fct_equity_gap
[0m22:02:20.256258 [info ] [Thread-4 (]: 11 of 13 START sql table model analytics.fct_equity_gap ........................ [RUN]
[0m22:02:20.256498 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_offering_type, now model.barton_peveril_analytics.fct_equity_gap)
[0m22:02:20.256680 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.fct_equity_gap
[0m22:02:20.259163 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:02:20.259604 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_college_performance
[0m22:02:20.261322 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:02:20.261798 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.fct_equity_gap
[0m22:02:20.263337 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:02:20.263677 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_college_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_college_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_college_performance`
      
    
    cluster by academic_year_key, report_type

    
    OPTIONS()
    as (
      with college_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(cp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(cp.report_type as string), '_dbt_null_')
                
            
        )
    )
 as college_performance_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifiers
        cp.report_type,
        cp.report_name,

        -- Cohort measures
        cp.total_cohort_count,

        -- Performance metrics (from Sixth Sense)
        cp.avg_pass_rate_pct,
        cp.avg_high_grades_pct,
        cp.avg_completion_rate_pct,
        cp.avg_retention_rate_pct,
        cp.avg_achievement_rate_pct,
        cp.avg_attendance_rate_pct,

        -- Value-added metrics (from VA reports)
        cp.avg_value_added_score,
        cp.avg_confidence_lower,
        cp.avg_confidence_upper,

        -- Metadata
        cp.report_date,
        cp.record_source,
        cp.loaded_at

    from college_performance cp
    inner join dim_academic_year ay
        on cp.academic_year_id = ay.academic_year_id

)

select * from final
    );
  
[0m22:02:20.263919 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:02:20.264115 [debug] [Thread-4 (]: On model.barton_peveril_analytics.fct_equity_gap: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_equity_gap"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_equity_gap`
      
    
    cluster by academic_year_key, dimension_name

    
    OPTIONS()
    as (
      with jedi_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

-- Get prior year gaps for trend analysis
with_prior_year as (

    select
        jd.*,
        lag(jd.gap_grade_points) over (
            partition by jd.dimension_name, jd.student_group
            order by jd.academic_year_id
        ) as prior_year_gap

    from jedi_data jd

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wp.jedi_report_id as string), '_dbt_null_')
                
            
        )
    )
 as equity_gap_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifier
        wp.report_type,
        wp.dimension_name,

        -- Group comparison
        wp.student_group,
        wp.comparison_group,

        -- Cohort metrics
        wp.student_count,
        wp.comparison_count,

        -- Performance metrics
        wp.student_avg_grade_points,
        wp.comparison_avg_grade_points,

        -- Gap analysis
        wp.gap_grade_points,
        wp.gap_significance,
        wp.performance_band,

        -- Trend indicators
        wp.prior_year_gap,
        wp.gap_grade_points - wp.prior_year_gap as gap_change_yoy,
        case
            when abs(wp.gap_grade_points) < abs(wp.prior_year_gap) then 'Narrowing'
            when abs(wp.gap_grade_points) > abs(wp.prior_year_gap) then 'Widening'
            else 'Stable'
        end as gap_trend,

        -- Metadata
        wp.report_date,
        wp.record_source,
        wp.loaded_at

    from with_prior_year wp
    inner join dim_academic_year ay
        on wp.academic_year_id = ay.academic_year_id

)

select * from final
    );
  
[0m22:02:20.285588 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:02:20.620609 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1389279b0>]}
[0m22:02:20.620973 [info ] [Thread-2 (]: 8 of 13 OK created sql table model analytics.dim_student_detail ................ [[32mCREATE TABLE (78.0 rows, 14.4 KiB processed)[0m in 3.16s]
[0m22:02:20.621228 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_student_detail
[0m22:02:20.621400 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:02:20.621621 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics.fct_subject_benchmark ................. [RUN]
[0m22:02:20.621857 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_student_detail, now model.barton_peveril_analytics.fct_subject_benchmark)
[0m22:02:20.622070 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:02:20.624280 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:02:20.625106 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:02:20.713081 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:02:20.713667 [debug] [Thread-2 (]: On model.barton_peveril_analytics.fct_subject_benchmark: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_subject_benchmark"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_subject_benchmark`
      
    
    cluster by academic_year_key, six_dimensions_subject_name

    
    OPTIONS()
    as (
      with subject_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match Six Dimensions subjects to internal offerings
subject_mapping as (

    select
        sp.academic_year_id,
        sp.six_dimensions_subject_name,
        o.offering_key,
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from subject_performance sp
    left join dim_offering o
        on sp.six_dimensions_subject_name = o.six_dimensions_subject_name
        and sp.academic_year_id = o.academic_year_id

),

-- Calculate year-over-year change for trajectory
with_trajectory as (

    select
        sp.*,
        lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name, sp.report_type
            order by sp.academic_year_id
        ) as prior_year_pass_rate,
        sp.pass_rate_pct - lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name, sp.report_type
            order by sp.academic_year_id
        ) as yoy_change_pct

    from subject_performance sp

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wt.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.six_dimensions_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.report_type as string), '_dbt_null_')
                
            
        )
    )
 as subject_benchmark_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- Source identifiers
        wt.report_type,
        wt.six_dimensions_subject_name,
        wt.qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        wt.cohort_count,
        wt.average_gcse_on_entry,

        -- Performance metrics
        wt.pass_rate_pct,
        wt.high_grades_pct,
        wt.completion_rate_pct,
        wt.achievement_rate_pct,

        -- Value-added metrics (from VA reports)
        wt.value_added_score,
        wt.residual_score,
        wt.expected_grade,
        wt.actual_avg_grade,
        wt.performance_band,
        wt.confidence_interval_lower,
        wt.confidence_interval_upper,

        -- Sixth Sense metrics
        wt.performance_quartile,

        -- Trend indicators
        case
            when wt.yoy_change_pct > 2 then 'Improving'
            when wt.yoy_change_pct < -2 then 'Declining'
            else 'Stable'
        end as performance_trajectory,
        wt.yoy_change_pct,

        -- Metadata
        wt.report_date,
        wt.record_source,
        wt.loaded_at

    from with_trajectory wt
    inner join dim_academic_year ay
        on wt.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on wt.academic_year_id = sm.academic_year_id
        and wt.six_dimensions_subject_name = sm.six_dimensions_subject_name

)

select * from final
    );
  
[0m22:02:20.713895 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:02:21.200319 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:b67c9fbd-6b76-4775-bd6e-3f8b1b07dd0e&page=queryresults
[0m22:02:21.304001 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:cdfd7325-61f2-428c-97db-26a5cddbdcc6&page=queryresults
[0m22:02:21.305961 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:95122efe-eb97-47c6-ad26-4d6ab71ecefe&page=queryresults
[0m22:02:21.687874 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:d012b3dd-59fb-4881-adc1-ac68b2ff4f55&page=queryresults
[0m22:02:23.197657 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138927950>]}
[0m22:02:23.198651 [info ] [Thread-3 (]: 10 of 13 OK created sql table model analytics.fct_college_performance .......... [[32mCREATE TABLE (4.0 rows, 3.3 KiB processed)[0m in 2.95s]
[0m22:02:23.199352 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_college_performance
[0m22:02:23.199667 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_enrolment
[0m22:02:23.200064 [info ] [Thread-3 (]: 13 of 13 START sql table model analytics.fct_enrolment ......................... [RUN]
[0m22:02:23.200465 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.fct_college_performance, now model.barton_peveril_analytics.fct_enrolment)
[0m22:02:23.200740 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_enrolment
[0m22:02:23.206166 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:02:23.206947 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_enrolment
[0m22:02:23.215562 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:02:23.216418 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_enrolment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_enrolment`
      
    partition by date_trunc(academic_year_start_date, year)
    cluster by offering_key, student_key

    
    OPTIONS()
    as (
      with enrolment_context as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering_type as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering_type`

),

dim_course_header as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_course_header`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

dim_student as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student`

),

dim_student_detail as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student_detail`

),

dim_prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`

),

dim_grade as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_grade`

),

final as (

    select
        -- Primary key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ec.enrolment_id as string), '_dbt_null_')
                
            
        )
    )
 as enrolment_key,

        -- Dimension foreign keys (surrogate)
        ay.academic_year_key,
        ot.offering_type_key,
        ch.course_header_key,
        o.offering_key,
        s.student_key,
        sd.student_detail_key,
        pa.prior_attainment_key,
        g.grade_key,

        -- Natural keys (for debugging)
        ec.academic_year_id,
        ec.offering_id,
        ec.student_id,
        ec.student_detail_id,

        -- For partitioning
        ay.academic_year_start_date,

        -- Enrolment status
        ec.completion_status_id,
        ec.completion_status,
        ec.is_completed,

        -- Grade measures
        ec.grade,
        ec.grade_points,
        ec.ucas_points,

        -- A-Level grade flags
        ec.is_grade_a_star,
        ec.is_grade_a,
        ec.is_grade_b,
        ec.is_grade_c,
        ec.is_grade_d,
        ec.is_grade_e,
        ec.is_grade_u,
        ec.is_grade_x,

        -- BTEC grade flags
        ec.is_grade_distinction_star,
        ec.is_grade_distinction,
        ec.is_grade_merit,
        ec.is_grade_pass,

        -- Cumulative grade flags
        ec.is_high_grade,
        ec.is_pass,
        ec.is_grade_a_star_to_a,
        ec.is_grade_a_star_to_b,
        ec.is_grade_a_star_to_c,
        ec.is_grade_a_star_to_e,

        -- Prior attainment
        ec.average_gcse_score,
        ec.prior_attainment_band,
        ec.is_prior_low,
        ec.is_prior_mid,
        ec.is_prior_high,
        ec.is_prior_na,

        -- Demographics
        ec.gender,
        ec.is_male,
        ec.is_female,
        ec.is_disadvantaged_int as is_disadvantaged,
        ec.is_pp_or_fcm_int as is_pupil_premium,
        cast(null as int64) as is_free_school_meals,  -- Need separate flag
        ec.is_sen_int as is_sen,
        ec.is_access_plus_int as is_access_plus,
        ec.ethnicity_group,

        -- Re-sit tracking
        ec.is_first_sit,
        ec.is_resit,
        cast(null as string) as previous_grade,
        cast(null as int64) as previous_grade_points,
        cast(null as int64) as grade_improvement_points,
        cast(null as int64) as time_to_resit_years,

        -- Value-added (placeholder for future calculation)
        cast(null as string) as target_grade,
        cast(null as int64) as target_grade_points,
        cast(null as numeric) as value_added_points,

        -- Counting measure
        ec.enrolment_count,

        -- Metadata
        ec.record_source,
        ec.loaded_at

    from enrolment_context ec

    -- Join to dimensions
    inner join dim_academic_year ay
        on ec.academic_year_id = ay.academic_year_id
    inner join dim_offering_type ot
        on ec.offering_type_id = ot.offering_type_id
    inner join dim_course_header ch
        on ec.course_header_id = ch.course_header_id
    inner join dim_offering o
        on ec.offering_id = o.offering_id
    inner join dim_student s
        on ec.student_id = s.student_id
    inner join dim_student_detail sd
        on ec.student_detail_id = sd.student_detail_id
    left join dim_prior_attainment pa
        on ec.student_id = pa.student_id
    left join dim_grade g
        on ec.grade = g.grade
        and ec.grading_scale = g.grading_scale

)

select * from final
    );
  
[0m22:02:23.216807 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:02:23.413756 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13891ffe0>]}
[0m22:02:23.414403 [info ] [Thread-4 (]: 11 of 13 OK created sql table model analytics.fct_equity_gap ................... [[32mCREATE TABLE (18.0 rows, 2.6 KiB processed)[0m in 3.16s]
[0m22:02:23.414739 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.fct_equity_gap
[0m22:02:23.599959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13891f860>]}
[0m22:02:23.600513 [info ] [Thread-1 (]: 9 of 13 OK created sql table model analytics.fct_alps_subject_performance ...... [[32mCREATE TABLE (30.0 rows, 4.4 KiB processed)[0m in 3.50s]
[0m22:02:23.600904 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:02:23.751450 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067eb3b0>]}
[0m22:02:23.752154 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics.fct_subject_benchmark ............ [[32mCREATE TABLE (104.0 rows, 6.3 KiB processed)[0m in 3.13s]
[0m22:02:23.752673 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:02:24.348398 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e420d686-0578-4f6c-9c9f-37eaa1966d7f&page=queryresults
[0m22:02:24.471703 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e420d686-0578-4f6c-9c9f-37eaa1966d7f&page=queryresults
[0m22:02:24.481636 [debug] [Thread-3 (]: Database Error in model fct_enrolment (models/marts/facts/fct_enrolment.sql)
  Name grade_points not found inside ec at [108:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_enrolment.sql
[0m22:02:24.482123 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdea0065-be22-491f-a9c8-bd9af75eb5e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108689bb0>]}
[0m22:02:24.482612 [error] [Thread-3 (]: 13 of 13 ERROR creating sql table model analytics.fct_enrolment ................ [[31mERROR[0m in 1.28s]
[0m22:02:24.482999 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_enrolment
[0m22:02:24.483314 [debug] [Thread-7 (]: Marking all children of 'model.barton_peveril_analytics.fct_enrolment' to be skipped because of status 'error'.  Reason: Database Error in model fct_enrolment (models/marts/facts/fct_enrolment.sql)
  Name grade_points not found inside ec at [108:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_enrolment.sql.
[0m22:02:24.484666 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:02:24.485647 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:02:24.485834 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_alps_subject_performance' was properly closed.
[0m22:02:24.485988 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_subject_benchmark' was properly closed.
[0m22:02:24.486132 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_enrolment' was properly closed.
[0m22:02:24.486272 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_equity_gap' was properly closed.
[0m22:02:24.486487 [info ] [MainThread]: 
[0m22:02:24.486668 [info ] [MainThread]: Finished running 13 table models in 0 hours 0 minutes and 13.09 seconds (13.09s).
[0m22:02:24.487887 [debug] [MainThread]: Command end result
[0m22:02:24.518462 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:02:24.519927 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:02:24.523095 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m22:02:24.523235 [info ] [MainThread]: 
[0m22:02:24.523377 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:02:24.523492 [info ] [MainThread]: 
[0m22:02:24.523634 [error] [MainThread]: [31mFailure in model fct_enrolment (models/marts/facts/fct_enrolment.sql)[0m
[0m22:02:24.523771 [error] [MainThread]:   Database Error in model fct_enrolment (models/marts/facts/fct_enrolment.sql)
  Name grade_points not found inside ec at [108:12]
  compiled code at target/run/barton_peveril_analytics/models/marts/facts/fct_enrolment.sql
[0m22:02:24.523871 [info ] [MainThread]: 
[0m22:02:24.523993 [info ] [MainThread]:   compiled code at target/compiled/barton_peveril_analytics/models/marts/facts/fct_enrolment.sql
[0m22:02:24.524103 [info ] [MainThread]: 
[0m22:02:24.524218 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=13
[0m22:02:24.524429 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 8 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:02:24.526901 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.255786, "process_in_blocks": "0", "process_kernel_time": 0.522706, "process_mem_max_rss": "396312576", "process_out_blocks": "0", "process_user_time": 5.010815}
[0m22:02:24.527079 [debug] [MainThread]: Command `dbt run` failed at 22:02:24.527041 after 15.26 seconds
[0m22:02:24.527225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d76f2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f7ce30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5d33b0>]}
[0m22:02:24.527357 [debug] [MainThread]: Flushing usage events
[0m22:02:25.316640 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:03:54.344452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048c31a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b0140>]}


============================== 22:03:54.346882 | af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7 ==============================
[0m22:03:54.346882 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:03:54.347108 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'target_path': 'None', 'static_parser': 'True', 'log_format': 'default', 'profiles_dir': '/Users/markrittman/.dbt', 'empty': 'False', 'warn_error': 'None', 'write_json': 'True', 'no_print': 'None', 'invocation_command': 'dbt run --select fct_enrolment --target dev', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'use_colors': 'True'}
[0m22:03:55.908575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e12570>]}
[0m22:03:55.928605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118fc3e30>]}
[0m22:03:55.928882 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m22:03:56.035559 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m22:03:56.117768 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:03:56.118268 [debug] [MainThread]: Partial parsing: updated file: barton_peveril_analytics://models/marts/facts/fct_enrolment.sql
[0m22:03:56.232974 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships`. Arguments to generic tests
should be nested under the `arguments` property.`
[0m22:03:56.233227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119609160>]}
[0m22:03:56.273988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119c19be0>]}
[0m22:03:56.320188 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:03:56.321244 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:03:56.336296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e8b080>]}
[0m22:03:56.336512 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m22:03:56.336635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119fa8aa0>]}
[0m22:03:56.337745 [info ] [MainThread]: 
[0m22:03:56.337883 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:03:56.337980 [info ] [MainThread]: 
[0m22:03:56.338160 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:03:56.338502 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m22:03:56.338658 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:03:57.185767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_staging)
[0m22:03:57.186356 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics'
[0m22:03:57.186648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:57.187044 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_six_dimensions'
[0m22:03:57.187295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:03:57.187708 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_alps'
[0m22:03:57.216809 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:03:57.239149 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:03:57.768500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m22:03:57.769831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_seed)
[0m22:03:57.772794 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:57.773986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:57.775030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now list_ra-warehouse-dev_analytics_seed_raw_mis_applications)
[0m22:03:57.807080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:57.829043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now list_ra-warehouse-dev_analytics_integration)
[0m22:03:57.847883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:58.323600 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m22:03:58.324152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:58.735439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f62900>]}
[0m22:03:58.735969 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:03:58.739312 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.fct_enrolment
[0m22:03:58.739795 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_enrolment ........................... [RUN]
[0m22:03:58.740133 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now model.barton_peveril_analytics.fct_enrolment)
[0m22:03:58.740398 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.fct_enrolment
[0m22:03:58.748054 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:03:58.748795 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.fct_enrolment
[0m22:03:58.773223 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:03:58.773770 [debug] [Thread-1 (]: On model.barton_peveril_analytics.fct_enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_enrolment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_enrolment`
      
    partition by date_trunc(academic_year_start_date, year)
    cluster by offering_key, student_key

    
    OPTIONS()
    as (
      with enrolment_context as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering_type as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering_type`

),

dim_course_header as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_course_header`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

dim_student as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student`

),

dim_student_detail as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student_detail`

),

dim_prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`

),

dim_grade as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_grade`

),

final as (

    select
        -- Primary key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ec.enrolment_id as string), '_dbt_null_')
                
            
        )
    )
 as enrolment_key,

        -- Dimension foreign keys (surrogate)
        ay.academic_year_key,
        ot.offering_type_key,
        ch.course_header_key,
        o.offering_key,
        s.student_key,
        sd.student_detail_key,
        pa.prior_attainment_key,
        g.grade_key,

        -- Natural keys (for debugging)
        ec.academic_year_id,
        ec.offering_id,
        ec.student_id,
        ec.student_detail_id,

        -- For partitioning
        ay.academic_year_start_date,

        -- Enrolment status
        ec.completion_status_id,
        ec.completion_status,
        ec.is_completed,

        -- Grade measures
        ec.grade,
        ec.target_grade,
        ec.predicted_grade,

        -- A-Level grade flags
        ec.is_grade_a_star,
        ec.is_grade_a,
        ec.is_grade_b,
        ec.is_grade_c,
        ec.is_grade_d,
        ec.is_grade_e,
        ec.is_grade_u,

        -- BTEC grade flags
        ec.is_grade_distinction_star,
        ec.is_grade_distinction,
        ec.is_grade_merit,
        ec.is_grade_pass,

        -- Cumulative grade flags
        ec.is_high_grade,
        ec.is_pass,

        -- Prior attainment
        ec.average_gcse_score,
        ec.prior_attainment_band,

        -- Demographics
        ec.gender,
        ec.ethnicity,
        ec.is_send,
        ec.is_free_meals,
        ec.is_bursary,
        ec.is_lac,
        ec.is_young_carer,

        -- Attendance
        ec.attendance_pct,

        -- Counting measure
        ec.enrolment_count,

        -- Metadata
        ec.record_source,
        ec.loaded_at

    from enrolment_context ec

    -- Join to dimensions
    inner join dim_academic_year ay
        on ec.academic_year_id = ay.academic_year_id
    inner join dim_offering_type ot
        on ec.offering_type_id = ot.offering_type_id
    inner join dim_course_header ch
        on ec.course_header_id = ch.course_header_id
    inner join dim_offering o
        on ec.offering_id = o.offering_id
    inner join dim_student s
        on ec.student_id = s.student_id
    left join dim_student_detail sd
        on ec.student_detail_id = sd.student_detail_id
    left join dim_prior_attainment pa
        on ec.student_id = pa.student_id
        and ec.academic_year_id = pa.academic_year_id
    left join dim_grade g
        on ec.grade = g.grade
        and ec.grading_scale = g.grading_scale

)

select * from final
    );
  
[0m22:03:58.774043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:00.089218 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:b16ba25f-d649-417f-95c9-956c3543a3f2&page=queryresults
[0m22:04:02.879765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af5311c4-be1c-43f2-8cda-ab3d2e5bb4f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1166d1ac0>]}
[0m22:04:02.880168 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_enrolment ...................... [[32mCREATE TABLE (157.0 rows, 23.5 KiB processed)[0m in 4.14s]
[0m22:04:02.880456 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.fct_enrolment
[0m22:04:02.881122 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:04:02.881907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:04:02.882065 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_enrolment' was properly closed.
[0m22:04:02.882188 [debug] [MainThread]: Connection 'list_ra-warehouse-dev_analytics_seed_raw_prosolution' was properly closed.
[0m22:04:02.882300 [debug] [MainThread]: Connection 'list_ra-warehouse-dev_analytics_integration' was properly closed.
[0m22:04:02.882407 [debug] [MainThread]: Connection 'list_ra-warehouse-dev_analytics_seed' was properly closed.
[0m22:04:02.882535 [info ] [MainThread]: 
[0m22:04:02.882672 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.54 seconds (6.54s).
[0m22:04:02.882969 [debug] [MainThread]: Command end result
[0m22:04:02.983976 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:04:02.984910 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:04:02.987849 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m22:04:02.987953 [info ] [MainThread]: 
[0m22:04:02.988088 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:04:02.988176 [info ] [MainThread]: 
[0m22:04:02.988276 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:04:02.988533 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:04:02.991111 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.677829, "process_in_blocks": "0", "process_kernel_time": 0.410346, "process_mem_max_rss": "399261696", "process_out_blocks": "0", "process_user_time": 3.278657}
[0m22:04:02.991279 [debug] [MainThread]: Command `dbt run` succeeded at 22:04:02.991251 after 8.68 seconds
[0m22:04:02.991403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046ae540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046af9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d8daba0>]}
[0m22:04:02.991517 [debug] [MainThread]: Flushing usage events
[0m22:04:03.736019 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:04:12.069101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11132d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11134b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111348d40>]}


============================== 22:04:12.071301 | c858f1f6-9bed-4a29-88cc-6e5c3336d0ba ==============================
[0m22:04:12.071301 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:04:12.071528 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'fail_fast': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_path': '/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs', 'cache_selected_only': 'False', 'invocation_command': 'dbt run --select intermediate marts --target dev', 'use_colors': 'True', 'partial_parse': 'True', 'target_path': 'None', 'static_parser': 'True', 'version_check': 'True', 'profiles_dir': '/Users/markrittman/.dbt', 'quiet': 'False'}
[0m22:04:13.385402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1447f7110>]}
[0m22:04:13.407797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e591f10>]}
[0m22:04:13.408120 [info ] [MainThread]: Registered adapter: bigquery=1.10.3
[0m22:04:13.514966 [debug] [MainThread]: checksum: 0f45fdd67cc51382d6521f874e757e7afa214ac7bb0178b13f1819cbe813499c, vars: {}, profile: , target: dev, version: 1.10.15
[0m22:04:13.595679 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:04:13.595869 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:04:13.616775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144ccd0a0>]}
[0m22:04:13.662251 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:04:13.663257 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:04:13.677102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144a2ed80>]}
[0m22:04:13.677326 [info ] [MainThread]: Found 33 models, 17 seeds, 108 data tests, 15 sources, 672 macros
[0m22:04:13.677460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14737b590>]}
[0m22:04:13.679034 [info ] [MainThread]: 
[0m22:04:13.679172 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:04:13.679271 [info ] [MainThread]: 
[0m22:04:13.679457 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:04:13.681165 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m22:04:13.681340 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:13.681499 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev'
[0m22:04:13.700750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:14.387505 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed)
[0m22:04:14.387929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev, now list_ra-warehouse-dev_analytics_seed_raw_prosolution)
[0m22:04:14.388169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:14.388491 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_mis_applications'
[0m22:04:14.388688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:14.388980 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_ra-warehouse-dev_analytics_seed_raw_alps'
[0m22:04:14.390283 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:14.418025 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:14.849929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_prosolution, now list_ra-warehouse-dev_analytics_seed_raw_focus)
[0m22:04:14.850780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:14.879487 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_alps, now list_ra-warehouse-dev_analytics_integration)
[0m22:04:14.879844 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:14.903687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_mis_applications, now list_ra-warehouse-dev_analytics_staging)
[0m22:04:14.903871 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:14.924072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed, now list_ra-warehouse-dev_analytics_seed_raw_six_dimensions)
[0m22:04:14.924404 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:15.268873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_focus, now list_ra-warehouse-dev_analytics)
[0m22:04:15.269273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:15.746497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14481c1a0>]}
[0m22:04:15.747032 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:04:15.750320 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_academic_year
[0m22:04:15.750705 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_course_header
[0m22:04:15.751045 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_grade
[0m22:04:15.751795 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_offering
[0m22:04:15.751546 [info ] [Thread-1 (]: 1 of 18 START sql table model analytics.dim_academic_year ...................... [RUN]
[0m22:04:15.752329 [info ] [Thread-2 (]: 2 of 18 START sql table model analytics.dim_course_header ...................... [RUN]
[0m22:04:15.752827 [info ] [Thread-3 (]: 3 of 18 START sql table model analytics.dim_grade .............................. [RUN]
[0m22:04:15.753219 [info ] [Thread-4 (]: 4 of 18 START sql table model analytics.dim_offering ........................... [RUN]
[0m22:04:15.753546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_seed_raw_six_dimensions, now model.barton_peveril_analytics.dim_academic_year)
[0m22:04:15.753807 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics, now model.barton_peveril_analytics.dim_course_header)
[0m22:04:15.754036 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_staging, now model.barton_peveril_analytics.dim_grade)
[0m22:04:15.754254 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly list_ra-warehouse-dev_analytics_integration, now model.barton_peveril_analytics.dim_offering)
[0m22:04:15.754483 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_academic_year
[0m22:04:15.755497 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_course_header
[0m22:04:15.755957 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_grade
[0m22:04:15.756191 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_offering
[0m22:04:15.764803 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:04:15.767683 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_course_header"
[0m22:04:15.769728 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_grade"
[0m22:04:15.771849 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering"
[0m22:04:15.772565 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_course_header
[0m22:04:15.772780 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_grade
[0m22:04:15.772952 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_offering
[0m22:04:15.773108 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_academic_year
[0m22:04:15.780658 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:04:15.781859 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:04:15.782925 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:04:15.783945 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:16.414212 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_academic_year"
[0m22:04:16.414777 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_course_header"
[0m22:04:16.415248 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_grade"
[0m22:04:16.416192 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_academic_year: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_academic_year"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_academic_year`
      
    
    

    
    OPTIONS()
    as (
      with academic_years as (

    -- Get distinct academic years from offerings
    select distinct
        academic_year_id
    from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where academic_year_id is not null

),

enriched as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(academic_year_id as string), '_dbt_null_')
                
            
        )
    )
 as academic_year_key,

        -- Natural key
        academic_year_id,

        -- Attributes
        concat('20', substr(academic_year_id, 1, 2), '/', '20', substr(academic_year_id, 4, 2)) as academic_year_name,

        -- Date parsing (assuming academic year starts Sept 1)
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 1, 2), '-09-01')) as academic_year_start_date,
        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 4, 2), '-08-31')) as academic_year_end_date,

        -- Calendar years
        cast(concat('20', substr(academic_year_id, 1, 2)) as int64) as calendar_year_start,
        cast(concat('20', substr(academic_year_id, 4, 2)) as int64) as calendar_year_end,

        -- Current year flag
        case
            when academic_year_id = '24/25' then true
            else false
        end as is_current_year,

        -- Years from current (for trending)
        array_length(
            array(
                select ay from unnest(['19/20', '20/21', '21/22', '22/23', '23/24', '24/25']) as ay
                where ay >= academic_year_id and ay <= '24/25'
            )
        ) - 1 as years_from_current,

        -- Metadata
        'prosolution' as record_source,
        current_timestamp() as loaded_at

    from academic_years

)

select * from enriched
order by academic_year_id desc
    );
  
[0m22:04:16.416494 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_grade: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_grade"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_grade`
      
    
    

    
    OPTIONS()
    as (
      with grade_points as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_grade_points`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(grade as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as grade_key,

        -- Natural key
        grade,
        qualification_type as grading_scale,

        -- Point values
        ucas_points,
        grade_points,
        grade_sort_order,

        -- Grade classification flags
        is_high_grade,
        is_pass as is_pass_grade,

        -- Cumulative grade flags (A-Level specific)
        case when grade in ('A*', 'A') then true else false end as is_grade_a_star_to_a,
        case when grade in ('A*', 'A', 'B') then true else false end as is_grade_a_star_to_b,
        case when grade in ('A*', 'A', 'B', 'C') then true else false end as is_grade_a_star_to_c,
        case when grade in ('A*', 'A', 'B', 'C', 'D', 'E') then true else false end as is_grade_a_star_to_e,

        -- Metadata
        'seed' as record_source,
        current_timestamp() as loaded_at

    from grade_points

)

select * from final
    );
  
[0m22:04:16.416765 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_course_header: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_course_header"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_course_header`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(course_header_id as string), '_dbt_null_')
                
            
        )
    )
 as course_header_key,

        -- Natural key
        course_header_id,

        -- Attributes
        course_code,
        course_name,
        subject_area,
        department,
        is_active,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:04:16.417982 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering"
[0m22:04:16.419227 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_offering: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where is_valid_qualification = true

),

subject_crosswalk as (

    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(o.offering_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_key,

        -- Natural key
        o.offering_id,

        -- Attributes
        o.offering_code,
        o.offering_name,
        o.qualification_id,
        o.study_year,
        o.duration_years,
        o.is_final_year,

        -- Foreign keys (natural keys for joins)
        o.academic_year_id,
        o.offering_type_id,
        o.course_header_id,

        -- External system mappings for benchmarking (from crosswalk)
        sc.dfe_qualification_code,
        sc.alps_subject_name,
        sc.six_dimensions_subject_name,

        -- Metadata
        o.record_source,
        o.loaded_at

    from source o
    left join subject_crosswalk sc
        on o.course_header_id = sc.course_header_id

)

select * from final
    );
  
[0m22:04:16.724377 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6915c1e4-d4e2-4e35-8c40-a146f1e62453&page=queryresults
[0m22:04:16.959698 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:7b73891f-28f6-4d7e-bd84-6db77475333c&page=queryresults
[0m22:04:16.966215 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:be0c145a-0c68-4549-b447-5a43a070c33f&page=queryresults
[0m22:04:17.108594 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:66d45c09-cc49-4773-aad6-013fa2452606&page=queryresults
[0m22:04:18.504710 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e5d1c10>]}
[0m22:04:18.505055 [info ] [Thread-3 (]: 3 of 18 OK created sql table model analytics.dim_grade ......................... [[32mCREATE TABLE (19.0 rows, 778.0 Bytes processed)[0m in 2.75s]
[0m22:04:18.505302 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_grade
[0m22:04:18.505468 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.dim_offering_type
[0m22:04:18.505713 [info ] [Thread-3 (]: 5 of 18 START sql table model analytics.dim_offering_type ...................... [RUN]
[0m22:04:18.505932 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_grade, now model.barton_peveril_analytics.dim_offering_type)
[0m22:04:18.506087 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.dim_offering_type
[0m22:04:18.507561 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:04:18.507985 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.dim_offering_type
[0m22:04:18.509132 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:04:18.715945 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147402cf0>]}
[0m22:04:18.716325 [info ] [Thread-4 (]: 4 of 18 OK created sql table model analytics.dim_offering ...................... [[32mCREATE TABLE (30.0 rows, 3.7 KiB processed)[0m in 2.96s]
[0m22:04:18.716603 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_offering
[0m22:04:18.716789 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:04:18.717038 [info ] [Thread-4 (]: 6 of 18 START sql table model analytics.dim_prior_attainment ................... [RUN]
[0m22:04:18.717270 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_offering, now model.barton_peveril_analytics.dim_prior_attainment)
[0m22:04:18.717432 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.dim_prior_attainment
[0m22:04:18.719431 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:04:18.719803 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.dim_prior_attainment
[0m22:04:18.720890 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:04:18.809476 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143741670>]}
[0m22:04:18.809879 [info ] [Thread-2 (]: 2 of 18 OK created sql table model analytics.dim_course_header ................. [[32mCREATE TABLE (15.0 rows, 739.0 Bytes processed)[0m in 3.06s]
[0m22:04:18.810143 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_course_header
[0m22:04:18.810312 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.dim_student
[0m22:04:18.810532 [info ] [Thread-2 (]: 7 of 18 START sql table model analytics.dim_student ............................ [RUN]
[0m22:04:18.810737 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_course_header, now model.barton_peveril_analytics.dim_student)
[0m22:04:18.810887 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.dim_student
[0m22:04:18.813260 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student"
[0m22:04:18.813640 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.dim_student
[0m22:04:18.814748 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:04:18.914368 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_offering_type"
[0m22:04:18.914802 [debug] [Thread-3 (]: On model.barton_peveril_analytics.dim_offering_type: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_offering_type"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_offering_type`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(offering_type_id as string), '_dbt_null_')
                
            
        )
    )
 as offering_type_key,

        -- Natural key
        offering_type_id,

        -- Attributes
        offering_type_name,
        offering_type_category,
        qualification_level,
        grading_scale,
        is_academic,
        is_vocational,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:04:19.096710 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_prior_attainment"
[0m22:04:19.098135 [debug] [Thread-4 (]: On model.barton_peveril_analytics.dim_prior_attainment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_prior_attainment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(average_gcse_id as string), '_dbt_null_')
                
            
        )
    )
 as prior_attainment_key,

        -- Natural keys
        average_gcse_id,
        student_id,
        academic_year_id,

        -- GCSE metrics
        average_gcse_score,
        prior_attainment_band,
        prior_attainment_band_code,

        -- Thresholds (from project variables)
        cast(4.77 as numeric) as low_threshold,
        cast(6.09 as numeric) as high_threshold,

        -- Individual subject grades
        gcse_english_grade,
        gcse_maths_grade,
        gcse_count,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:04:19.160693 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student"
[0m22:04:19.161306 [debug] [Thread-2 (]: On model.barton_peveril_analytics.dim_student: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_id as string), '_dbt_null_')
                
            
        )
    )
 as student_key,

        -- Natural key
        student_id,

        -- Identifiers
        uln,

        -- Demographics
        first_name,
        last_name,
        full_name,
        date_of_birth,
        gender,
        ethnicity,

        -- Status
        is_active,

        -- Dates
        created_at as first_enrolment_date,

        -- SCD Type 2 tracking (simplified - single version per student)
        date(created_at) as valid_from_date,
        cast(null as date) as valid_to_date,
        true as is_current,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:04:19.201094 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14484e900>]}
[0m22:04:19.201593 [info ] [Thread-1 (]: 1 of 18 OK created sql table model analytics.dim_academic_year ................. [[32mCREATE TABLE (2.0 rows, 210.0 Bytes processed)[0m in 3.45s]
[0m22:04:19.201955 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_academic_year
[0m22:04:19.202135 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m22:04:19.202475 [info ] [Thread-1 (]: 8 of 18 START sql view model analytics_integration.int_alps_performance_unioned  [RUN]
[0m22:04:19.202803 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_academic_year, now model.barton_peveril_analytics.int_alps_performance_unioned)
[0m22:04:19.202963 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.int_alps_performance_unioned
[0m22:04:19.204798 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m22:04:19.207861 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.int_alps_performance_unioned
[0m22:04:19.219529 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_alps_performance_unioned"
[0m22:04:19.220249 [debug] [Thread-1 (]: On model.barton_peveril_analytics.int_alps_performance_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_alps_performance_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`
  OPTIONS()
  as with a_level as (

    select
        alps_report_id                                  as report_id,
        academic_year_id,
        alps_subject_name,
        'A-Level'                                       as qualification_type,
        cast(null as string)                            as qualification_size,
        cohort_count,
        average_gcse_on_entry,

        -- ALPS metrics
        alps_band,
        alps_score,
        value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        pass_rate_pct,
        high_grades_pct,

        -- Source metadata
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`

),

btec as (

    select
        alps_btec_report_id                             as report_id,
        academic_year_id,
        alps_subject_name,
        qualification_type,
        cast(null as string)                            as qualification_size,
        cohort_count,
        average_gcse_on_entry,

        -- ALPS metrics
        alps_band,
        alps_score,
        value_added_score,
        national_benchmark_grade,

        -- Performance percentages
        pass_rate_pct,
        high_grades_pct,

        -- Source metadata
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`

),

unioned as (

    select * from a_level
    union all
    select * from btec

)

select * from unioned;


[0m22:04:19.221040 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:19.473417 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:47be6b04-dd05-47d4-aeb2-bf3d22d4f9a1&page=queryresults
[0m22:04:19.681154 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:2e12e273-70ba-46b9-a592-300c3d25ae8c&page=queryresults
[0m22:04:19.722407 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:483f099b-fbf4-467f-bde7-8bea83b845ad&page=queryresults
[0m22:04:20.041057 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:e9ce374e-cadd-47b1-9879-ab7ce037dfd1&page=queryresults
[0m22:04:20.413728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b6b5c0>]}
[0m22:04:20.414167 [info ] [Thread-1 (]: 8 of 18 OK created sql view model analytics_integration.int_alps_performance_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.21s]
[0m22:04:20.414469 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_alps_performance_unioned
[0m22:04:20.414749 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m22:04:20.415118 [info ] [Thread-1 (]: 9 of 18 START sql view model analytics_integration.int_six_dimensions_college_unioned  [RUN]
[0m22:04:20.415356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.int_alps_performance_unioned, now model.barton_peveril_analytics.int_six_dimensions_college_unioned)
[0m22:04:20.415497 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m22:04:20.417132 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m22:04:20.417869 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m22:04:20.418988 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_college_unioned"
[0m22:04:20.419364 [debug] [Thread-1 (]: On model.barton_peveril_analytics.int_six_dimensions_college_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_college_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`
  OPTIONS()
  as with va_aggregated as (

    select
        academic_year_id,
        'VA'                                            as report_type,
        'College Overall'                               as report_name,
        sum(cohort_count)                               as total_cohort_count,
        avg(value_added_score)                          as avg_value_added_score,
        avg(confidence_interval_lower)                  as avg_confidence_lower,
        avg(confidence_interval_upper)                  as avg_confidence_upper,
        min(report_date)                                as report_date,
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    group by academic_year_id

),

sixth_sense_aggregated as (

    select
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        'College Overall'                               as report_name,
        sum(cohort_count)                               as total_cohort_count,
        avg(pass_rate_pct)                              as avg_pass_rate_pct,
        avg(high_grades_pct)                            as avg_high_grades_pct,
        avg(completion_rate_pct)                        as avg_completion_rate_pct,
        avg(retention_rate_pct)                         as avg_retention_rate_pct,
        avg(achievement_rate_pct)                       as avg_achievement_rate_pct,
        avg(attendance_rate_pct)                        as avg_attendance_rate_pct,
        min(report_date)                                as report_date,
        'six_dimensions'                                as record_source,
        current_timestamp()                             as loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    group by academic_year_id

),

unioned as (

    select
        academic_year_id,
        report_type,
        report_name,
        total_cohort_count,
        cast(null as numeric) as avg_pass_rate_pct,
        cast(null as numeric) as avg_high_grades_pct,
        avg_value_added_score,
        avg_confidence_lower,
        avg_confidence_upper,
        cast(null as numeric) as avg_completion_rate_pct,
        cast(null as numeric) as avg_retention_rate_pct,
        cast(null as numeric) as avg_achievement_rate_pct,
        cast(null as numeric) as avg_attendance_rate_pct,
        report_date,
        record_source,
        loaded_at
    from va_aggregated

    union all

    select
        academic_year_id,
        report_type,
        report_name,
        total_cohort_count,
        avg_pass_rate_pct,
        avg_high_grades_pct,
        cast(null as numeric) as avg_value_added_score,
        cast(null as numeric) as avg_confidence_lower,
        cast(null as numeric) as avg_confidence_upper,
        avg_completion_rate_pct,
        avg_retention_rate_pct,
        avg_achievement_rate_pct,
        avg_attendance_rate_pct,
        report_date,
        record_source,
        loaded_at
    from sixth_sense_aggregated

)

select * from unioned;


[0m22:04:20.419620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:21.063341 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b60140>]}
[0m22:04:21.063988 [info ] [Thread-3 (]: 5 of 18 OK created sql table model analytics.dim_offering_type ................. [[32mCREATE TABLE (7.0 rows, 328.0 Bytes processed)[0m in 2.56s]
[0m22:04:21.064459 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.dim_offering_type
[0m22:04:21.064742 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m22:04:21.065135 [info ] [Thread-3 (]: 10 of 18 START sql view model analytics_integration.int_six_dimensions_subject_unioned  [RUN]
[0m22:04:21.065548 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_offering_type, now model.barton_peveril_analytics.int_six_dimensions_subject_unioned)
[0m22:04:21.065822 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m22:04:21.069126 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m22:04:21.069698 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m22:04:21.072718 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"
[0m22:04:21.073252 [debug] [Thread-3 (]: On model.barton_peveril_analytics.int_six_dimensions_subject_unioned: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_six_dimensions_subject_unioned"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`
  OPTIONS()
  as with va_subject as (

    select
        va_report_id                                    as report_id,
        academic_year_id,
        'VA'                                            as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        average_gcse_on_entry,
        value_added_score,
        residual_score,
        expected_grade,
        actual_avg_grade,
        performance_band,
        confidence_interval_lower,
        confidence_interval_upper,
        cast(null as numeric)                           as pass_rate_pct,
        cast(null as numeric)                           as high_grades_pct,
        cast(null as numeric)                           as completion_rate_pct,
        cast(null as numeric)                           as achievement_rate_pct,
        cast(null as string)                            as performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`
    where subject_name is not null

),

sixth_sense_subject as (

    select
        sixth_sense_id                                  as report_id,
        academic_year_id,
        'Sixth Sense'                                   as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        cast(null as numeric)                           as average_gcse_on_entry,
        cast(null as numeric)                           as value_added_score,
        cast(null as numeric)                           as residual_score,
        cast(null as string)                            as expected_grade,
        cast(null as string)                            as actual_avg_grade,
        cast(null as string)                            as performance_band,
        cast(null as numeric)                           as confidence_interval_lower,
        cast(null as numeric)                           as confidence_interval_upper,
        pass_rate_pct,
        high_grades_pct,
        completion_rate_pct,
        achievement_rate_pct,
        performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`
    where subject_name is not null

),

vocational_subject as (

    select
        vocational_report_id                            as report_id,
        academic_year_id,
        'Vocational'                                    as report_type,
        subject_name                                    as six_dimensions_subject_name,
        qualification_type,
        cohort_count,
        average_gcse_on_entry,
        cast(null as numeric)                           as value_added_score,
        cast(null as numeric)                           as residual_score,
        cast(null as string)                            as expected_grade,
        cast(null as string)                            as actual_avg_grade,
        performance_band,
        cast(null as numeric)                           as confidence_interval_lower,
        cast(null as numeric)                           as confidence_interval_upper,
        pass_rate_pct,
        cast(null as numeric)                           as high_grades_pct,
        completion_rate_pct,
        achievement_rate_pct,
        cast(null as string)                            as performance_quartile,
        report_date,
        record_source,
        loaded_at

    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`
    where subject_name is not null

),

unioned as (

    select * from va_subject
    union all
    select * from sixth_sense_subject
    union all
    select * from vocational_subject

)

select * from unioned;


[0m22:04:21.073619 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:04:21.242558 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:6ab569af-93e9-4f0a-b68c-30a706333c95&page=queryresults
[0m22:04:21.466038 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b86cc0>]}
[0m22:04:21.466594 [info ] [Thread-4 (]: 6 of 18 OK created sql table model analytics.dim_prior_attainment .............. [[32mCREATE TABLE (78.0 rows, 4.8 KiB processed)[0m in 2.75s]
[0m22:04:21.466962 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.dim_prior_attainment
[0m22:04:21.467201 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.int_student_demographics_joined
[0m22:04:21.467501 [info ] [Thread-4 (]: 11 of 18 START sql view model analytics_integration.int_student_demographics_joined  [RUN]
[0m22:04:21.467748 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_prior_attainment, now model.barton_peveril_analytics.int_student_demographics_joined)
[0m22:04:21.467943 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.int_student_demographics_joined
[0m22:04:21.470696 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m22:04:21.471160 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.int_student_demographics_joined
[0m22:04:21.472677 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_student_demographics_joined"
[0m22:04:21.473335 [debug] [Thread-4 (]: On model.barton_peveril_analytics.int_student_demographics_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_student_demographics_joined"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`
  OPTIONS()
  as with student as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`

),

student_detail as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`

),

extended_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`

),

prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`

),

joined as (

    select
        -- Keys
        sd.student_detail_id,
        sd.student_id,
        sd.academic_year_id,

        -- Core demographics from student master
        s.first_name,
        s.last_name,
        s.full_name,
        s.date_of_birth,
        s.gender,
        s.ethnicity,
        s.is_active,

        -- Location from student_detail
        sd.postcode,
        sd.postcode_area,

        -- SEND flags from student_detail
        sd.lldd_code,
        sd.is_send,
        sd.is_high_needs,
        sd.primary_send_type,
        sd.secondary_send_type,

        -- Disadvantage flags from student_detail
        sd.is_free_meals,
        sd.is_bursary,
        sd.is_lac,

        -- Extended demographics from MIS Applications
        ed.nationality,
        ed.country_of_birth,
        ed.first_language,
        ed.religion,
        coalesce(ed.is_young_carer, false)              as is_young_carer,
        coalesce(ed.is_parent_carer, false)             as is_parent_carer,
        ed.care_leaver_status,
        ed.household_situation,
        ed.imd_decile,
        ed.polar4_quintile,
        ed.tundra_classification,

        -- Prior attainment from Focus
        pa.average_gcse_score,
        pa.prior_attainment_band,
        pa.prior_attainment_band_code,
        pa.gcse_english_grade,
        pa.gcse_maths_grade,
        pa.gcse_count,

        -- Metadata
        sd.record_source,
        sd.loaded_at

    from student_detail sd
    inner join student s
        on sd.student_id = s.student_id
    left join extended_data ed
        on sd.student_id = ed.student_id
        and sd.academic_year_id = ed.academic_year_id
    left join prior_attainment pa
        on sd.student_id = pa.student_id
        and sd.academic_year_id = pa.academic_year_id

)

select * from joined;


[0m22:04:21.473653 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:04:21.526274 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148ba47a0>]}
[0m22:04:21.526603 [info ] [Thread-1 (]: 9 of 18 OK created sql view model analytics_integration.int_six_dimensions_college_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.11s]
[0m22:04:21.526836 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_college_unioned
[0m22:04:21.526990 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.fct_equity_gap
[0m22:04:21.527211 [info ] [Thread-1 (]: 12 of 18 START sql table model analytics.fct_equity_gap ........................ [RUN]
[0m22:04:21.527467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.int_six_dimensions_college_unioned, now model.barton_peveril_analytics.fct_equity_gap)
[0m22:04:21.527657 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.fct_equity_gap
[0m22:04:21.529594 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:04:21.530145 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.fct_equity_gap
[0m22:04:21.531128 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:21.553472 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14745cf20>]}
[0m22:04:21.553754 [info ] [Thread-2 (]: 7 of 18 OK created sql table model analytics.dim_student ....................... [[32mCREATE TABLE (50.0 rows, 3.6 KiB processed)[0m in 2.74s]
[0m22:04:21.553959 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.dim_student
[0m22:04:21.554163 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:04:21.554362 [info ] [Thread-2 (]: 13 of 18 START sql table model analytics.fct_alps_subject_performance .......... [RUN]
[0m22:04:21.554540 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.dim_student, now model.barton_peveril_analytics.fct_alps_subject_performance)
[0m22:04:21.554673 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:04:21.556548 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:04:21.556878 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:04:21.557790 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:04:21.834723 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:34a96607-7c8e-4a46-90b9-0e144a73a668&page=queryresults
[0m22:04:21.870419 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_alps_subject_performance"
[0m22:04:21.871106 [debug] [Thread-2 (]: On model.barton_peveril_analytics.fct_alps_subject_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_alps_subject_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_alps_subject_performance`
      
    
    cluster by academic_year_key, alps_subject_name

    
    OPTIONS()
    as (
      with alps_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match ALPS subjects to internal offerings
subject_mapping as (

    select
        ap.academic_year_id,
        ap.alps_subject_name,
        ap.qualification_type,
        o.offering_key,
        o.offering_id,
        -- Simple mapping status based on whether match found
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from alps_performance ap
    left join dim_offering o
        on ap.alps_subject_name = o.alps_subject_name
        and ap.academic_year_id = o.academic_year_id

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ap.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.alps_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(ap.qualification_type as string), '_dbt_null_')
                
            
        )
    )
 as alps_subject_performance_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- ALPS identifiers
        ap.alps_subject_name,
        ap.qualification_type as alps_qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        ap.cohort_count,
        ap.average_gcse_on_entry,

        -- ALPS benchmarking metrics
        ap.alps_band,
        ap.alps_score,
        ap.value_added_score,
        ap.national_benchmark_grade,

        -- Performance percentages
        ap.pass_rate_pct,
        ap.high_grades_pct,

        -- Metadata
        ap.report_date as alps_report_date,
        ap.record_source,
        ap.loaded_at

    from alps_performance ap
    inner join dim_academic_year ay
        on ap.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on ap.academic_year_id = sm.academic_year_id
        and ap.alps_subject_name = sm.alps_subject_name
        and ap.qualification_type = sm.qualification_type

)

select * from final
    );
  
[0m22:04:21.877936 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_equity_gap"
[0m22:04:21.878483 [debug] [Thread-1 (]: On model.barton_peveril_analytics.fct_equity_gap: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_equity_gap"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_equity_gap`
      
    
    cluster by academic_year_key, dimension_name

    
    OPTIONS()
    as (
      with jedi_data as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

-- Get prior year gaps for trend analysis
with_prior_year as (

    select
        jd.*,
        lag(jd.gap_grade_points) over (
            partition by jd.dimension_name, jd.student_group
            order by jd.academic_year_id
        ) as prior_year_gap

    from jedi_data jd

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wp.jedi_report_id as string), '_dbt_null_')
                
            
        )
    )
 as equity_gap_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifier
        wp.report_type,
        wp.dimension_name,

        -- Group comparison
        wp.student_group,
        wp.comparison_group,

        -- Cohort metrics
        wp.student_count,
        wp.comparison_count,

        -- Performance metrics
        wp.student_avg_grade_points,
        wp.comparison_avg_grade_points,

        -- Gap analysis
        wp.gap_grade_points,
        wp.gap_significance,
        wp.performance_band,

        -- Trend indicators
        wp.prior_year_gap,
        wp.gap_grade_points - wp.prior_year_gap as gap_change_yoy,
        case
            when abs(wp.gap_grade_points) < abs(wp.prior_year_gap) then 'Narrowing'
            when abs(wp.gap_grade_points) > abs(wp.prior_year_gap) then 'Widening'
            else 'Stable'
        end as gap_trend,

        -- Metadata
        wp.report_date,
        wp.record_source,
        wp.loaded_at

    from with_prior_year wp
    inner join dim_academic_year ay
        on wp.academic_year_id = ay.academic_year_id

)

select * from final
    );
  
[0m22:04:22.072241 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148d69fa0>]}
[0m22:04:22.073089 [info ] [Thread-3 (]: 10 of 18 OK created sql view model analytics_integration.int_six_dimensions_subject_unioned  [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m22:04:22.073641 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.int_six_dimensions_subject_unioned
[0m22:04:22.073994 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_college_performance
[0m22:04:22.074547 [info ] [Thread-3 (]: 14 of 18 START sql table model analytics.fct_college_performance ............... [RUN]
[0m22:04:22.075129 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.int_six_dimensions_subject_unioned, now model.barton_peveril_analytics.fct_college_performance)
[0m22:04:22.075410 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_college_performance
[0m22:04:22.079901 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:04:22.080530 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_college_performance
[0m22:04:22.082184 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:04:22.224366 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:c00ce2b0-76b8-41de-84db-fa768b6aa53b&page=queryresults
[0m22:04:22.469052 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:4dd3a19f-c964-453f-8a87-420b377cb81d&page=queryresults
[0m22:04:22.487639 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:0e61bcec-6aad-4382-8cf5-e6f4f5e8533d&page=queryresults
[0m22:04:22.506115 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148be47a0>]}
[0m22:04:22.506513 [info ] [Thread-4 (]: 11 of 18 OK created sql view model analytics_integration.int_student_demographics_joined  [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m22:04:22.506783 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.int_student_demographics_joined
[0m22:04:22.506963 [debug] [Thread-4 (]: Began running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:04:22.507237 [info ] [Thread-4 (]: 15 of 18 START sql table model analytics.fct_subject_benchmark ................. [RUN]
[0m22:04:22.507506 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.int_student_demographics_joined, now model.barton_peveril_analytics.fct_subject_benchmark)
[0m22:04:22.507682 [debug] [Thread-4 (]: Began compiling node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:04:22.509990 [debug] [Thread-4 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:04:22.511253 [debug] [Thread-4 (]: Began executing node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:04:22.512412 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:04:22.534707 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_college_performance"
[0m22:04:22.535203 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_college_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_college_performance"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_college_performance`
      
    
    cluster by academic_year_key, report_type

    
    OPTIONS()
    as (
      with college_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(cp.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(cp.report_type as string), '_dbt_null_')
                
            
        )
    )
 as college_performance_key,

        -- Dimension foreign key
        ay.academic_year_key,

        -- Source identifiers
        cp.report_type,
        cp.report_name,

        -- Cohort measures
        cp.total_cohort_count,

        -- Performance metrics (from Sixth Sense)
        cp.avg_pass_rate_pct,
        cp.avg_high_grades_pct,
        cp.avg_completion_rate_pct,
        cp.avg_retention_rate_pct,
        cp.avg_achievement_rate_pct,
        cp.avg_attendance_rate_pct,

        -- Value-added metrics (from VA reports)
        cp.avg_value_added_score,
        cp.avg_confidence_lower,
        cp.avg_confidence_upper,

        -- Metadata
        cp.report_date,
        cp.record_source,
        cp.loaded_at

    from college_performance cp
    inner join dim_academic_year ay
        on cp.academic_year_id = ay.academic_year_id

)

select * from final
    );
  
[0m22:04:22.876218 [debug] [Thread-4 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_subject_benchmark"
[0m22:04:22.877130 [debug] [Thread-4 (]: On model.barton_peveril_analytics.fct_subject_benchmark: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_subject_benchmark"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_subject_benchmark`
      
    
    cluster by academic_year_key, six_dimensions_subject_name

    
    OPTIONS()
    as (
      with subject_performance as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

-- Attempt to match Six Dimensions subjects to internal offerings
subject_mapping as (

    select
        sp.academic_year_id,
        sp.six_dimensions_subject_name,
        o.offering_key,
        case
            when o.offering_key is not null then 'Matched'
            else 'Unmapped'
        end as subject_mapping_status,
        case
            when o.offering_key is not null then 100.0
            else 0.0
        end as mapping_confidence_pct

    from subject_performance sp
    left join dim_offering o
        on sp.six_dimensions_subject_name = o.six_dimensions_subject_name
        and sp.academic_year_id = o.academic_year_id

),

-- Calculate year-over-year change for trajectory
with_trajectory as (

    select
        sp.*,
        lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name, sp.report_type
            order by sp.academic_year_id
        ) as prior_year_pass_rate,
        sp.pass_rate_pct - lag(sp.pass_rate_pct) over (
            partition by sp.six_dimensions_subject_name, sp.report_type
            order by sp.academic_year_id
        ) as yoy_change_pct

    from subject_performance sp

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(wt.academic_year_id as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.six_dimensions_subject_name as string), '_dbt_null_')
                , '|', 
            
                coalesce(cast(wt.report_type as string), '_dbt_null_')
                
            
        )
    )
 as subject_benchmark_key,

        -- Dimension foreign keys
        ay.academic_year_key,
        sm.offering_key,

        -- Source identifiers
        wt.report_type,
        wt.six_dimensions_subject_name,
        wt.qualification_type,

        -- Subject mapping
        sm.subject_mapping_status,
        sm.mapping_confidence_pct,

        -- Cohort
        wt.cohort_count,
        wt.average_gcse_on_entry,

        -- Performance metrics
        wt.pass_rate_pct,
        wt.high_grades_pct,
        wt.completion_rate_pct,
        wt.achievement_rate_pct,

        -- Value-added metrics (from VA reports)
        wt.value_added_score,
        wt.residual_score,
        wt.expected_grade,
        wt.actual_avg_grade,
        wt.performance_band,
        wt.confidence_interval_lower,
        wt.confidence_interval_upper,

        -- Sixth Sense metrics
        wt.performance_quartile,

        -- Trend indicators
        case
            when wt.yoy_change_pct > 2 then 'Improving'
            when wt.yoy_change_pct < -2 then 'Declining'
            else 'Stable'
        end as performance_trajectory,
        wt.yoy_change_pct,

        -- Metadata
        wt.report_date,
        wt.record_source,
        wt.loaded_at

    from with_trajectory wt
    inner join dim_academic_year ay
        on wt.academic_year_id = ay.academic_year_id
    left join subject_mapping sm
        on wt.academic_year_id = sm.academic_year_id
        and wt.six_dimensions_subject_name = sm.six_dimensions_subject_name

)

select * from final
    );
  
[0m22:04:23.180627 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:dcc1a181-6d4a-48a5-9088-23ea3373ae0f&page=queryresults
[0m22:04:23.483881 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:38a47b57-e787-4f0b-bf03-85659627f383&page=queryresults
[0m22:04:24.210493 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b722d0>]}
[0m22:04:24.211230 [info ] [Thread-1 (]: 12 of 18 OK created sql table model analytics.fct_equity_gap ................... [[32mCREATE TABLE (18.0 rows, 2.6 KiB processed)[0m in 2.68s]
[0m22:04:24.211733 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.fct_equity_gap
[0m22:04:24.212059 [debug] [Thread-1 (]: Began running node model.barton_peveril_analytics.dim_student_detail
[0m22:04:24.212520 [info ] [Thread-1 (]: 16 of 18 START sql table model analytics.dim_student_detail .................... [RUN]
[0m22:04:24.212973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.fct_equity_gap, now model.barton_peveril_analytics.dim_student_detail)
[0m22:04:24.213294 [debug] [Thread-1 (]: Began compiling node model.barton_peveril_analytics.dim_student_detail
[0m22:04:24.216802 [debug] [Thread-1 (]: Writing injected SQL for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:04:24.218167 [debug] [Thread-1 (]: Began executing node model.barton_peveril_analytics.dim_student_detail
[0m22:04:24.219873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:24.508832 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148bfdd00>]}
[0m22:04:24.509584 [info ] [Thread-2 (]: 13 of 18 OK created sql table model analytics.fct_alps_subject_performance ..... [[32mCREATE TABLE (30.0 rows, 4.4 KiB processed)[0m in 2.95s]
[0m22:04:24.509960 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.fct_alps_subject_performance
[0m22:04:24.510192 [debug] [Thread-2 (]: Began running node model.barton_peveril_analytics.int_enrolment_with_context
[0m22:04:24.510512 [info ] [Thread-2 (]: 17 of 18 START sql view model analytics_integration.int_enrolment_with_context . [RUN]
[0m22:04:24.510827 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.fct_alps_subject_performance, now model.barton_peveril_analytics.int_enrolment_with_context)
[0m22:04:24.511049 [debug] [Thread-2 (]: Began compiling node model.barton_peveril_analytics.int_enrolment_with_context
[0m22:04:24.513966 [debug] [Thread-2 (]: Writing injected SQL for node "model.barton_peveril_analytics.int_enrolment_with_context"
[0m22:04:24.514690 [debug] [Thread-2 (]: Began executing node model.barton_peveril_analytics.int_enrolment_with_context
[0m22:04:24.517154 [debug] [Thread-2 (]: Writing runtime sql for node "model.barton_peveril_analytics.int_enrolment_with_context"
[0m22:04:24.517786 [debug] [Thread-2 (]: On model.barton_peveril_analytics.int_enrolment_with_context: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.int_enrolment_with_context"} */


  create or replace view `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`
  OPTIONS()
  as with enrolment as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__enrolment`
    where is_valid_completion = true

),

offering as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`
    where is_valid_qualification = true

),

offering_type as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`

),

course_header as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`

),

completion_status as (

    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__completion_status`

),

student_demographics as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`

),

enriched as (

    select
        -- Enrolment keys
        e.enrolment_id,
        e.offering_id,
        e.student_id,

        -- Offering context
        o.course_header_id,
        o.offering_type_id,
        o.academic_year_id,
        o.offering_code,
        o.offering_name,
        o.qualification_id,
        o.study_year,
        o.duration_years,
        o.is_final_year,

        -- Offering type context
        ot.offering_type_name,
        ot.offering_type_category,
        ot.grading_scale,
        ot.is_academic,
        ot.is_vocational,

        -- Course header context
        ch.course_code,
        ch.course_name,
        ch.subject_area,
        ch.department,

        -- Completion status
        e.completion_status_id,
        cs.status_name                                  as completion_status,
        cs.is_completed,
        cs.is_continuing,
        cs.is_withdrawn,

        -- Grade
        e.actual_grade                                  as grade,
        e.target_grade,
        e.predicted_grade,

        -- Attendance
        e.attendance_pct,

        -- Dates
        e.enrolment_date,
        e.expected_end_date,
        e.actual_end_date,

        -- A-Level grade flags
        case when ot.is_academic and e.actual_grade = 'A*' then 1 else 0 end as is_grade_a_star,
        case when ot.is_academic and e.actual_grade = 'A' then 1 else 0 end as is_grade_a,
        case when ot.is_academic and e.actual_grade = 'B' then 1 else 0 end as is_grade_b,
        case when ot.is_academic and e.actual_grade = 'C' then 1 else 0 end as is_grade_c,
        case when ot.is_academic and e.actual_grade = 'D' then 1 else 0 end as is_grade_d,
        case when ot.is_academic and e.actual_grade = 'E' then 1 else 0 end as is_grade_e,
        case when ot.is_academic and e.actual_grade = 'U' then 1 else 0 end as is_grade_u,

        -- BTEC grade flags
        case when ot.is_vocational and e.actual_grade = 'D*' then 1 else 0 end as is_grade_distinction_star,
        case when ot.is_vocational and e.actual_grade = 'D' then 1 else 0 end as is_grade_distinction,
        case when ot.is_vocational and e.actual_grade = 'M' then 1 else 0 end as is_grade_merit,
        case when ot.is_vocational and e.actual_grade = 'P' then 1 else 0 end as is_grade_pass,

        -- High grade flag (depends on qualification type)
        case
            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B') then 1
            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M') then 1
            else 0
        end                                             as is_high_grade,

        -- Pass flag
        case
            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B', 'C', 'D', 'E') then 1
            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M', 'P') then 1
            else 0
        end                                             as is_pass,

        -- Student demographics
        sd.student_detail_id,
        sd.full_name                                    as student_name,
        sd.gender,
        sd.ethnicity,
        sd.is_send,
        sd.is_free_meals,
        sd.is_bursary,
        sd.is_lac,
        sd.is_young_carer,

        -- Prior attainment
        sd.average_gcse_score,
        sd.prior_attainment_band,
        sd.prior_attainment_band_code,

        -- Counting measure
        1                                               as enrolment_count,

        -- Metadata
        e.record_source,
        e.loaded_at

    from enrolment e
    inner join offering o
        on e.offering_id = o.offering_id
    inner join offering_type ot
        on o.offering_type_id = ot.offering_type_id
    inner join course_header ch
        on o.course_header_id = ch.course_header_id
    left join completion_status cs
        on e.completion_status_id = cs.completion_status_id
    left join student_demographics sd
        on e.student_id = sd.student_id
        and o.academic_year_id = sd.academic_year_id

    -- Filter to final year only (where results are awarded)
    where o.is_final_year = true

)

select * from enriched;


[0m22:04:24.518119 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:04:24.575525 [debug] [Thread-1 (]: Writing runtime sql for node "model.barton_peveril_analytics.dim_student_detail"
[0m22:04:24.576155 [debug] [Thread-1 (]: On model.barton_peveril_analytics.dim_student_detail: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.dim_student_detail"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`dim_student_detail`
      
    
    

    
    OPTIONS()
    as (
      with source as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`

),

final as (

    select
        -- Surrogate key
        farm_fingerprint(
        concat(
            
                coalesce(cast(student_detail_id as string), '_dbt_null_')
                
            
        )
    )
 as student_detail_key,

        -- Natural keys
        student_detail_id,
        student_id,
        academic_year_id,

        -- Core demographics
        full_name,
        gender,
        ethnicity,

        -- Demographic flags for equity analysis
        is_free_meals,
        is_bursary,
        is_lac,
        is_send,
        is_high_needs,
        is_young_carer,

        -- SEND details
        primary_send_type,
        secondary_send_type,

        -- Geographic
        postcode_area,
        imd_decile,
        polar4_quintile,
        tundra_classification,

        -- Background
        nationality,
        country_of_birth,
        first_language,
        religion,

        -- Prior attainment
        average_gcse_score,
        prior_attainment_band,

        -- Metadata
        record_source,
        loaded_at

    from source

)

select * from final
    );
  
[0m22:04:24.874353 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148af4fb0>]}
[0m22:04:24.875040 [info ] [Thread-3 (]: 14 of 18 OK created sql table model analytics.fct_college_performance .......... [[32mCREATE TABLE (4.0 rows, 3.3 KiB processed)[0m in 2.80s]
[0m22:04:24.875560 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_college_performance
[0m22:04:25.177383 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:8eb68e0d-e973-4efd-9326-2421f571ba20&page=queryresults
[0m22:04:25.522421 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148be47a0>]}
[0m22:04:25.523145 [info ] [Thread-4 (]: 15 of 18 OK created sql table model analytics.fct_subject_benchmark ............ [[32mCREATE TABLE (104.0 rows, 6.3 KiB processed)[0m in 3.01s]
[0m22:04:25.523648 [debug] [Thread-4 (]: Finished running node model.barton_peveril_analytics.fct_subject_benchmark
[0m22:04:25.539886 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:db309e8e-c0e6-4253-b07a-9c17325ca569&page=queryresults
[0m22:04:25.839281 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148d3cfb0>]}
[0m22:04:25.839882 [info ] [Thread-2 (]: 17 of 18 OK created sql view model analytics_integration.int_enrolment_with_context  [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m22:04:25.840351 [debug] [Thread-2 (]: Finished running node model.barton_peveril_analytics.int_enrolment_with_context
[0m22:04:26.962929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148db0ec0>]}
[0m22:04:26.963693 [info ] [Thread-1 (]: 16 of 18 OK created sql table model analytics.dim_student_detail ............... [[32mCREATE TABLE (78.0 rows, 14.4 KiB processed)[0m in 2.75s]
[0m22:04:26.964476 [debug] [Thread-1 (]: Finished running node model.barton_peveril_analytics.dim_student_detail
[0m22:04:26.965374 [debug] [Thread-3 (]: Began running node model.barton_peveril_analytics.fct_enrolment
[0m22:04:26.965920 [info ] [Thread-3 (]: 18 of 18 START sql table model analytics.fct_enrolment ......................... [RUN]
[0m22:04:26.966409 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.barton_peveril_analytics.fct_college_performance, now model.barton_peveril_analytics.fct_enrolment)
[0m22:04:26.966767 [debug] [Thread-3 (]: Began compiling node model.barton_peveril_analytics.fct_enrolment
[0m22:04:26.972559 [debug] [Thread-3 (]: Writing injected SQL for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:04:26.973357 [debug] [Thread-3 (]: Began executing node model.barton_peveril_analytics.fct_enrolment
[0m22:04:26.981182 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:04:27.346365 [debug] [Thread-3 (]: Writing runtime sql for node "model.barton_peveril_analytics.fct_enrolment"
[0m22:04:27.347655 [debug] [Thread-3 (]: On model.barton_peveril_analytics.fct_enrolment: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ra_data_warehouse", "target_name": "dev", "node_id": "model.barton_peveril_analytics.fct_enrolment"} */

  
    

    create or replace table `ra-warehouse-dev`.`analytics`.`fct_enrolment`
      
    partition by date_trunc(academic_year_start_date, year)
    cluster by offering_key, student_key

    
    OPTIONS()
    as (
      with enrolment_context as (

    select * from `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`

),

dim_academic_year as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`

),

dim_offering_type as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering_type`

),

dim_course_header as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_course_header`

),

dim_offering as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`

),

dim_student as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student`

),

dim_student_detail as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_student_detail`

),

dim_prior_attainment as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`

),

dim_grade as (

    select * from `ra-warehouse-dev`.`analytics`.`dim_grade`

),

final as (

    select
        -- Primary key
        farm_fingerprint(
        concat(
            
                coalesce(cast(ec.enrolment_id as string), '_dbt_null_')
                
            
        )
    )
 as enrolment_key,

        -- Dimension foreign keys (surrogate)
        ay.academic_year_key,
        ot.offering_type_key,
        ch.course_header_key,
        o.offering_key,
        s.student_key,
        sd.student_detail_key,
        pa.prior_attainment_key,
        g.grade_key,

        -- Natural keys (for debugging)
        ec.academic_year_id,
        ec.offering_id,
        ec.student_id,
        ec.student_detail_id,

        -- For partitioning
        ay.academic_year_start_date,

        -- Enrolment status
        ec.completion_status_id,
        ec.completion_status,
        ec.is_completed,

        -- Grade measures
        ec.grade,
        ec.target_grade,
        ec.predicted_grade,

        -- A-Level grade flags
        ec.is_grade_a_star,
        ec.is_grade_a,
        ec.is_grade_b,
        ec.is_grade_c,
        ec.is_grade_d,
        ec.is_grade_e,
        ec.is_grade_u,

        -- BTEC grade flags
        ec.is_grade_distinction_star,
        ec.is_grade_distinction,
        ec.is_grade_merit,
        ec.is_grade_pass,

        -- Cumulative grade flags
        ec.is_high_grade,
        ec.is_pass,

        -- Prior attainment
        ec.average_gcse_score,
        ec.prior_attainment_band,

        -- Demographics
        ec.gender,
        ec.ethnicity,
        ec.is_send,
        ec.is_free_meals,
        ec.is_bursary,
        ec.is_lac,
        ec.is_young_carer,

        -- Attendance
        ec.attendance_pct,

        -- Counting measure
        ec.enrolment_count,

        -- Metadata
        ec.record_source,
        ec.loaded_at

    from enrolment_context ec

    -- Join to dimensions
    inner join dim_academic_year ay
        on ec.academic_year_id = ay.academic_year_id
    inner join dim_offering_type ot
        on ec.offering_type_id = ot.offering_type_id
    inner join dim_course_header ch
        on ec.course_header_id = ch.course_header_id
    inner join dim_offering o
        on ec.offering_id = o.offering_id
    inner join dim_student s
        on ec.student_id = s.student_id
    left join dim_student_detail sd
        on ec.student_detail_id = sd.student_detail_id
    left join dim_prior_attainment pa
        on ec.student_id = pa.student_id
        and ec.academic_year_id = pa.academic_year_id
    left join dim_grade g
        on ec.grade = g.grade
        and ec.grading_scale = g.grading_scale

)

select * from final
    );
  
[0m22:04:28.300827 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=ra-warehouse-dev&j=bq:europe-west2:1f7937a4-490a-422e-91c7-01b97d6f177d&page=queryresults
[0m22:04:30.945243 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c858f1f6-9bed-4a29-88cc-6e5c3336d0ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148de3980>]}
[0m22:04:30.945674 [info ] [Thread-3 (]: 18 of 18 OK created sql table model analytics.fct_enrolment .................... [[32mCREATE TABLE (157.0 rows, 23.5 KiB processed)[0m in 3.98s]
[0m22:04:30.945980 [debug] [Thread-3 (]: Finished running node model.barton_peveril_analytics.fct_enrolment
[0m22:04:30.946755 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:04:30.947634 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:04:30.947805 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.dim_student_detail' was properly closed.
[0m22:04:30.947941 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.int_enrolment_with_context' was properly closed.
[0m22:04:30.948063 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_enrolment' was properly closed.
[0m22:04:30.948178 [debug] [MainThread]: Connection 'model.barton_peveril_analytics.fct_subject_benchmark' was properly closed.
[0m22:04:30.948373 [info ] [MainThread]: 
[0m22:04:30.948530 [info ] [MainThread]: Finished running 13 table models, 5 view models in 0 hours 0 minutes and 17.27 seconds (17.27s).
[0m22:04:30.949846 [debug] [MainThread]: Command end result
[0m22:04:30.977295 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/manifest.json
[0m22:04:30.978757 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/semantic_manifest.json
[0m22:04:30.981914 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/target/run_results.json
[0m22:04:30.982076 [info ] [MainThread]: 
[0m22:04:30.982230 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:04:30.982340 [info ] [MainThread]: 
[0m22:04:30.982469 [info ] [MainThread]: Done. PASS=18 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=18
[0m22:04:30.985158 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 18.945824, "process_in_blocks": "0", "process_kernel_time": 0.386733, "process_mem_max_rss": "393428992", "process_out_blocks": "0", "process_user_time": 4.320564}
[0m22:04:30.985394 [debug] [MainThread]: Command `dbt run` succeeded at 22:04:30.985350 after 18.95 seconds
[0m22:04:30.985561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111146960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147326420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148d114f0>]}
[0m22:04:30.985711 [debug] [MainThread]: Flushing usage events
[0m22:04:31.696288 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:23:07.513490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a090a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a3bb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a3b4d0>]}


============================== 13:23:07.515893 | 33372677-745f-4139-be0f-7615d37715e2 ==============================
[0m13:23:07.515893 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:23:07.516177 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'invocation_command': 'dbt ', 'write_json': 'True', 'quiet': 'False', 'empty': 'None', 'no_print': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'fail_fast': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/markrittman/.dbt', 'static_parser': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_path': '/Users/markrittman/github/RA_Accelerated_Development/dbt_package/logs', 'printer_width': '80', 'debug': 'False', 'indirect_selection': 'eager', 'target_path': 'None'}
[0m13:23:09.741497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33372677-745f-4139-be0f-7615d37715e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b5afc0>]}
[0m13:23:09.878998 [debug] [MainThread]: Set downloads directory='/var/folders/06/mt6gmkw13jg1yw4llqx111b80000gn/T/dbt-downloads-rsuiv285'
[0m13:23:09.879203 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m13:23:10.003218 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m13:23:10.004236 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m13:23:10.077078 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m13:23:10.080106 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json
[0m13:23:10.147893 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/codegen.json 200
[0m13:23:10.150262 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m13:23:10.464178 [info ] [MainThread]: Installed from version 1.3.3
[0m13:23:10.464394 [info ] [MainThread]: Up to date!
[0m13:23:10.464551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '33372677-745f-4139-be0f-7615d37715e2', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f7500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d48ec0>]}
[0m13:23:10.464824 [info ] [MainThread]: Installing dbt-labs/codegen
[0m13:23:10.685252 [info ] [MainThread]: Installed from version 0.14.0
[0m13:23:10.685500 [info ] [MainThread]: Up to date!
[0m13:23:10.685872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '33372677-745f-4139-be0f-7615d37715e2', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bafe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bac050>]}
[0m13:23:10.737430 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 3.3065507, "process_in_blocks": "0", "process_kernel_time": 0.211881, "process_mem_max_rss": "119193600", "process_out_blocks": "0", "process_user_time": 0.661969}
[0m13:23:10.737842 [debug] [MainThread]: Command `cli deps` succeeded at 13:23:10.737765 after 3.31 seconds
[0m13:23:10.738070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10637b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102202ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105071df0>]}
[0m13:23:10.738287 [debug] [MainThread]: Flushing usage events
[0m13:23:11.147617 [debug] [MainThread]: An error was encountered while trying to flush usage events
