{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-17T22:04:30.948652Z", "invocation_id": "c858f1f6-9bed-4a29-88cc-6e5c3336d0ba", "invocation_started_at": "2025-12-17T22:04:12.058620Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:15.767879Z", "completed_at": "2025-12-17T22:04:15.772717Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:15.780809Z", "completed_at": "2025-12-17T22:04:18.502098Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.7499659061431885, "adapter_response": {"_message": "CREATE TABLE (19.0 rows, 778.0 Bytes processed)", "code": "CREATE TABLE", "rows_affected": 19, "bytes_processed": 778, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "6915c1e4-d4e2-4e35-8c40-a146f1e62453", "slot_ms": 1175}, "message": "CREATE TABLE (19.0 rows, 778.0 Bytes processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_grade", "compiled": true, "compiled_code": "with grade_points as (\n\n    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_grade_points`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(grade as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(qualification_type as string), '_dbt_null_')\n                \n            \n        )\n    )\n as grade_key,\n\n        -- Natural key\n        grade,\n        qualification_type as grading_scale,\n\n        -- Point values\n        ucas_points,\n        grade_points,\n        grade_sort_order,\n\n        -- Grade classification flags\n        is_high_grade,\n        is_pass as is_pass_grade,\n\n        -- Cumulative grade flags (A-Level specific)\n        case when grade in ('A*', 'A') then true else false end as is_grade_a_star_to_a,\n        case when grade in ('A*', 'A', 'B') then true else false end as is_grade_a_star_to_b,\n        case when grade in ('A*', 'A', 'B', 'C') then true else false end as is_grade_a_star_to_c,\n        case when grade in ('A*', 'A', 'B', 'C', 'D', 'E') then true else false end as is_grade_a_star_to_e,\n\n        -- Metadata\n        'seed' as record_source,\n        current_timestamp() as loaded_at\n\n    from grade_points\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_grade`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:15.769939Z", "completed_at": "2025-12-17T22:04:15.772904Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:15.781991Z", "completed_at": "2025-12-17T22:04:18.714242Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.96164608001709, "adapter_response": {"_message": "CREATE TABLE (30.0 rows, 3.7 KiB processed)", "code": "CREATE TABLE", "rows_affected": 30, "bytes_processed": 3768, "bytes_billed": 20971520, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "be0c145a-0c68-4549-b447-5a43a070c33f", "slot_ms": 1124}, "message": "CREATE TABLE (30.0 rows, 3.7 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_offering", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`\n    where is_valid_qualification = true\n\n),\n\nsubject_crosswalk as (\n\n    select * from `ra-warehouse-dev`.`analytics_seed`.`seed_subject_crosswalk`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(o.offering_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as offering_key,\n\n        -- Natural key\n        o.offering_id,\n\n        -- Attributes\n        o.offering_code,\n        o.offering_name,\n        o.qualification_id,\n        o.study_year,\n        o.duration_years,\n        o.is_final_year,\n\n        -- Foreign keys (natural keys for joins)\n        o.academic_year_id,\n        o.offering_type_id,\n        o.course_header_id,\n\n        -- External system mappings for benchmarking (from crosswalk)\n        sc.dfe_qualification_code,\n        sc.alps_subject_name,\n        sc.six_dimensions_subject_name,\n\n        -- Metadata\n        o.record_source,\n        o.loaded_at\n\n    from source o\n    left join subject_crosswalk sc\n        on o.course_header_id = sc.course_header_id\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_offering`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:15.764999Z", "completed_at": "2025-12-17T22:04:15.772493Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:15.773219Z", "completed_at": "2025-12-17T22:04:18.807651Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 3.0556390285491943, "adapter_response": {"_message": "CREATE TABLE (15.0 rows, 739.0 Bytes processed)", "code": "CREATE TABLE", "rows_affected": 15, "bytes_processed": 739, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "7b73891f-28f6-4d7e-bd84-6db77475333c", "slot_ms": 734}, "message": "CREATE TABLE (15.0 rows, 739.0 Bytes processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_course_header", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(course_header_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as course_header_key,\n\n        -- Natural key\n        course_header_id,\n\n        -- Attributes\n        course_code,\n        course_name,\n        subject_area,\n        department,\n        is_active,\n\n        -- Metadata\n        record_source,\n        loaded_at\n\n    from source\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_course_header`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:15.756352Z", "completed_at": "2025-12-17T22:04:15.773061Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:15.783040Z", "completed_at": "2025-12-17T22:04:19.199304Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.4475491046905518, "adapter_response": {"_message": "CREATE TABLE (2.0 rows, 210.0 Bytes processed)", "code": "CREATE TABLE", "rows_affected": 2, "bytes_processed": 210, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "66d45c09-cc49-4773-aad6-013fa2452606", "slot_ms": 109}, "message": "CREATE TABLE (2.0 rows, 210.0 Bytes processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_academic_year", "compiled": true, "compiled_code": "with academic_years as (\n\n    -- Get distinct academic years from offerings\n    select distinct\n        academic_year_id\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`\n    where academic_year_id is not null\n\n),\n\nenriched as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(academic_year_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as academic_year_key,\n\n        -- Natural key\n        academic_year_id,\n\n        -- Attributes\n        concat('20', substr(academic_year_id, 1, 2), '/', '20', substr(academic_year_id, 4, 2)) as academic_year_name,\n\n        -- Date parsing (assuming academic year starts Sept 1)\n        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 1, 2), '-09-01')) as academic_year_start_date,\n        parse_date('%Y-%m-%d', concat('20', substr(academic_year_id, 4, 2), '-08-31')) as academic_year_end_date,\n\n        -- Calendar years\n        cast(concat('20', substr(academic_year_id, 1, 2)) as int64) as calendar_year_start,\n        cast(concat('20', substr(academic_year_id, 4, 2)) as int64) as calendar_year_end,\n\n        -- Current year flag\n        case\n            when academic_year_id = '24/25' then true\n            else false\n        end as is_current_year,\n\n        -- Years from current (for trending)\n        array_length(\n            array(\n                select ay from unnest(['19/20', '20/21', '21/22', '22/23', '23/24', '24/25']) as ay\n                where ay >= academic_year_id and ay <= '24/25'\n            )\n        ) - 1 as years_from_current,\n\n        -- Metadata\n        'prosolution' as record_source,\n        current_timestamp() as loaded_at\n\n    from academic_years\n\n)\n\nselect * from enriched\norder by academic_year_id desc", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_academic_year`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:19.203061Z", "completed_at": "2025-12-17T22:04:19.207797Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:19.207979Z", "completed_at": "2025-12-17T22:04:20.411830Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.210904836654663, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "e9ce374e-cadd-47b1-9879-ab7ce037dfd1", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.int_alps_performance_unioned", "compiled": true, "compiled_code": "with a_level as (\n\n    select\n        alps_report_id                                  as report_id,\n        academic_year_id,\n        alps_subject_name,\n        'A-Level'                                       as qualification_type,\n        cast(null as string)                            as qualification_size,\n        cohort_count,\n        average_gcse_on_entry,\n\n        -- ALPS metrics\n        alps_band,\n        alps_score,\n        value_added_score,\n        national_benchmark_grade,\n\n        -- Performance percentages\n        pass_rate_pct,\n        high_grades_pct,\n\n        -- Source metadata\n        report_date,\n        record_source,\n        loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__a_level_performance`\n\n),\n\nbtec as (\n\n    select\n        alps_btec_report_id                             as report_id,\n        academic_year_id,\n        alps_subject_name,\n        qualification_type,\n        cast(null as string)                            as qualification_size,\n        cohort_count,\n        average_gcse_on_entry,\n\n        -- ALPS metrics\n        alps_band,\n        alps_score,\n        value_added_score,\n        national_benchmark_grade,\n\n        -- Performance percentages\n        pass_rate_pct,\n        high_grades_pct,\n\n        -- Source metadata\n        report_date,\n        record_source,\n        loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_alps__btec_performance`\n\n),\n\nunioned as (\n\n    select * from a_level\n    union all\n    select * from btec\n\n)\n\nselect * from unioned", "relation_name": "`ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:18.506181Z", "completed_at": "2025-12-17T22:04:18.507943Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:18.508076Z", "completed_at": "2025-12-17T22:04:21.060420Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.557307004928589, "adapter_response": {"_message": "CREATE TABLE (7.0 rows, 328.0 Bytes processed)", "code": "CREATE TABLE", "rows_affected": 7, "bytes_processed": 328, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "47be6b04-dd05-47d4-aeb2-bf3d22d4f9a1", "slot_ms": 1261}, "message": "CREATE TABLE (7.0 rows, 328.0 Bytes processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_offering_type", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(offering_type_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as offering_type_key,\n\n        -- Natural key\n        offering_type_id,\n\n        -- Attributes\n        offering_type_name,\n        offering_type_category,\n        qualification_level,\n        grading_scale,\n        is_academic,\n        is_vocational,\n\n        -- Metadata\n        record_source,\n        loaded_at\n\n    from source\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_offering_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:18.717533Z", "completed_at": "2025-12-17T22:04:18.719757Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:18.719903Z", "completed_at": "2025-12-17T22:04:21.463518Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.748703956604004, "adapter_response": {"_message": "CREATE TABLE (78.0 rows, 4.8 KiB processed)", "code": "CREATE TABLE", "rows_affected": 78, "bytes_processed": 4914, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "2e12e273-70ba-46b9-a592-300c3d25ae8c", "slot_ms": 1429}, "message": "CREATE TABLE (78.0 rows, 4.8 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_prior_attainment", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(average_gcse_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as prior_attainment_key,\n\n        -- Natural keys\n        average_gcse_id,\n        student_id,\n        academic_year_id,\n\n        -- GCSE metrics\n        average_gcse_score,\n        prior_attainment_band,\n        prior_attainment_band_code,\n\n        -- Thresholds (from project variables)\n        cast(4.77 as numeric) as low_threshold,\n        cast(6.09 as numeric) as high_threshold,\n\n        -- Individual subject grades\n        gcse_english_grade,\n        gcse_maths_grade,\n        gcse_count,\n\n        -- Metadata\n        record_source,\n        loaded_at\n\n    from source\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_prior_attainment`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:20.415583Z", "completed_at": "2025-12-17T22:04:20.417824Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:20.417958Z", "completed_at": "2025-12-17T22:04:21.524232Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1108899116516113, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "6ab569af-93e9-4f0a-b68c-30a706333c95", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.int_six_dimensions_college_unioned", "compiled": true, "compiled_code": "with va_aggregated as (\n\n    select\n        academic_year_id,\n        'VA'                                            as report_type,\n        'College Overall'                               as report_name,\n        sum(cohort_count)                               as total_cohort_count,\n        avg(value_added_score)                          as avg_value_added_score,\n        avg(confidence_interval_lower)                  as avg_confidence_lower,\n        avg(confidence_interval_upper)                  as avg_confidence_upper,\n        min(report_date)                                as report_date,\n        'six_dimensions'                                as record_source,\n        current_timestamp()                             as loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`\n    group by academic_year_id\n\n),\n\nsixth_sense_aggregated as (\n\n    select\n        academic_year_id,\n        'Sixth Sense'                                   as report_type,\n        'College Overall'                               as report_name,\n        sum(cohort_count)                               as total_cohort_count,\n        avg(pass_rate_pct)                              as avg_pass_rate_pct,\n        avg(high_grades_pct)                            as avg_high_grades_pct,\n        avg(completion_rate_pct)                        as avg_completion_rate_pct,\n        avg(retention_rate_pct)                         as avg_retention_rate_pct,\n        avg(achievement_rate_pct)                       as avg_achievement_rate_pct,\n        avg(attendance_rate_pct)                        as avg_attendance_rate_pct,\n        min(report_date)                                as report_date,\n        'six_dimensions'                                as record_source,\n        current_timestamp()                             as loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`\n    group by academic_year_id\n\n),\n\nunioned as (\n\n    select\n        academic_year_id,\n        report_type,\n        report_name,\n        total_cohort_count,\n        cast(null as numeric) as avg_pass_rate_pct,\n        cast(null as numeric) as avg_high_grades_pct,\n        avg_value_added_score,\n        avg_confidence_lower,\n        avg_confidence_upper,\n        cast(null as numeric) as avg_completion_rate_pct,\n        cast(null as numeric) as avg_retention_rate_pct,\n        cast(null as numeric) as avg_achievement_rate_pct,\n        cast(null as numeric) as avg_attendance_rate_pct,\n        report_date,\n        record_source,\n        loaded_at\n    from va_aggregated\n\n    union all\n\n    select\n        academic_year_id,\n        report_type,\n        report_name,\n        total_cohort_count,\n        avg_pass_rate_pct,\n        avg_high_grades_pct,\n        cast(null as numeric) as avg_value_added_score,\n        cast(null as numeric) as avg_confidence_lower,\n        cast(null as numeric) as avg_confidence_upper,\n        avg_completion_rate_pct,\n        avg_retention_rate_pct,\n        avg_achievement_rate_pct,\n        avg_attendance_rate_pct,\n        report_date,\n        record_source,\n        loaded_at\n    from sixth_sense_aggregated\n\n)\n\nselect * from unioned", "relation_name": "`ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:18.810989Z", "completed_at": "2025-12-17T22:04:18.813591Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:18.813739Z", "completed_at": "2025-12-17T22:04:21.552066Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.7427260875701904, "adapter_response": {"_message": "CREATE TABLE (50.0 rows, 3.6 KiB processed)", "code": "CREATE TABLE", "rows_affected": 50, "bytes_processed": 3659, "bytes_billed": 10485760, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "483f099b-fbf4-467f-bde7-8bea83b845ad", "slot_ms": 977}, "message": "CREATE TABLE (50.0 rows, 3.6 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_student", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(student_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as student_key,\n\n        -- Natural key\n        student_id,\n\n        -- Identifiers\n        uln,\n\n        -- Demographics\n        first_name,\n        last_name,\n        full_name,\n        date_of_birth,\n        gender,\n        ethnicity,\n\n        -- Status\n        is_active,\n\n        -- Dates\n        created_at as first_enrolment_date,\n\n        -- SCD Type 2 tracking (simplified - single version per student)\n        date(created_at) as valid_from_date,\n        cast(null as date) as valid_to_date,\n        true as is_current,\n\n        -- Metadata\n        record_source,\n        loaded_at\n\n    from source\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_student`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:21.065992Z", "completed_at": "2025-12-17T22:04:21.069616Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:21.069866Z", "completed_at": "2025-12-17T22:04:22.068994Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.0065860748291016, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "34a96607-7c8e-4a46-90b9-0e144a73a668", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.int_six_dimensions_subject_unioned", "compiled": true, "compiled_code": "with va_subject as (\n\n    select\n        va_report_id                                    as report_id,\n        academic_year_id,\n        'VA'                                            as report_type,\n        subject_name                                    as six_dimensions_subject_name,\n        qualification_type,\n        cohort_count,\n        average_gcse_on_entry,\n        value_added_score,\n        residual_score,\n        expected_grade,\n        actual_avg_grade,\n        performance_band,\n        confidence_interval_lower,\n        confidence_interval_upper,\n        cast(null as numeric)                           as pass_rate_pct,\n        cast(null as numeric)                           as high_grades_pct,\n        cast(null as numeric)                           as completion_rate_pct,\n        cast(null as numeric)                           as achievement_rate_pct,\n        cast(null as string)                            as performance_quartile,\n        report_date,\n        record_source,\n        loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__va`\n    where subject_name is not null\n\n),\n\nsixth_sense_subject as (\n\n    select\n        sixth_sense_id                                  as report_id,\n        academic_year_id,\n        'Sixth Sense'                                   as report_type,\n        subject_name                                    as six_dimensions_subject_name,\n        qualification_type,\n        cohort_count,\n        cast(null as numeric)                           as average_gcse_on_entry,\n        cast(null as numeric)                           as value_added_score,\n        cast(null as numeric)                           as residual_score,\n        cast(null as string)                            as expected_grade,\n        cast(null as string)                            as actual_avg_grade,\n        cast(null as string)                            as performance_band,\n        cast(null as numeric)                           as confidence_interval_lower,\n        cast(null as numeric)                           as confidence_interval_upper,\n        pass_rate_pct,\n        high_grades_pct,\n        completion_rate_pct,\n        achievement_rate_pct,\n        performance_quartile,\n        report_date,\n        record_source,\n        loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__sixth_sense`\n    where subject_name is not null\n\n),\n\nvocational_subject as (\n\n    select\n        vocational_report_id                            as report_id,\n        academic_year_id,\n        'Vocational'                                    as report_type,\n        subject_name                                    as six_dimensions_subject_name,\n        qualification_type,\n        cohort_count,\n        average_gcse_on_entry,\n        cast(null as numeric)                           as value_added_score,\n        cast(null as numeric)                           as residual_score,\n        cast(null as string)                            as expected_grade,\n        cast(null as string)                            as actual_avg_grade,\n        performance_band,\n        cast(null as numeric)                           as confidence_interval_lower,\n        cast(null as numeric)                           as confidence_interval_upper,\n        pass_rate_pct,\n        cast(null as numeric)                           as high_grades_pct,\n        completion_rate_pct,\n        achievement_rate_pct,\n        cast(null as string)                            as performance_quartile,\n        report_date,\n        record_source,\n        loaded_at\n\n    from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__vocational`\n    where subject_name is not null\n\n),\n\nunioned as (\n\n    select * from va_subject\n    union all\n    select * from sixth_sense_subject\n    union all\n    select * from vocational_subject\n\n)\n\nselect * from unioned", "relation_name": "`ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:21.468068Z", "completed_at": "2025-12-17T22:04:21.471096Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:21.471287Z", "completed_at": "2025-12-17T22:04:22.504422Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.038374900817871, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "c00ce2b0-76b8-41de-84db-fa768b6aa53b", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.int_student_demographics_joined", "compiled": true, "compiled_code": "with student as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student`\n\n),\n\nstudent_detail as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__student_detail`\n\n),\n\nextended_data as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_mis_applications__student_extended_data`\n\n),\n\nprior_attainment as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_focus__average_gcse`\n\n),\n\njoined as (\n\n    select\n        -- Keys\n        sd.student_detail_id,\n        sd.student_id,\n        sd.academic_year_id,\n\n        -- Core demographics from student master\n        s.first_name,\n        s.last_name,\n        s.full_name,\n        s.date_of_birth,\n        s.gender,\n        s.ethnicity,\n        s.is_active,\n\n        -- Location from student_detail\n        sd.postcode,\n        sd.postcode_area,\n\n        -- SEND flags from student_detail\n        sd.lldd_code,\n        sd.is_send,\n        sd.is_high_needs,\n        sd.primary_send_type,\n        sd.secondary_send_type,\n\n        -- Disadvantage flags from student_detail\n        sd.is_free_meals,\n        sd.is_bursary,\n        sd.is_lac,\n\n        -- Extended demographics from MIS Applications\n        ed.nationality,\n        ed.country_of_birth,\n        ed.first_language,\n        ed.religion,\n        coalesce(ed.is_young_carer, false)              as is_young_carer,\n        coalesce(ed.is_parent_carer, false)             as is_parent_carer,\n        ed.care_leaver_status,\n        ed.household_situation,\n        ed.imd_decile,\n        ed.polar4_quintile,\n        ed.tundra_classification,\n\n        -- Prior attainment from Focus\n        pa.average_gcse_score,\n        pa.prior_attainment_band,\n        pa.prior_attainment_band_code,\n        pa.gcse_english_grade,\n        pa.gcse_maths_grade,\n        pa.gcse_count,\n\n        -- Metadata\n        sd.record_source,\n        sd.loaded_at\n\n    from student_detail sd\n    inner join student s\n        on sd.student_id = s.student_id\n    left join extended_data ed\n        on sd.student_id = ed.student_id\n        and sd.academic_year_id = ed.academic_year_id\n    left join prior_attainment pa\n        on sd.student_id = pa.student_id\n        and sd.academic_year_id = pa.academic_year_id\n\n)\n\nselect * from joined", "relation_name": "`ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:21.527761Z", "completed_at": "2025-12-17T22:04:21.530097Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:21.530242Z", "completed_at": "2025-12-17T22:04:24.207052Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.682894229888916, "adapter_response": {"_message": "CREATE TABLE (18.0 rows, 2.6 KiB processed)", "code": "CREATE TABLE", "rows_affected": 18, "bytes_processed": 2682, "bytes_billed": 20971520, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "4dd3a19f-c964-453f-8a87-420b377cb81d", "slot_ms": 11372}, "message": "CREATE TABLE (18.0 rows, 2.6 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.fct_equity_gap", "compiled": true, "compiled_code": "with jedi_data as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_six_dimensions__jedi`\n\n),\n\ndim_academic_year as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`\n\n),\n\n-- Get prior year gaps for trend analysis\nwith_prior_year as (\n\n    select\n        jd.*,\n        lag(jd.gap_grade_points) over (\n            partition by jd.dimension_name, jd.student_group\n            order by jd.academic_year_id\n        ) as prior_year_gap\n\n    from jedi_data jd\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(wp.academic_year_id as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(wp.jedi_report_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as equity_gap_key,\n\n        -- Dimension foreign key\n        ay.academic_year_key,\n\n        -- Source identifier\n        wp.report_type,\n        wp.dimension_name,\n\n        -- Group comparison\n        wp.student_group,\n        wp.comparison_group,\n\n        -- Cohort metrics\n        wp.student_count,\n        wp.comparison_count,\n\n        -- Performance metrics\n        wp.student_avg_grade_points,\n        wp.comparison_avg_grade_points,\n\n        -- Gap analysis\n        wp.gap_grade_points,\n        wp.gap_significance,\n        wp.performance_band,\n\n        -- Trend indicators\n        wp.prior_year_gap,\n        wp.gap_grade_points - wp.prior_year_gap as gap_change_yoy,\n        case\n            when abs(wp.gap_grade_points) < abs(wp.prior_year_gap) then 'Narrowing'\n            when abs(wp.gap_grade_points) > abs(wp.prior_year_gap) then 'Widening'\n            else 'Stable'\n        end as gap_trend,\n\n        -- Metadata\n        wp.report_date,\n        wp.record_source,\n        wp.loaded_at\n\n    from with_prior_year wp\n    inner join dim_academic_year ay\n        on wp.academic_year_id = ay.academic_year_id\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`fct_equity_gap`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:21.554764Z", "completed_at": "2025-12-17T22:04:21.556834Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:21.556964Z", "completed_at": "2025-12-17T22:04:24.506795Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.9542269706726074, "adapter_response": {"_message": "CREATE TABLE (30.0 rows, 4.4 KiB processed)", "code": "CREATE TABLE", "rows_affected": 30, "bytes_processed": 4545, "bytes_billed": 41943040, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "0e61bcec-6aad-4382-8cf5-e6f4f5e8533d", "slot_ms": 9201}, "message": "CREATE TABLE (30.0 rows, 4.4 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.fct_alps_subject_performance", "compiled": true, "compiled_code": "with alps_performance as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_alps_performance_unioned`\n\n),\n\ndim_academic_year as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`\n\n),\n\ndim_offering as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`\n\n),\n\n-- Attempt to match ALPS subjects to internal offerings\nsubject_mapping as (\n\n    select\n        ap.academic_year_id,\n        ap.alps_subject_name,\n        ap.qualification_type,\n        o.offering_key,\n        o.offering_id,\n        -- Simple mapping status based on whether match found\n        case\n            when o.offering_key is not null then 'Matched'\n            else 'Unmapped'\n        end as subject_mapping_status,\n        case\n            when o.offering_key is not null then 100.0\n            else 0.0\n        end as mapping_confidence_pct\n\n    from alps_performance ap\n    left join dim_offering o\n        on ap.alps_subject_name = o.alps_subject_name\n        and ap.academic_year_id = o.academic_year_id\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(ap.academic_year_id as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(ap.alps_subject_name as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(ap.qualification_type as string), '_dbt_null_')\n                \n            \n        )\n    )\n as alps_subject_performance_key,\n\n        -- Dimension foreign keys\n        ay.academic_year_key,\n        sm.offering_key,\n\n        -- ALPS identifiers\n        ap.alps_subject_name,\n        ap.qualification_type as alps_qualification_type,\n\n        -- Subject mapping\n        sm.subject_mapping_status,\n        sm.mapping_confidence_pct,\n\n        -- Cohort\n        ap.cohort_count,\n        ap.average_gcse_on_entry,\n\n        -- ALPS benchmarking metrics\n        ap.alps_band,\n        ap.alps_score,\n        ap.value_added_score,\n        ap.national_benchmark_grade,\n\n        -- Performance percentages\n        ap.pass_rate_pct,\n        ap.high_grades_pct,\n\n        -- Metadata\n        ap.report_date as alps_report_date,\n        ap.record_source,\n        ap.loaded_at\n\n    from alps_performance ap\n    inner join dim_academic_year ay\n        on ap.academic_year_id = ay.academic_year_id\n    left join subject_mapping sm\n        on ap.academic_year_id = sm.academic_year_id\n        and ap.alps_subject_name = sm.alps_subject_name\n        and ap.qualification_type = sm.qualification_type\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`fct_alps_subject_performance`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:22.075589Z", "completed_at": "2025-12-17T22:04:22.080450Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:22.080693Z", "completed_at": "2025-12-17T22:04:24.871192Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.799224853515625, "adapter_response": {"_message": "CREATE TABLE (4.0 rows, 3.3 KiB processed)", "code": "CREATE TABLE", "rows_affected": 4, "bytes_processed": 3350, "bytes_billed": 31457280, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "dcc1a181-6d4a-48a5-9088-23ea3373ae0f", "slot_ms": 5602}, "message": "CREATE TABLE (4.0 rows, 3.3 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.fct_college_performance", "compiled": true, "compiled_code": "with college_performance as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_college_unioned`\n\n),\n\ndim_academic_year as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(cp.academic_year_id as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(cp.report_type as string), '_dbt_null_')\n                \n            \n        )\n    )\n as college_performance_key,\n\n        -- Dimension foreign key\n        ay.academic_year_key,\n\n        -- Source identifiers\n        cp.report_type,\n        cp.report_name,\n\n        -- Cohort measures\n        cp.total_cohort_count,\n\n        -- Performance metrics (from Sixth Sense)\n        cp.avg_pass_rate_pct,\n        cp.avg_high_grades_pct,\n        cp.avg_completion_rate_pct,\n        cp.avg_retention_rate_pct,\n        cp.avg_achievement_rate_pct,\n        cp.avg_attendance_rate_pct,\n\n        -- Value-added metrics (from VA reports)\n        cp.avg_value_added_score,\n        cp.avg_confidence_lower,\n        cp.avg_confidence_upper,\n\n        -- Metadata\n        cp.report_date,\n        cp.record_source,\n        cp.loaded_at\n\n    from college_performance cp\n    inner join dim_academic_year ay\n        on cp.academic_year_id = ay.academic_year_id\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`fct_college_performance`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:22.507807Z", "completed_at": "2025-12-17T22:04:22.511193Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:22.511369Z", "completed_at": "2025-12-17T22:04:25.518958Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.014770030975342, "adapter_response": {"_message": "CREATE TABLE (104.0 rows, 6.3 KiB processed)", "code": "CREATE TABLE", "rows_affected": 104, "bytes_processed": 6442, "bytes_billed": 52428800, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "38a47b57-e787-4f0b-bf03-85659627f383", "slot_ms": 16399}, "message": "CREATE TABLE (104.0 rows, 6.3 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.fct_subject_benchmark", "compiled": true, "compiled_code": "with subject_performance as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_six_dimensions_subject_unioned`\n\n),\n\ndim_academic_year as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`\n\n),\n\ndim_offering as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`\n\n),\n\n-- Attempt to match Six Dimensions subjects to internal offerings\nsubject_mapping as (\n\n    select\n        sp.academic_year_id,\n        sp.six_dimensions_subject_name,\n        o.offering_key,\n        case\n            when o.offering_key is not null then 'Matched'\n            else 'Unmapped'\n        end as subject_mapping_status,\n        case\n            when o.offering_key is not null then 100.0\n            else 0.0\n        end as mapping_confidence_pct\n\n    from subject_performance sp\n    left join dim_offering o\n        on sp.six_dimensions_subject_name = o.six_dimensions_subject_name\n        and sp.academic_year_id = o.academic_year_id\n\n),\n\n-- Calculate year-over-year change for trajectory\nwith_trajectory as (\n\n    select\n        sp.*,\n        lag(sp.pass_rate_pct) over (\n            partition by sp.six_dimensions_subject_name, sp.report_type\n            order by sp.academic_year_id\n        ) as prior_year_pass_rate,\n        sp.pass_rate_pct - lag(sp.pass_rate_pct) over (\n            partition by sp.six_dimensions_subject_name, sp.report_type\n            order by sp.academic_year_id\n        ) as yoy_change_pct\n\n    from subject_performance sp\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(wt.academic_year_id as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(wt.six_dimensions_subject_name as string), '_dbt_null_')\n                , '|', \n            \n                coalesce(cast(wt.report_type as string), '_dbt_null_')\n                \n            \n        )\n    )\n as subject_benchmark_key,\n\n        -- Dimension foreign keys\n        ay.academic_year_key,\n        sm.offering_key,\n\n        -- Source identifiers\n        wt.report_type,\n        wt.six_dimensions_subject_name,\n        wt.qualification_type,\n\n        -- Subject mapping\n        sm.subject_mapping_status,\n        sm.mapping_confidence_pct,\n\n        -- Cohort\n        wt.cohort_count,\n        wt.average_gcse_on_entry,\n\n        -- Performance metrics\n        wt.pass_rate_pct,\n        wt.high_grades_pct,\n        wt.completion_rate_pct,\n        wt.achievement_rate_pct,\n\n        -- Value-added metrics (from VA reports)\n        wt.value_added_score,\n        wt.residual_score,\n        wt.expected_grade,\n        wt.actual_avg_grade,\n        wt.performance_band,\n        wt.confidence_interval_lower,\n        wt.confidence_interval_upper,\n\n        -- Sixth Sense metrics\n        wt.performance_quartile,\n\n        -- Trend indicators\n        case\n            when wt.yoy_change_pct > 2 then 'Improving'\n            when wt.yoy_change_pct < -2 then 'Declining'\n            else 'Stable'\n        end as performance_trajectory,\n        wt.yoy_change_pct,\n\n        -- Metadata\n        wt.report_date,\n        wt.record_source,\n        wt.loaded_at\n\n    from with_trajectory wt\n    inner join dim_academic_year ay\n        on wt.academic_year_id = ay.academic_year_id\n    left join subject_mapping sm\n        on wt.academic_year_id = sm.academic_year_id\n        and wt.six_dimensions_subject_name = sm.six_dimensions_subject_name\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`fct_subject_benchmark`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:24.511189Z", "completed_at": "2025-12-17T22:04:24.514623Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:24.514831Z", "completed_at": "2025-12-17T22:04:25.836848Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.3283908367156982, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "db309e8e-c0e6-4253-b07a-9c17325ca569", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.int_enrolment_with_context", "compiled": true, "compiled_code": "with enrolment as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__enrolment`\n    where is_valid_completion = true\n\n),\n\noffering as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering`\n    where is_valid_qualification = true\n\n),\n\noffering_type as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__offering_type`\n\n),\n\ncourse_header as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__course_header`\n\n),\n\ncompletion_status as (\n\n    select * from `ra-warehouse-dev`.`analytics_staging`.`stg_prosolution__completion_status`\n\n),\n\nstudent_demographics as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`\n\n),\n\nenriched as (\n\n    select\n        -- Enrolment keys\n        e.enrolment_id,\n        e.offering_id,\n        e.student_id,\n\n        -- Offering context\n        o.course_header_id,\n        o.offering_type_id,\n        o.academic_year_id,\n        o.offering_code,\n        o.offering_name,\n        o.qualification_id,\n        o.study_year,\n        o.duration_years,\n        o.is_final_year,\n\n        -- Offering type context\n        ot.offering_type_name,\n        ot.offering_type_category,\n        ot.grading_scale,\n        ot.is_academic,\n        ot.is_vocational,\n\n        -- Course header context\n        ch.course_code,\n        ch.course_name,\n        ch.subject_area,\n        ch.department,\n\n        -- Completion status\n        e.completion_status_id,\n        cs.status_name                                  as completion_status,\n        cs.is_completed,\n        cs.is_continuing,\n        cs.is_withdrawn,\n\n        -- Grade\n        e.actual_grade                                  as grade,\n        e.target_grade,\n        e.predicted_grade,\n\n        -- Attendance\n        e.attendance_pct,\n\n        -- Dates\n        e.enrolment_date,\n        e.expected_end_date,\n        e.actual_end_date,\n\n        -- A-Level grade flags\n        case when ot.is_academic and e.actual_grade = 'A*' then 1 else 0 end as is_grade_a_star,\n        case when ot.is_academic and e.actual_grade = 'A' then 1 else 0 end as is_grade_a,\n        case when ot.is_academic and e.actual_grade = 'B' then 1 else 0 end as is_grade_b,\n        case when ot.is_academic and e.actual_grade = 'C' then 1 else 0 end as is_grade_c,\n        case when ot.is_academic and e.actual_grade = 'D' then 1 else 0 end as is_grade_d,\n        case when ot.is_academic and e.actual_grade = 'E' then 1 else 0 end as is_grade_e,\n        case when ot.is_academic and e.actual_grade = 'U' then 1 else 0 end as is_grade_u,\n\n        -- BTEC grade flags\n        case when ot.is_vocational and e.actual_grade = 'D*' then 1 else 0 end as is_grade_distinction_star,\n        case when ot.is_vocational and e.actual_grade = 'D' then 1 else 0 end as is_grade_distinction,\n        case when ot.is_vocational and e.actual_grade = 'M' then 1 else 0 end as is_grade_merit,\n        case when ot.is_vocational and e.actual_grade = 'P' then 1 else 0 end as is_grade_pass,\n\n        -- High grade flag (depends on qualification type)\n        case\n            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B') then 1\n            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M') then 1\n            else 0\n        end                                             as is_high_grade,\n\n        -- Pass flag\n        case\n            when ot.is_academic and e.actual_grade in ('A*', 'A', 'B', 'C', 'D', 'E') then 1\n            when ot.is_vocational and e.actual_grade in ('D*', 'D', 'M', 'P') then 1\n            else 0\n        end                                             as is_pass,\n\n        -- Student demographics\n        sd.student_detail_id,\n        sd.full_name                                    as student_name,\n        sd.gender,\n        sd.ethnicity,\n        sd.is_send,\n        sd.is_free_meals,\n        sd.is_bursary,\n        sd.is_lac,\n        sd.is_young_carer,\n\n        -- Prior attainment\n        sd.average_gcse_score,\n        sd.prior_attainment_band,\n        sd.prior_attainment_band_code,\n\n        -- Counting measure\n        1                                               as enrolment_count,\n\n        -- Metadata\n        e.record_source,\n        e.loaded_at\n\n    from enrolment e\n    inner join offering o\n        on e.offering_id = o.offering_id\n    inner join offering_type ot\n        on o.offering_type_id = ot.offering_type_id\n    inner join course_header ch\n        on o.course_header_id = ch.course_header_id\n    left join completion_status cs\n        on e.completion_status_id = cs.completion_status_id\n    left join student_demographics sd\n        on e.student_id = sd.student_id\n        and o.academic_year_id = sd.academic_year_id\n\n    -- Filter to final year only (where results are awarded)\n    where o.is_final_year = true\n\n)\n\nselect * from enriched", "relation_name": "`ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:24.213486Z", "completed_at": "2025-12-17T22:04:24.218070Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:24.218354Z", "completed_at": "2025-12-17T22:04:26.958836Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.7498908042907715, "adapter_response": {"_message": "CREATE TABLE (78.0 rows, 14.4 KiB processed)", "code": "CREATE TABLE", "rows_affected": 78, "bytes_processed": 14765, "bytes_billed": 41943040, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "8eb68e0d-e973-4efd-9326-2421f571ba20", "slot_ms": 7141}, "message": "CREATE TABLE (78.0 rows, 14.4 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.dim_student_detail", "compiled": true, "compiled_code": "with source as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_student_demographics_joined`\n\n),\n\nfinal as (\n\n    select\n        -- Surrogate key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(student_detail_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as student_detail_key,\n\n        -- Natural keys\n        student_detail_id,\n        student_id,\n        academic_year_id,\n\n        -- Core demographics\n        full_name,\n        gender,\n        ethnicity,\n\n        -- Demographic flags for equity analysis\n        is_free_meals,\n        is_bursary,\n        is_lac,\n        is_send,\n        is_high_needs,\n        is_young_carer,\n\n        -- SEND details\n        primary_send_type,\n        secondary_send_type,\n\n        -- Geographic\n        postcode_area,\n        imd_decile,\n        polar4_quintile,\n        tundra_classification,\n\n        -- Background\n        nationality,\n        country_of_birth,\n        first_language,\n        religion,\n\n        -- Prior attainment\n        average_gcse_score,\n        prior_attainment_band,\n\n        -- Metadata\n        record_source,\n        loaded_at\n\n    from source\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`dim_student_detail`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T22:04:26.966979Z", "completed_at": "2025-12-17T22:04:26.973246Z"}, {"name": "execute", "started_at": "2025-12-17T22:04:26.973589Z", "completed_at": "2025-12-17T22:04:30.943253Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.978879928588867, "adapter_response": {"_message": "CREATE TABLE (157.0 rows, 23.5 KiB processed)", "code": "CREATE TABLE", "rows_affected": 157, "bytes_processed": 24018, "bytes_billed": 178257920, "location": "europe-west2", "project_id": "ra-warehouse-dev", "job_id": "1f7937a4-490a-422e-91c7-01b97d6f177d", "slot_ms": 21107}, "message": "CREATE TABLE (157.0 rows, 23.5 KiB processed)", "failures": null, "unique_id": "model.barton_peveril_analytics.fct_enrolment", "compiled": true, "compiled_code": "with enrolment_context as (\n\n    select * from `ra-warehouse-dev`.`analytics_integration`.`int_enrolment_with_context`\n\n),\n\ndim_academic_year as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_academic_year`\n\n),\n\ndim_offering_type as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_offering_type`\n\n),\n\ndim_course_header as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_course_header`\n\n),\n\ndim_offering as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_offering`\n\n),\n\ndim_student as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_student`\n\n),\n\ndim_student_detail as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_student_detail`\n\n),\n\ndim_prior_attainment as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_prior_attainment`\n\n),\n\ndim_grade as (\n\n    select * from `ra-warehouse-dev`.`analytics`.`dim_grade`\n\n),\n\nfinal as (\n\n    select\n        -- Primary key\n        farm_fingerprint(\n        concat(\n            \n                coalesce(cast(ec.enrolment_id as string), '_dbt_null_')\n                \n            \n        )\n    )\n as enrolment_key,\n\n        -- Dimension foreign keys (surrogate)\n        ay.academic_year_key,\n        ot.offering_type_key,\n        ch.course_header_key,\n        o.offering_key,\n        s.student_key,\n        sd.student_detail_key,\n        pa.prior_attainment_key,\n        g.grade_key,\n\n        -- Natural keys (for debugging)\n        ec.academic_year_id,\n        ec.offering_id,\n        ec.student_id,\n        ec.student_detail_id,\n\n        -- For partitioning\n        ay.academic_year_start_date,\n\n        -- Enrolment status\n        ec.completion_status_id,\n        ec.completion_status,\n        ec.is_completed,\n\n        -- Grade measures\n        ec.grade,\n        ec.target_grade,\n        ec.predicted_grade,\n\n        -- A-Level grade flags\n        ec.is_grade_a_star,\n        ec.is_grade_a,\n        ec.is_grade_b,\n        ec.is_grade_c,\n        ec.is_grade_d,\n        ec.is_grade_e,\n        ec.is_grade_u,\n\n        -- BTEC grade flags\n        ec.is_grade_distinction_star,\n        ec.is_grade_distinction,\n        ec.is_grade_merit,\n        ec.is_grade_pass,\n\n        -- Cumulative grade flags\n        ec.is_high_grade,\n        ec.is_pass,\n\n        -- Prior attainment\n        ec.average_gcse_score,\n        ec.prior_attainment_band,\n\n        -- Demographics\n        ec.gender,\n        ec.ethnicity,\n        ec.is_send,\n        ec.is_free_meals,\n        ec.is_bursary,\n        ec.is_lac,\n        ec.is_young_carer,\n\n        -- Attendance\n        ec.attendance_pct,\n\n        -- Counting measure\n        ec.enrolment_count,\n\n        -- Metadata\n        ec.record_source,\n        ec.loaded_at\n\n    from enrolment_context ec\n\n    -- Join to dimensions\n    inner join dim_academic_year ay\n        on ec.academic_year_id = ay.academic_year_id\n    inner join dim_offering_type ot\n        on ec.offering_type_id = ot.offering_type_id\n    inner join dim_course_header ch\n        on ec.course_header_id = ch.course_header_id\n    inner join dim_offering o\n        on ec.offering_id = o.offering_id\n    inner join dim_student s\n        on ec.student_id = s.student_id\n    left join dim_student_detail sd\n        on ec.student_detail_id = sd.student_detail_id\n    left join dim_prior_attainment pa\n        on ec.student_id = pa.student_id\n        and ec.academic_year_id = pa.academic_year_id\n    left join dim_grade g\n        on ec.grade = g.grade\n        and ec.grading_scale = g.grading_scale\n\n)\n\nselect * from final", "relation_name": "`ra-warehouse-dev`.`analytics`.`fct_enrolment`", "batch_results": null}], "elapsed_time": 17.268935203552246, "args": {"empty": false, "require_explicit_package_overrides_for_builtin_materializations": true, "require_nested_cumulative_type_params": false, "state_modified_compare_more_unrendered_values": false, "state_modified_compare_vars": false, "log_path": "/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package/logs", "upload_to_artifacts_ingest_api": false, "target": "dev", "require_batched_execution_for_custom_microbatch_strategy": false, "send_anonymous_usage_stats": true, "partial_parse_file_diff": true, "defer": false, "use_colors": true, "populate_cache": true, "log_file_max_bytes": 10485760, "vars": {}, "source_freshness_run_project_hooks": true, "use_colors_file": true, "macro_debugging": false, "strict_mode": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "show_all_deprecations": false, "quiet": false, "require_generic_test_arguments_property": true, "write_json": true, "log_format": "default", "print": true, "skip_nodes_if_on_run_start_fails": false, "printer_width": 80, "require_all_warnings_handled_by_warn_error": false, "select": ["intermediate", "marts"], "use_fast_test_edges": false, "validate_macro_args": false, "introspect": true, "require_yaml_configuration_for_mf_time_spines": false, "which": "run", "show_resource_report": false, "invocation_command": "dbt run --select intermediate marts --target dev", "version_check": true, "cache_selected_only": false, "exclude": [], "favor_state": false, "partial_parse": true, "project_dir": "/Users/markrittman/GitHub/RA_Accelerated_Development_Demo/RA_Accelerated_Development_Demo/dbt_package", "indirect_selection": "eager", "log_format_file": "debug", "profiles_dir": "/Users/markrittman/.dbt", "static_parser": true, "log_level_file": "debug", "require_resource_names_without_spaces": true, "log_level": "info"}}